{"version":3,"file":"peaks.esm.js","sources":["../src/cue.js","../src/utils.js","../src/cue-emitter.js","../src/point.js","../src/waveform-points.js","../src/segment.js","../src/waveform-segments.js","../src/keyboard-handler.js","../src/mediaelement-player.js","../src/player.js","../src/default-point-marker.js","../src/default-segment-marker.js","../src/marker-factories.js","../src/highlight-layer.js","../src/mouse-drag-handler.js","../src/playhead-layer.js","../src/point-marker.js","../src/points-layer.js","../src/segment-marker.js","../src/waveform-shape.js","../src/segment-shape.js","../src/segments-layer.js","../src/waveform-axis.js","../src/waveform-overview.js","../src/waveform-zoomview.js","../src/view-controller.js","../src/zoom-controller.js","../src/waveform-builder.js","../src/main.js"],"sourcesContent":["/**\n * @file\n *\n * Defines the {@link Cue} class.\n *\n * @module cue\n */\n\n/**\n * A cue represents an event to be triggered at some point on the media\n * timeline.\n *\n * @class\n * @alias Cue\n *\n * @param {Number} time Cue time, in seconds.\n * @param {Number} type Cue mark type, either <code>Cue.POINT</code>,\n *   <code>Cue.SEGMENT_START</code>, or <code>Cue.SEGMENT_END</code>.\n * @param {String} id The id of the {@link Point} or {@link Segment}.\n */\n\nfunction Cue(time, type, id) {\n  this.time = time;\n  this.type = type;\n  this.id = id;\n}\n\n/**\n  * @constant\n  * @type {Number}\n  */\n\nCue.POINT = 0;\nCue.SEGMENT_START = 1;\nCue.SEGMENT_END = 2;\n\n/**\n * Callback function for use with Array.prototype.sort().\n *\n * @static\n * @param {Cue} a\n * @param {Cue} b\n * @return {Number}\n */\n\nCue.sorter = function(a, b) {\n  return a.time - b.time;\n};\n\nexport default Cue;\n","function zeroPad(number, precision) {\n  number = number.toString();\n\n  while (number.length < precision) {\n    number = '0' + number;\n  }\n\n  return number;\n}\n\n/**\n * Returns a formatted time string.\n *\n * @param {Number} time The time to be formatted, in seconds.\n * @param {Number} precision Decimal places to which time is displayed\n * @returns {String}\n */\n\nexport function formatTime(time, precision) {\n  var result = [];\n\n  var fractionSeconds = Math.floor((time % 1) * Math.pow(10, precision));\n  var seconds = Math.floor(time);\n  var minutes = Math.floor(seconds / 60);\n  var hours = Math.floor(minutes / 60);\n\n  if (hours > 0) {\n    result.push(hours); // Hours\n  }\n  result.push(minutes % 60); // Mins\n  result.push(seconds % 60); // Seconds\n\n  for (var i = 0; i < result.length; i++) {\n    result[i] = zeroPad(result[i], 2);\n  }\n\n  result = result.join(':');\n\n  if (precision > 0) {\n    result += '.' + zeroPad(fractionSeconds, precision);\n  }\n\n  return result;\n}\n\n/**\n * Rounds the given value up to the nearest given multiple.\n *\n * @param {Number} value\n * @param {Number} multiple\n * @returns {Number}\n *\n * @example\n * roundUpToNearest(5.5, 3); // returns 6\n * roundUpToNearest(141.0, 10); // returns 150\n * roundUpToNearest(-5.5, 3); // returns -6\n */\n\nexport function roundUpToNearest(value, multiple) {\n  if (multiple === 0) {\n    return 0;\n  }\n\n  var multiplier = 1;\n\n  if (value < 0.0) {\n    multiplier = -1;\n    value = -value;\n  }\n\n  var roundedUp = Math.ceil(value);\n\n  return multiplier * (((roundedUp + multiple - 1) / multiple) | 0) * multiple;\n}\n\nexport function clamp(value, min, max) {\n  if (value < min) {\n    return min;\n  }\n  else if (value > max) {\n    return max;\n  }\n  else {\n    return value;\n  }\n}\n\nexport function objectHasProperty(object, field) {\n  return Object.prototype.hasOwnProperty.call(object, field);\n}\n\nexport function extend(to, from) {\n  for (var key in from) {\n    if (objectHasProperty(from, key)) {\n      to[key] = from[key];\n    }\n  }\n\n  return to;\n}\n\n/**\n * Checks whether the given array contains values in ascending order.\n *\n * @param {Array<Number>} array The array to test\n * @returns {Boolean}\n */\n\nexport function isInAscendingOrder(array) {\n  if (array.length === 0) {\n    return true;\n  }\n\n  var value = array[0];\n\n  for (var i = 1; i < array.length; i++) {\n    if (value >= array[i]) {\n      return false;\n    }\n\n    value = array[i];\n  }\n\n  return true;\n}\n\n/**\n * Checks whether the given value is a number.\n *\n * @param {Number} value The value to test\n * @returns {Boolean}\n */\n\nexport function isNumber(value) {\n  return typeof value === 'number';\n}\n\n/**\n * Checks whether the given value is a finite number.\n *\n * @param {Number} value The value to test\n * @returns {Boolean}\n */\n\nexport function isFinite(value) {\n  if (typeof value !== 'number') {\n    return false;\n  }\n\n  // Check for NaN and infinity\n  // eslint-disable-next-line no-self-compare\n  if (value !== value || value === Infinity || value === -Infinity) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Checks whether the given value is a valid timestamp.\n *\n * @param {Number} value The value to test\n * @returns {Boolean}\n */\n\nexport function isValidTime(value) {\n  return (typeof value === 'number') && Number.isFinite(value);\n}\n\n/**\n * Checks whether the given value is a valid object.\n *\n * @param {Object|Array} value The value to test\n * @returns {Boolean}\n */\n\nexport function isObject(value) {\n  return (value !== null) && (typeof value === 'object')\n    && !Array.isArray(value);\n}\n\n/**\n * Checks whether the given value is a valid string.\n *\n * @param {String} value The value to test\n * @returns {Boolean}\n */\n\nexport function isString(value) {\n  return typeof value === 'string';\n}\n\n/**\n * Checks whether the given value is a valid ArrayBuffer.\n *\n * @param {ArrayBuffer} value The value to test\n * @returns {Boolean}\n */\n\nexport function isArrayBuffer(value) {\n  return Object.prototype.toString.call(value).includes('ArrayBuffer');\n}\n\n/**\n * Checks whether the given value is null or undefined.\n *\n * @param {Object} value The value to test\n * @returns {Boolean}\n */\n\nexport function isNullOrUndefined(value) {\n  return value === undefined || value === null;\n}\n\n/**\n * Checks whether the given value is a function.\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isFunction(value) {\n  return typeof value === 'function';\n}\n\n/**\n * Checks whether the given value is a boolean.\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isBoolean(value) {\n  return value === true || value === false;\n}\n\n/**\n * Checks whether the given value is a valid HTML element.\n *\n * @param {HTMLElement} value The value to test\n * @returns {Boolean}\n */\n\nexport function isHTMLElement(value) {\n  return value instanceof HTMLElement;\n}\n\n/**\n * Checks whether the given value is an array\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isArray(value) {\n  return Array.isArray(value);\n}\n\n/**\n * Checks whether the given value is a valid linear gradient color\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isLinearGradientColor(value) {\n  return isObject(value) &&\n    objectHasProperty(value, 'linearGradientStart') &&\n    objectHasProperty(value, 'linearGradientEnd') &&\n    objectHasProperty(value, 'linearGradientColorStops') &&\n    isNumber(value.linearGradientStart) &&\n    isNumber(value.linearGradientEnd) &&\n    isArray(value.linearGradientColorStops) &&\n    value.linearGradientColorStops.length === 2;\n}\n","/**\n * @file\n *\n * Defines the {@link CueEmitter} class.\n *\n * @module cue-emitter\n */\n\nimport Cue from './cue';\nimport { objectHasProperty } from './utils';\n\nvar isHeadless = /HeadlessChrome/.test(navigator.userAgent);\n\nfunction windowIsVisible() {\n  if (isHeadless || navigator.webdriver) {\n    return false;\n  }\n\n  return (typeof document === 'object') &&\n    ('visibilityState' in document) &&\n    (document.visibilityState === 'visible');\n}\n\nvar requestAnimationFrame =\n  window.requestAnimationFrame ||\n  window.mozRequestAnimationFrame ||\n  window.webkitRequestAnimationFrame ||\n  window.msRequestAnimationFrame;\n\nvar cancelAnimationFrame =\n  window.cancelAnimationFrame ||\n  window.mozCancelAnimationFrame ||\n  window.webkitCancelAnimationFrame ||\n  window.msCancelAnimationFrame;\n\nvar eventTypes = {\n  forward: {},\n  reverse: {}\n};\n\nvar EVENT_TYPE_POINT = 0;\nvar EVENT_TYPE_SEGMENT_ENTER = 1;\nvar EVENT_TYPE_SEGMENT_EXIT = 2;\n\neventTypes.forward[Cue.POINT] = EVENT_TYPE_POINT;\neventTypes.forward[Cue.SEGMENT_START] = EVENT_TYPE_SEGMENT_ENTER;\neventTypes.forward[Cue.SEGMENT_END] = EVENT_TYPE_SEGMENT_EXIT;\n\neventTypes.reverse[Cue.POINT] = EVENT_TYPE_POINT;\neventTypes.reverse[Cue.SEGMENT_START] = EVENT_TYPE_SEGMENT_EXIT;\neventTypes.reverse[Cue.SEGMENT_END] = EVENT_TYPE_SEGMENT_ENTER;\n\nvar eventNames = {};\n\neventNames[EVENT_TYPE_POINT] = 'points.enter';\neventNames[EVENT_TYPE_SEGMENT_ENTER] = 'segments.enter';\neventNames[EVENT_TYPE_SEGMENT_EXIT] = 'segments.exit';\n\n/**\n * Given a cue instance, returns the corresponding {@link Point}\n * {@link Segment}.\n *\n * @param {Peaks} peaks\n * @param {Cue} cue\n * @return {Point|Segment}\n * @throws {Error}\n */\n\nfunction getPointOrSegment(peaks, cue) {\n  switch (cue.type) {\n    case Cue.POINT:\n      return peaks.points.getPoint(cue.id);\n\n    case Cue.SEGMENT_START:\n    case Cue.SEGMENT_END:\n      return peaks.segments.getSegment(cue.id);\n\n    default:\n      throw new Error('getPointOrSegment: id not found?');\n  }\n}\n\n/**\n * CueEmitter is responsible for emitting <code>points.enter</code>,\n * <code>segments.enter</code>, and <code>segments.exit</code> events.\n *\n * @class\n * @alias CueEmitter\n *\n * @param {Peaks} peaks Parent {@link Peaks} instance.\n */\n\nfunction CueEmitter(peaks) {\n  this._cues = [];\n  this._peaks = peaks;\n  this._previousTime = -1;\n  this._updateCues = this._updateCues.bind(this);\n  // Event handlers:\n  this._onPlaying = this.onPlaying.bind(this);\n  this._onSeeked = this.onSeeked.bind(this);\n  this._onTimeUpdate = this.onTimeUpdate.bind(this);\n  this._onAnimationFrame = this.onAnimationFrame.bind(this);\n  this._rAFHandle = null;\n  this._activeSegments = {};\n  this._attachEventHandlers();\n}\n\n/**\n * This function is bound to all {@link Peaks} events relating to mutated\n * [Points]{@link Point} or [Segments]{@link Segment}, and updates the\n * list of cues accordingly.\n *\n * @private\n */\n\nCueEmitter.prototype._updateCues = function() {\n  var self = this;\n\n  var points = self._peaks.points.getPoints();\n  var segments = self._peaks.segments.getSegments();\n\n  self._cues.length = 0;\n\n  points.forEach(function(point) {\n    self._cues.push(new Cue(point.time, Cue.POINT, point.id));\n  });\n\n  segments.forEach(function(segment) {\n    self._cues.push(new Cue(segment.startTime, Cue.SEGMENT_START, segment.id));\n    self._cues.push(new Cue(segment.endTime, Cue.SEGMENT_END, segment.id));\n  });\n\n  self._cues.sort(Cue.sorter);\n\n  var time = self._peaks.player.getCurrentTime();\n\n  self._updateActiveSegments(time);\n};\n\n/**\n * Emits events for any cues passed through during media playback.\n *\n * @param {Number} time The current time on the media timeline.\n * @param {Number} previousTime The previous time on the media timeline when\n *   this function was called.\n */\n\nCueEmitter.prototype._onUpdate = function(time, previousTime) {\n  var isForward = time > previousTime;\n  var start;\n  var end;\n  var step;\n\n  if (isForward) {\n    start = 0;\n    end = this._cues.length;\n    step = 1;\n  }\n  else {\n    start = this._cues.length - 1;\n    end = -1;\n    step = -1;\n  }\n\n  // Cues are sorted\n  for (var i = start; isForward ? i < end : i > end; i += step) {\n    var cue = this._cues[i];\n\n    if (isForward ? cue.time > previousTime : cue.time < previousTime) {\n      if (isForward ? cue.time > time : cue.time < time) {\n        break;\n      }\n\n      // Cue falls between time and previousTime\n\n      var marker = getPointOrSegment(this._peaks, cue);\n\n      var eventType = isForward ? eventTypes.forward[cue.type] :\n                                  eventTypes.reverse[cue.type];\n\n      if (eventType === EVENT_TYPE_SEGMENT_ENTER) {\n        this._activeSegments[marker.id] = marker;\n      }\n      else if (eventType === EVENT_TYPE_SEGMENT_EXIT) {\n        delete this._activeSegments[marker.id];\n      }\n\n      this._peaks.emit(eventNames[eventType], marker);\n    }\n  }\n};\n\n// the next handler and onAnimationFrame are bound together\n// when the window isn't in focus, rAF is throttled\n// falling back to timeUpdate\n\nCueEmitter.prototype.onTimeUpdate = function(time) {\n  if (windowIsVisible()) {\n    return;\n  }\n\n  if (this._peaks.player.isPlaying() && !this._peaks.player.isSeeking()) {\n    this._onUpdate(time, this._previousTime);\n  }\n\n  this._previousTime = time;\n};\n\nCueEmitter.prototype.onAnimationFrame = function() {\n  var time = this._peaks.player.getCurrentTime();\n\n  if (!this._peaks.player.isSeeking()) {\n    this._onUpdate(time, this._previousTime);\n  }\n\n  this._previousTime = time;\n\n  if (this._peaks.player.isPlaying()) {\n    this._rAFHandle = requestAnimationFrame(this._onAnimationFrame);\n  }\n};\n\nCueEmitter.prototype.onPlaying = function() {\n  this._previousTime = this._peaks.player.getCurrentTime();\n  this._rAFHandle = requestAnimationFrame(this._onAnimationFrame);\n};\n\nCueEmitter.prototype.onSeeked = function(time) {\n  this._previousTime = time;\n\n  this._updateActiveSegments(time);\n};\n\nfunction getSegmentIdComparator(id) {\n  return function compareSegmentIds(segment) {\n    return segment.id === id;\n  };\n}\n\n/**\n * The active segments is the set of all segments which overlap the current\n * playhead position. This function updates that set and emits\n * <code>segments.enter</code> and <code>segments.exit</code> events.\n */\n\nCueEmitter.prototype._updateActiveSegments = function(time) {\n  var self = this;\n\n  var activeSegments = self._peaks.segments.getSegmentsAtTime(time);\n\n  // Remove any segments no longer active.\n\n  for (var id in self._activeSegments) {\n    if (objectHasProperty(self._activeSegments, id)) {\n      var segment = activeSegments.find(getSegmentIdComparator(id));\n\n      if (!segment) {\n        self._peaks.emit('segments.exit', self._activeSegments[id]);\n        delete self._activeSegments[id];\n      }\n    }\n  }\n\n  // Add new active segments.\n\n  activeSegments.forEach(function(segment) {\n    if (!(segment.id in self._activeSegments)) {\n      self._activeSegments[segment.id] = segment;\n      self._peaks.emit('segments.enter', segment);\n    }\n  });\n};\n\nvar triggerUpdateOn = Array(\n  'points.update',\n  'points.dragmove',\n  'points.add',\n  'points.remove',\n  'points.remove_all',\n  'segments.update',\n  'segments.dragged',\n  'segments.add',\n  'segments.remove',\n  'segments.remove_all'\n);\n\nCueEmitter.prototype._attachEventHandlers = function() {\n  this._peaks.on('player.timeupdate', this._onTimeUpdate);\n  this._peaks.on('player.playing', this._onPlaying);\n  this._peaks.on('player.seeked', this._onSeeked);\n\n  for (var i = 0; i < triggerUpdateOn.length; i++) {\n    this._peaks.on(triggerUpdateOn[i], this._updateCues);\n  }\n\n  this._updateCues();\n};\n\nCueEmitter.prototype._detachEventHandlers = function() {\n  this._peaks.off('player.timeupdate', this._onTimeUpdate);\n  this._peaks.off('player.playing', this._onPlaying);\n  this._peaks.off('player.seeked', this._onSeeked);\n\n  for (var i = 0; i < triggerUpdateOn.length; i++) {\n    this._peaks.off(triggerUpdateOn[i], this._updateCues);\n  }\n};\n\nCueEmitter.prototype.destroy = function() {\n  if (this._rAFHandle) {\n    cancelAnimationFrame(this._rAFHandle);\n    this._rAFHandle = null;\n  }\n\n  this._detachEventHandlers();\n\n  this._previousTime = -1;\n};\n\nexport default CueEmitter;\n","/**\n * @file\n *\n * Defines the {@link Point} class.\n *\n * @module point\n */\n\nimport {\n  extend, isBoolean, isLinearGradientColor, isNullOrUndefined, isString,\n  isValidTime, objectHasProperty\n} from './utils';\n\nvar pointOptions = ['peaks', 'id', 'time', 'labelText', 'color', 'editable'];\n\nfunction validatePoint(options, context) {\n  if (!isValidTime(options.time)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.points.' + context + ': time should be a numeric value');\n  }\n\n  if (options.time < 0) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.points.' + context + ': time should not be negative');\n  }\n\n  if (isNullOrUndefined(options.labelText)) {\n    // Set default label text\n    options.labelText = '';\n  }\n  else if (!isString(options.labelText)) {\n    throw new TypeError('peaks.points.' + context + ': labelText must be a string');\n  }\n\n  if (!isBoolean(options.editable)) {\n    throw new TypeError('peaks.points.' + context + ': editable must be true or false');\n  }\n\n  if (options.color &&\n    !isString(options.color) &&\n    !isLinearGradientColor(options.color)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.points.' + context + ': color must be a string or a valid linear gradient object');\n  }\n}\n\n/**\n * A point is a single instant of time, with associated label and color.\n *\n * @class\n * @alias Point\n *\n * @param {Peaks} peaks A reference to the Peaks instance.\n * @param {String} id A unique identifier for the point.\n * @param {Number} time Point time, in seconds.\n * @param {String} labelText Point label text.\n * @param {String} color Point marker color.\n * @param {Boolean} editable If <code>true</code> the segment start and\n *   end times can be adjusted via the user interface.\n * @param {*} data Optional application specific data.\n */\n\nfunction Point(options) {\n  validatePoint(options, 'add()');\n\n  this._peaks     = options.peaks;\n  this._id        = options.id;\n  this._time      = options.time;\n  this._labelText = options.labelText;\n  this._color     = options.color;\n  this._editable  = options.editable;\n\n  this._setUserData(options);\n}\n\nPoint.prototype._setUserData = function(options) {\n  for (var key in options) {\n    if (objectHasProperty(options, key) && pointOptions.indexOf(key) === -1) {\n      this[key] = options[key];\n    }\n  }\n};\n\nObject.defineProperties(Point.prototype, {\n  id: {\n    enumerable: true,\n    get: function() {\n      return this._id;\n    }\n  },\n  time: {\n    enumerable: true,\n    get: function() {\n      return this._time;\n    }\n  },\n  labelText: {\n    get: function() {\n      return this._labelText;\n    }\n  },\n  color: {\n    enumerable: true,\n    get: function() {\n      return this._color;\n    }\n  },\n  editable: {\n    enumerable: true,\n    get: function() {\n      return this._editable;\n    }\n  }\n});\n\nPoint.prototype.update = function(options) {\n  var opts = {\n    time:      this.time,\n    labelText: this.labelText,\n    color:     this.color,\n    editable:  this.editable\n  };\n\n  extend(opts, options);\n\n  validatePoint(opts, 'update()');\n\n  this._time      = opts.time;\n  this._labelText = opts.labelText;\n  this._color     = opts.color;\n  this._editable  = opts.editable;\n\n  this._setUserData(options);\n\n  this._peaks.emit('points.update', this);\n};\n\n/**\n * Returns <code>true</code> if the point lies with in a given time range.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n * @returns {Boolean}\n */\n\nPoint.prototype.isVisible = function(startTime, endTime) {\n  return this.time >= startTime && this.time < endTime;\n};\n\nPoint.prototype._setTime = function(time) {\n  this._time = time;\n};\n\nexport default Point;\n","/**\n * @file\n *\n * Defines the {@link WaveformPoints} class.\n *\n * @module waveform-points\n */\n\nimport Point from './point';\nimport { extend, isNullOrUndefined, objectHasProperty } from './utils';\n\n/**\n * Point parameters.\n *\n * @typedef {Object} PointOptions\n * @global\n * @property {Number} point Point time, in seconds.\n * @property {Boolean=} editable If <code>true</code> the point time can be\n *   adjusted via the user interface.\n *   Default: <code>false</code>.\n * @property {String=} color Point marker color.\n *   Default: a random color.\n * @property {String=} labelText Point label text.\n *   Default: an empty string.\n * @property {String=} id A unique point identifier.\n *   Default: an automatically generated identifier.\n */\n\n/**\n * Handles all functionality related to the adding, removing and manipulation\n * of points. A point is a single instant of time.\n *\n * @class\n * @alias WaveformPoints\n *\n * @param {Peaks} peaks The parent Peaks object.\n */\n\nfunction WaveformPoints(peaks) {\n  this._peaks = peaks;\n  this._points = [];\n  this._pointsById = {};\n  this._pointIdCounter = 0;\n}\n\n/**\n * Returns a new unique point id value.\n *\n * @returns {String}\n */\n\nWaveformPoints.prototype._getNextPointId = function() {\n  return 'peaks.point.' + this._pointIdCounter++;\n};\n\n/**\n * Adds a new point object.\n *\n * @private\n * @param {Point} point\n */\n\nWaveformPoints.prototype._addPoint = function(point) {\n  this._points.push(point);\n\n  this._pointsById[point.id] = point;\n};\n\n/**\n * Creates a new point object.\n *\n * @private\n * @param {PointOptions} options\n * @returns {Point}\n */\n\nWaveformPoints.prototype._createPoint = function(options) {\n  var pointOptions = {\n    peaks: this._peaks\n  };\n\n  extend(pointOptions, options);\n\n  if (isNullOrUndefined(pointOptions.id)) {\n    pointOptions.id = this._getNextPointId();\n  }\n\n  if (isNullOrUndefined(pointOptions.labelText)) {\n    pointOptions.labelText = '';\n  }\n\n  if (isNullOrUndefined(pointOptions.editable)) {\n    pointOptions.editable = false;\n  }\n\n  return new Point(pointOptions);\n};\n\n/**\n * Returns all points.\n *\n * @returns {Array<Point>}\n */\n\nWaveformPoints.prototype.getPoints = function() {\n  return this._points;\n};\n\n/**\n * Returns the point with the given id, or <code>null</code> if not found.\n *\n * @param {String} id\n * @returns {Point|null}\n */\n\nWaveformPoints.prototype.getPoint = function(id) {\n  return this._pointsById[id] || null;\n};\n\n/**\n * Returns all points within a given time region.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n * @returns {Array<Point>}\n */\n\nWaveformPoints.prototype.find = function(startTime, endTime) {\n  return this._points.filter(function(point) {\n    return point.isVisible(startTime, endTime);\n  });\n};\n\n/**\n * Adds one or more points to the timeline.\n *\n * @param {PointOptions|Array<PointOptions>} pointOrPoints\n *\n * @returns Point|Array<Point>\n */\n\nWaveformPoints.prototype.add = function(/* pointOrPoints */) {\n  var self = this;\n\n  var arrayArgs = Array.isArray(arguments[0]);\n  var points = arrayArgs ?\n               arguments[0] :\n               Array.prototype.slice.call(arguments);\n\n  points = points.map(function(pointOptions) {\n    var point = self._createPoint(pointOptions);\n\n    if (objectHasProperty(self._pointsById, point.id)) {\n      throw new Error('peaks.points.add(): duplicate id');\n    }\n\n    return point;\n  });\n\n  points.forEach(function(point) {\n    self._addPoint(point);\n  });\n\n  this._peaks.emit('points.add', points);\n\n  return arrayArgs ? points : points[0];\n};\n\n/**\n * Returns the indexes of points that match the given predicate.\n *\n * @private\n * @param {Function} predicate Predicate function to find matching points.\n * @returns {Array<Number>} An array of indexes into the points array of\n *   the matching elements.\n */\n\nWaveformPoints.prototype._findPoint = function(predicate) {\n  var indexes = [];\n\n  for (var i = 0, length = this._points.length; i < length; i++) {\n    if (predicate(this._points[i])) {\n      indexes.push(i);\n    }\n  }\n\n  return indexes;\n};\n\n/**\n * Removes the points at the given array indexes.\n *\n * @private\n * @param {Array<Number>} indexes The array indexes to remove.\n * @returns {Array<Point>} The removed {@link Point} objects.\n */\n\nWaveformPoints.prototype._removeIndexes = function(indexes) {\n  var removed = [];\n\n  for (var i = 0; i < indexes.length; i++) {\n    var index = indexes[i] - removed.length;\n\n    var itemRemoved = this._points.splice(index, 1)[0];\n\n    delete this._pointsById[itemRemoved.id];\n\n    removed.push(itemRemoved);\n  }\n\n  return removed;\n};\n\n/**\n * Removes all points that match a given predicate function.\n *\n * After removing the points, this function emits a\n * <code>points.remove</code> event with the removed {@link Point}\n * objects.\n *\n * @private\n * @param {Function} predicate A predicate function that identifies which\n *   points to remove.\n * @returns {Array<Point>} The removed {@link Points} objects.\n */\n\nWaveformPoints.prototype._removePoints = function(predicate) {\n  var indexes = this._findPoint(predicate);\n\n  var removed = this._removeIndexes(indexes);\n\n  this._peaks.emit('points.remove', removed);\n\n  return removed;\n};\n\n/**\n * Removes the given point.\n *\n * @param {Point} point The point to remove.\n * @returns {Array<Point>} The removed points.\n */\n\nWaveformPoints.prototype.remove = function(point) {\n  return this._removePoints(function(p) {\n    return p === point;\n  });\n};\n\n/**\n * Removes any points with the given id.\n *\n * @param {String} id\n * @returns {Array<Point>} The removed {@link Point} objects.\n */\n\nWaveformPoints.prototype.removeById = function(pointId) {\n  return this._removePoints(function(point) {\n    return point.id === pointId;\n  });\n};\n\n/**\n * Removes any points at the given time.\n *\n * @param {Number} time\n * @returns {Array<Point>} The removed {@link Point} objects.\n */\n\nWaveformPoints.prototype.removeByTime = function(time) {\n  return this._removePoints(function(point) {\n    return point.time === time;\n  });\n};\n\n/**\n * Removes all points.\n *\n * After removing the points, this function emits a\n * <code>points.remove_all</code> event.\n */\n\nWaveformPoints.prototype.removeAll = function() {\n  this._points = [];\n  this._pointsById = {};\n  this._peaks.emit('points.remove_all');\n};\n\nexport default WaveformPoints;\n","/**\n * @file\n *\n * Defines the {@link Segment} class.\n *\n * @module segment\n */\n\nimport {\n  extend, isBoolean, isNullOrUndefined, isLinearGradientColor,\n  isString, isValidTime, objectHasProperty\n} from './utils';\n\nvar segmentOptions = ['peaks', 'id', 'startTime', 'endTime', 'labelText', 'color', 'editable'];\n\nfunction validateSegment(options, context) {\n  if (!isValidTime(options.startTime)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.' + context + ': startTime should be a valid number');\n  }\n\n  if (!isValidTime(options.endTime)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.' + context + ': endTime should be a valid number');\n  }\n\n  if (options.startTime < 0) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.segments.' + context + ': startTime should not be negative');\n  }\n\n  if (options.endTime < 0) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.segments.' + context + ': endTime should not be negative');\n  }\n\n  if (options.endTime < options.startTime) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.segments.' + context + ': endTime should not be less than startTime');\n  }\n\n  if (isNullOrUndefined(options.labelText)) {\n    // Set default label text\n    options.labelText = '';\n  }\n  else if (!isString(options.labelText)) {\n    throw new TypeError('peaks.segments.' + context + ': labelText must be a string');\n  }\n\n  if (!isBoolean(options.editable)) {\n    throw new TypeError('peaks.segments.' + context + ': editable must be true or false');\n  }\n\n  if (options.color &&\n    !isString(options.color) &&\n    !isLinearGradientColor(options.color)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.' + context + ': color must be a string or a valid linear gradient object');\n  }\n}\n\n/**\n * A segment is a region of time, with associated label and color.\n *\n * @class\n * @alias Segment\n *\n * @param {Peaks} peaks A reference to the Peaks instance.\n * @param {String} id A unique identifier for the segment.\n * @param {Number} startTime Segment start time, in seconds.\n * @param {Number} endTime Segment end time, in seconds.\n * @param {String} labelText Segment label text.\n * @param {String | LinearGradientColor} color Segment waveform color.\n * @param {Boolean} editable If <code>true</code> the segment start and\n *   end times can be adjusted via the user interface.\n * @param {*} data Optional application specific data.\n */\n\nfunction Segment(options) {\n  validateSegment(options, 'add()');\n\n  this._peaks     = options.peaks;\n  this._id        = options.id;\n  this._startTime = options.startTime;\n  this._endTime   = options.endTime;\n  this._labelText = options.labelText;\n  this._color     = options.color;\n  this._editable  = options.editable;\n\n  this._setUserData(options);\n}\n\nSegment.prototype._setUserData = function(options) {\n  for (var key in options) {\n    if (objectHasProperty(options, key) && segmentOptions.indexOf(key) === -1) {\n      this[key] = options[key];\n    }\n  }\n};\n\nObject.defineProperties(Segment.prototype, {\n  id: {\n    enumerable: true,\n    get: function() {\n      return this._id;\n    }\n  },\n  startTime: {\n    enumerable: true,\n    get: function() {\n      return this._startTime;\n    }\n  },\n  endTime: {\n    enumerable: true,\n    get: function() {\n      return this._endTime;\n    }\n  },\n  labelText: {\n    enumerable: true,\n    get: function() {\n      return this._labelText;\n    }\n  },\n  color: {\n    enumerable: true,\n    get: function() {\n      return this._color;\n    }\n  },\n  editable: {\n    enumerable: true,\n    get: function() {\n      return this._editable;\n    }\n  }\n});\n\nSegment.prototype.update = function(options) {\n  var opts = {\n    startTime: this.startTime,\n    endTime:   this.endTime,\n    labelText: this.labelText,\n    color:     this.color,\n    editable:  this.editable\n  };\n\n  extend(opts, options);\n\n  validateSegment(opts, 'update()');\n\n  this._startTime = opts.startTime;\n  this._endTime   = opts.endTime;\n  this._labelText = opts.labelText;\n  this._color     = opts.color;\n  this._editable  = opts.editable;\n\n  this._setUserData(options);\n\n  this._peaks.emit('segments.update', this);\n};\n\n/**\n * Returns <code>true</code> if the segment overlaps a given time region.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n * @returns {Boolean}\n *\n * @see http://wiki.c2.com/?TestIfDateRangesOverlap\n */\n\nSegment.prototype.isVisible = function(startTime, endTime) {\n  return this.startTime < endTime && startTime < this.endTime;\n};\n\nSegment.prototype._setStartTime = function(time) {\n  this._startTime = time;\n};\n\nSegment.prototype._setEndTime = function(time) {\n  this._endTime = time;\n};\n\nexport default Segment;\n","/**\n * @file\n *\n * Defines the {@link WaveformSegments} class.\n *\n * @module waveform-segments\n */\n\nimport Segment from './segment';\nimport { extend, isNullOrUndefined, isObject, objectHasProperty } from './utils';\n\n/**\n * Segment parameters.\n *\n * @typedef {Object} SegmentOptions\n * @global\n * @property {Number} startTime Segment start time, in seconds.\n * @property {Number} endTime Segment end time, in seconds.\n * @property {Boolean=} editable If <code>true</code> the segment start and\n *   end times can be adjusted via the user interface.\n *   Default: <code>false</code>.\n * @property {String=} color Segment waveform color.\n *   Default: a random color.\n * @property {String=} labelText Segment label text.\n *   Default: an empty string.\n * @property {String=} id A unique segment identifier.\n *   Default: an automatically generated identifier.\n */\n\n/**\n * Handles all functionality related to the adding, removing and manipulation\n * of segments.\n *\n * @class\n * @alias WaveformSegments\n *\n * @param {Peaks} peaks The parent Peaks object.\n */\n\nfunction WaveformSegments(peaks) {\n  this._peaks = peaks;\n  this._segments = [];\n  this._segmentsById = {};\n  this._segmentIdCounter = 0;\n  this._colorIndex = 0;\n}\n\n/**\n * Returns a new unique segment id value.\n *\n * @private\n * @returns {String}\n */\n\nWaveformSegments.prototype._getNextSegmentId = function() {\n  return 'peaks.segment.' + this._segmentIdCounter++;\n};\n\nvar colors = [\n  '#001f3f', // navy\n  '#0074d9', // blue\n  '#7fdbff', // aqua\n  '#39cccc', // teal\n  '#ffdc00', // yellow\n  '#ff851b', // orange\n  '#ff4136', // red\n  '#85144b', // maroon\n  '#f012be', // fuchsia\n  '#b10dc9'  // purple\n];\n\n/**\n * @private\n * @returns {String}\n */\n\nWaveformSegments.prototype._getSegmentColor = function() {\n  if (this._peaks.options.randomizeSegmentColor) {\n    if (++this._colorIndex === colors.length) {\n      this._colorIndex = 0;\n    }\n\n    return colors[this._colorIndex];\n  }\n  else {\n    return this._peaks.options.segmentColor;\n  }\n};\n\n/**\n * Adds a new segment object.\n *\n * @private\n * @param {Segment} segment\n */\n\nWaveformSegments.prototype._addSegment = function(segment) {\n  this._segments.push(segment);\n\n  this._segmentsById[segment.id] = segment;\n};\n\n/**\n * Creates a new segment object.\n *\n * @private\n * @param {SegmentOptions} options\n * @return {Segment}\n */\n\nWaveformSegments.prototype._createSegment = function(options) {\n  // Watch for anyone still trying to use the old\n  // createSegment(startTime, endTime, ...) API\n  if (!isObject(options)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.add(): expected a Segment object parameter');\n  }\n\n  var segmentOptions = {\n    peaks: this._peaks\n  };\n\n  extend(segmentOptions, options);\n\n  if (isNullOrUndefined(segmentOptions.id)) {\n    segmentOptions.id = this._getNextSegmentId();\n  }\n\n  if (isNullOrUndefined(segmentOptions.color)) {\n    segmentOptions.color = this._getSegmentColor();\n  }\n\n  if (isNullOrUndefined(segmentOptions.labelText)) {\n    segmentOptions.labelText = '';\n  }\n\n  if (isNullOrUndefined(segmentOptions.editable)) {\n    segmentOptions.editable = false;\n  }\n\n  return new Segment(segmentOptions);\n};\n\n/**\n * Returns all segments.\n *\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype.getSegments = function() {\n  return this._segments;\n};\n\n/**\n * Returns the segment with the given id, or <code>null</code> if not found.\n *\n * @param {String} id\n * @returns {Segment|null}\n */\n\nWaveformSegments.prototype.getSegment = function(id) {\n  return this._segmentsById[id] || null;\n};\n\n/**\n * Returns all segments that overlap a given point in time.\n *\n * @param {Number} time\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype.getSegmentsAtTime = function(time) {\n  return this._segments.filter(function(segment) {\n    return time >= segment.startTime && time < segment.endTime;\n  });\n};\n\n/**\n * Returns all segments that overlap a given time region.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n *\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype.find = function(startTime, endTime) {\n  return this._segments.filter(function(segment) {\n    return segment.isVisible(startTime, endTime);\n  });\n};\n\n/**\n * Adds one or more segments to the timeline.\n *\n * @param {SegmentOptions|Array<SegmentOptions>} segmentOrSegments\n *\n * @returns Segment|Array<Segment>\n */\n\nWaveformSegments.prototype.add = function(/* segmentOrSegments */) {\n  var self = this;\n\n  var arrayArgs = Array.isArray(arguments[0]);\n  var segments = arrayArgs ?\n                 arguments[0] :\n                 Array.prototype.slice.call(arguments);\n\n  segments = segments.map(function(segmentOptions) {\n    var segment = self._createSegment(segmentOptions);\n\n    if (objectHasProperty(self._segmentsById, segment.id)) {\n      throw new Error('peaks.segments.add(): duplicate id');\n    }\n\n    return segment;\n  });\n\n  segments.forEach(function(segment) {\n    self._addSegment(segment);\n  });\n\n  this._peaks.emit('segments.add', segments);\n\n  return arrayArgs ? segments : segments[0];\n};\n\n/**\n * Returns the indexes of segments that match the given predicate.\n *\n * @private\n * @param {Function} predicate Predicate function to find matching segments.\n * @returns {Array<Number>} An array of indexes into the segments array of\n *   the matching elements.\n */\n\nWaveformSegments.prototype._findSegment = function(predicate) {\n  var indexes = [];\n\n  for (var i = 0, length = this._segments.length; i < length; i++) {\n    if (predicate(this._segments[i])) {\n      indexes.push(i);\n    }\n  }\n\n  return indexes;\n};\n\n/**\n * Removes the segments at the given array indexes.\n *\n * @private\n * @param {Array<Number>} indexes The array indexes to remove.\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype._removeIndexes = function(indexes) {\n  var removed = [];\n\n  for (var i = 0; i < indexes.length; i++) {\n    var index = indexes[i] - removed.length;\n\n    var itemRemoved = this._segments.splice(index, 1)[0];\n\n    delete this._segmentsById[itemRemoved.id];\n\n    removed.push(itemRemoved);\n  }\n\n  return removed;\n};\n\n/**\n * Removes all segments that match a given predicate function.\n *\n * After removing the segments, this function also emits a\n * <code>segments.remove</code> event with the removed {@link Segment}\n * objects.\n *\n * @private\n * @param {Function} predicate A predicate function that identifies which\n *   segments to remove.\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype._removeSegments = function(predicate) {\n  var indexes = this._findSegment(predicate);\n\n  var removed = this._removeIndexes(indexes);\n\n  this._peaks.emit('segments.remove', removed);\n\n  return removed;\n};\n\n/**\n * Removes the given segment.\n *\n * @param {Segment} segment The segment to remove.\n * @returns {Array<Segment>} The removed segment.\n */\n\nWaveformSegments.prototype.remove = function(segment) {\n  return this._removeSegments(function(s) {\n    return s === segment;\n  });\n};\n\n/**\n * Removes any segments with the given id.\n *\n * @param {String} id\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype.removeById = function(segmentId) {\n  return this._removeSegments(function(segment) {\n    return segment.id === segmentId;\n  });\n};\n\n/**\n * Removes any segments with the given start time, and optional end time.\n *\n * @param {Number} startTime Segments with this start time are removed.\n * @param {Number?} endTime If present, only segments with both the given\n *   start time and end time are removed.\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype.removeByTime = function(startTime, endTime) {\n  endTime = (typeof endTime === 'number') ? endTime : 0;\n\n  var fnFilter;\n\n  if (endTime > 0) {\n    fnFilter = function(segment) {\n      return segment.startTime === startTime && segment.endTime === endTime;\n    };\n  }\n  else {\n    fnFilter = function(segment) {\n      return segment.startTime === startTime;\n    };\n  }\n\n  return this._removeSegments(fnFilter);\n};\n\n/**\n * Removes all segments.\n *\n * After removing the segments, this function emits a\n * <code>segments.remove_all</code> event.\n */\n\nWaveformSegments.prototype.removeAll = function() {\n  this._segments = [];\n  this._segmentsById = {};\n  this._peaks.emit('segments.remove_all');\n};\n\nexport default WaveformSegments;\n","/**\n * @file\n *\n * Defines the {@link KeyboardHandler} class.\n *\n * @module keyboard-handler\n */\n\nvar nodes = ['OBJECT', 'TEXTAREA', 'INPUT', 'SELECT', 'OPTION'];\n\nvar SPACE = 32,\n    TAB = 9,\n    LEFT_ARROW = 37,\n    RIGHT_ARROW = 39;\n\nvar keys = [SPACE, TAB, LEFT_ARROW, RIGHT_ARROW];\n\n/**\n * Configures keyboard event handling.\n *\n * @class\n * @alias KeyboardHandler\n *\n * @param {EventEmitter} eventEmitter\n */\n\nfunction KeyboardHandler(eventEmitter) {\n  this.eventEmitter = eventEmitter;\n\n  this._handleKeyEvent = this._handleKeyEvent.bind(this);\n\n  document.addEventListener('keydown', this._handleKeyEvent);\n  document.addEventListener('keypress', this._handleKeyEvent);\n  document.addEventListener('keyup', this._handleKeyEvent);\n}\n\n/**\n * Keyboard event handler function.\n *\n * @note Arrow keys only triggered on keydown, not keypress.\n *\n * @param {KeyboardEvent} event\n * @private\n */\n\nKeyboardHandler.prototype._handleKeyEvent = function handleKeyEvent(event) {\n  if (nodes.indexOf(event.target.nodeName) === -1) {\n    if (keys.indexOf(event.type) > -1) {\n      event.preventDefault();\n    }\n\n    if (event.type === 'keydown' || event.type === 'keypress') {\n      switch (event.keyCode) {\n        case SPACE:\n          this.eventEmitter.emit('keyboard.space');\n          break;\n\n        case TAB:\n          this.eventEmitter.emit('keyboard.tab');\n          break;\n      }\n    }\n    else if (event.type === 'keyup') {\n      switch (event.keyCode) {\n        case LEFT_ARROW:\n          if (event.shiftKey) {\n            this.eventEmitter.emit('keyboard.shift_left');\n          }\n          else {\n            this.eventEmitter.emit('keyboard.left');\n          }\n          break;\n\n        case RIGHT_ARROW:\n          if (event.shiftKey) {\n            this.eventEmitter.emit('keyboard.shift_right');\n          }\n          else {\n            this.eventEmitter.emit('keyboard.right');\n          }\n          break;\n      }\n    }\n  }\n};\n\nKeyboardHandler.prototype.destroy = function() {\n  document.removeEventListener('keydown', this._handleKeyEvent);\n  document.removeEventListener('keypress', this._handleKeyEvent);\n  document.removeEventListener('keyup', this._handleKeyEvent);\n};\n\nexport default KeyboardHandler;\n","/**\n * @file\n *\n * Implementation of {@link Player} adapter based on the HTML5 media element.\n *\n * @module player-medialement\n */\n\n/**\n * A wrapper for interfacing with the HTML5 media element API.\n * Initializes the player for a given media element.\n *\n * @class\n * @alias MediaElementPlayer\n * @param {HTMLMediaElement} mediaElement The HTML <code>&lt;audio&gt;</code>\n *   or <code>&lt;video&gt;</code> element to associate with the\n *   {@link Peaks} instance.\n */\n\nfunction MediaElementPlayer(peaks, mediaElement) {\n  var self = this;\n\n  self._peaks = peaks;\n  self._listeners = [];\n  self._mediaElement = mediaElement;\n}\n\n/**\n * Adds an event listener to the media element.\n *\n * @private\n * @param {String} type The event type to listen for.\n * @param {Function} callback An event handler function.\n */\n\nMediaElementPlayer.prototype._addMediaListener = function(type, callback) {\n  this._listeners.push({ type: type, callback: callback });\n  this._mediaElement.addEventListener(type, callback);\n};\n\nMediaElementPlayer.prototype.init = function(player) {\n  var self = this;\n\n  self._player = player;\n  self._listeners = [];\n  self._duration = self.getDuration();\n  self._isPlaying = false;\n\n  self._addMediaListener('timeupdate', function() {\n    self._peaks.emit('player.timeupdate', self.getCurrentTime());\n  });\n\n  self._addMediaListener('playing', function() {\n    self._isPlaying = true;\n    self._peaks.emit('player.playing', self.getCurrentTime());\n  });\n\n  self._addMediaListener('pause', function() {\n    self._isPlaying = false;\n    self._peaks.emit('player.pause', self.getCurrentTime());\n  });\n\n  self._addMediaListener('ended', function() {\n    self._peaks.emit('player.ended');\n  });\n\n  self._addMediaListener('seeked', function() {\n    self._peaks.emit('player.seeked', self.getCurrentTime());\n  });\n\n  self._addMediaListener('canplay', function() {\n    self._peaks.emit('player.canplay');\n  });\n\n  self._addMediaListener('error', function(event) {\n    self._peaks.emit('player.error', event.target.error);\n  });\n\n  self._interval = null;\n\n  // If the media element has preload=\"none\", clicking to seek in the\n  // waveform won't work, so here we force the media to load.\n  if (self._mediaElement.readyState === HTMLMediaElement.HAVE_NOTHING) {\n    self._mediaElement.load();\n  }\n};\n\n/**\n * Cleans up the player object, removing all event listeners from the\n * associated media element.\n */\n\nMediaElementPlayer.prototype.destroy = function() {\n  for (var i = 0; i < this._listeners.length; i++) {\n    var listener = this._listeners[i];\n\n    this._mediaElement.removeEventListener(\n      listener.type,\n      listener.callback\n    );\n  }\n\n  this._listeners.length = 0;\n\n  this._mediaElement = null;\n};\n\nMediaElementPlayer.prototype.play = function() {\n  return this._mediaElement.play();\n};\n\nMediaElementPlayer.prototype.pause = function() {\n  this._mediaElement.pause();\n};\n\nMediaElementPlayer.prototype.isPlaying = function() {\n  return this._isPlaying;\n};\n\nMediaElementPlayer.prototype.isSeeking = function() {\n  return this._mediaElement.seeking;\n};\n\nMediaElementPlayer.prototype.getCurrentTime = function() {\n  return this._mediaElement.currentTime;\n};\n\nMediaElementPlayer.prototype.getDuration = function() {\n  return this._mediaElement.duration;\n};\n\nMediaElementPlayer.prototype.seek = function(time) {\n  this._mediaElement.currentTime = time;\n};\n\nexport default MediaElementPlayer;\n","/**\n * @file\n *\n * A general audio player class which interfaces with external audio players.\n * The default audio player in Peaks.js is {@link MediaElementPlayer}.\n *\n * @module player\n */\n\nimport { isValidTime } from './utils';\n\nfunction getAllPropertiesFrom(adapter) {\n  var allProperties = [];\n  var obj = adapter;\n\n  while (obj) {\n    Object.getOwnPropertyNames(obj).forEach(function(p) {\n      allProperties.push(p);\n    });\n\n    obj = Object.getPrototypeOf(obj);\n  }\n\n  return allProperties;\n}\n\nfunction validateAdapter(adapter) {\n  var publicAdapterMethods = [\n    'init',\n    'destroy',\n    'play',\n    'pause',\n    'isPlaying',\n    'isSeeking',\n    'getCurrentTime',\n    'getDuration',\n    'seek'\n  ];\n\n  var allProperties = getAllPropertiesFrom(adapter);\n\n  publicAdapterMethods.forEach(function(method) {\n    if (!allProperties.includes(method)) {\n      throw new TypeError('Peaks.init(): Player method ' + method + ' is undefined');\n    }\n\n    if ((typeof adapter[method]) !== 'function') {\n      throw new TypeError('Peaks.init(): Player method ' + method + ' is not a function');\n    }\n  });\n}\n\n/**\n * A wrapper for interfacing with an external player API.\n *\n * @class\n * @alias Player\n *\n * @param {Peaks} peaks The parent {@link Peaks} object.\n * @param {Adapter} adapter The player adapter.\n */\n\nfunction Player(peaks, adapter) {\n  this._peaks = peaks;\n\n  this._playingSegment = false;\n  this._segment = null;\n  this._loop = false;\n  this._playSegmentTimerCallback = this._playSegmentTimerCallback.bind(this);\n\n  validateAdapter(adapter);\n  this._adapter = adapter;\n\n  this._adapter.init(peaks);\n}\n\n/**\n * Cleans up the player object.\n */\n\nPlayer.prototype.destroy = function() {\n  this._adapter.destroy();\n};\n\n/**\n * Starts playback.\n * @returns {Promise}\n */\n\nPlayer.prototype.play = function() {\n  return this._adapter.play();\n};\n\n/**\n * Pauses playback.\n */\n\nPlayer.prototype.pause = function() {\n  this._adapter.pause();\n};\n\n/**\n * @returns {Boolean} <code>true</code> if playing, <code>false</code>\n * otherwise.\n */\n\nPlayer.prototype.isPlaying = function() {\n  return this._adapter.isPlaying();\n};\n\n/**\n * @returns {boolean} <code>true</code> if seeking\n */\n\nPlayer.prototype.isSeeking = function() {\n  return this._adapter.isSeeking();\n};\n\n/**\n * Returns the current playback time position, in seconds.\n *\n * @returns {Number}\n */\n\nPlayer.prototype.getCurrentTime = function() {\n  return this._adapter.getCurrentTime();\n};\n\n/**\n * Returns the media duration, in seconds.\n *\n * @returns {Number}\n */\n\nPlayer.prototype.getDuration = function() {\n  return this._adapter.getDuration();\n};\n\n/**\n * Seeks to a given time position within the media.\n *\n * @param {Number} time The time position, in seconds.\n */\n\nPlayer.prototype.seek = function(time) {\n  if (!isValidTime(time)) {\n    this._peaks.logger('peaks.player.seek(): parameter must be a valid time, in seconds');\n    return;\n  }\n\n  this._adapter.seek(time);\n};\n\n/**\n * Plays the given segment.\n *\n * @param {Segment} segment The segment denoting the time region to play.\n * @param {Boolean} loop If true, playback is looped.\n */\n\nPlayer.prototype.playSegment = function(segment, loop) {\n  var self = this;\n\n  if (!segment ||\n    !isValidTime(segment.startTime) ||\n    !isValidTime(segment.endTime)) {\n    return Promise.reject(\n      new Error('peaks.player.playSegment(): parameter must be a segment object')\n    );\n  }\n\n  self._segment = segment;\n  self._loop = loop;\n\n  // Set audio time to segment start time\n  self.seek(segment.startTime);\n\n  self._peaks.once('player.playing', function() {\n    if (!self._playingSegment) {\n      self._playingSegment = true;\n\n      // We need to use requestAnimationFrame here as the timeupdate event\n      // doesn't fire often enough.\n      window.requestAnimationFrame(self._playSegmentTimerCallback);\n    }\n  });\n\n  // Start playing audio\n  return self.play();\n};\n\nPlayer.prototype._playSegmentTimerCallback = function() {\n  if (!this.isPlaying()) {\n    this._playingSegment = false;\n    return;\n  }\n  else if (this.getCurrentTime() >= this._segment.endTime) {\n    if (this._loop) {\n      this.seek(this._segment.startTime);\n    }\n    else {\n      this.pause();\n      this._peaks.emit('player.ended');\n      this._playingSegment = false;\n      return;\n    }\n  }\n\n  window.requestAnimationFrame(this._playSegmentTimerCallback);\n};\n\nexport default Player;\n","/**\n * @file\n *\n * Defines the {@link DefaultPointMarker} class.\n *\n * @module default-point-marker\n */\n\nimport { Line } from 'konva/lib/shapes/Line';\nimport { Rect } from 'konva/lib/shapes/Rect';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Creates a point marker handle.\n *\n * @class\n * @alias DefaultPointMarker\n *\n * @param {CreatePointMarkerOptions} options\n */\n\nfunction DefaultPointMarker(options) {\n  this._options = options;\n}\n\nDefaultPointMarker.prototype.init = function(group) {\n  var handleWidth  = 10;\n  var handleHeight = 20;\n  var handleX      = -(handleWidth / 2) + 0.5; // Place in the middle of the marker\n\n  // Label\n\n  if (this._options.view === 'zoomview') {\n    // Label - create with default y, the real value is set in fitToView().\n    this._label = new Text({\n      x:          2,\n      y:          0,\n      text:       this._options.point.labelText,\n      textAlign:  'left',\n      fontFamily: this._options.fontFamily || 'sans-serif',\n      fontSize:   this._options.fontSize || 10,\n      fontStyle:  this._options.fontStyle || 'normal',\n      fill:       '#000'\n    });\n  }\n\n  // Handle - create with default y, the real value is set in fitToView().\n\n  if (this._options.draggable) {\n    this._handle = new Rect({\n      x:      handleX,\n      y:      0,\n      width:  handleWidth,\n      height: handleHeight,\n      fill:   this._options.color\n    });\n  }\n\n  // Line - create with default y and points, the real values\n  // are set in fitToView().\n  this._line = new Line({\n    x:           0,\n    y:           0,\n    stroke:      this._options.color,\n    strokeWidth: 1\n  });\n\n  // Time label\n\n  if (this._handle) {\n    // Time - create with default y, the real value is set in fitToView().\n    this._time = new Text({\n      x:          -24,\n      y:          0,\n      text:       this._options.layer.formatTime(this._options.point.time),\n      fontFamily: this._options.fontFamily,\n      fontSize:   this._options.fontSize,\n      fontStyle:  this._options.fontStyle,\n      fill:       '#000',\n      textAlign:  'center'\n    });\n\n    this._time.hide();\n  }\n\n  if (this._handle) {\n    group.add(this._handle);\n  }\n\n  group.add(this._line);\n\n  if (this._label) {\n    group.add(this._label);\n  }\n\n  if (this._time) {\n    group.add(this._time);\n  }\n\n  this.fitToView();\n\n  this.bindEventHandlers(group);\n};\n\nDefaultPointMarker.prototype.bindEventHandlers = function(group) {\n  var self = this;\n\n  if (self._handle) {\n    self._handle.on('mouseover touchstart', function() {\n      // Position text to the left of the marker\n      self._time.setX(-24 - self._time.getWidth());\n      self._time.show();\n    });\n\n    self._handle.on('mouseout touchend', function() {\n      self._time.hide();\n    });\n\n    group.on('dragstart', function() {\n      self._time.setX(-24 - self._time.getWidth());\n      self._time.show();\n    });\n\n    group.on('dragend', function() {\n      self._time.hide();\n    });\n  }\n};\n\nDefaultPointMarker.prototype.fitToView = function() {\n  var height = this._options.layer.getHeight();\n\n  this._line.points([0.5, 0, 0.5, height]);\n\n  if (this._label) {\n    this._label.y(12);\n  }\n\n  if (this._handle) {\n    this._handle.y(height / 2 - 10.5);\n  }\n\n  if (this._time) {\n    this._time.y(height / 2 - 5);\n  }\n};\n\nDefaultPointMarker.prototype.timeUpdated = function(time) {\n  if (this._time) {\n    this._time.setText(this._options.layer.formatTime(time));\n  }\n};\n\nexport default DefaultPointMarker;\n","/**\n * @file\n *\n * Defines the {@link DefaultSegmentMarker} class.\n *\n * @module default-segment-marker\n */\n\nimport { Line } from 'konva/lib/shapes/Line';\nimport { Rect } from 'konva/lib/shapes/Rect';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Creates a segment marker handle.\n *\n * @class\n * @alias DefaultSegmentMarker\n *\n * @param {CreateSegmentMarkerOptions} options\n */\n\nfunction DefaultSegmentMarker(options) {\n  this._options = options;\n}\n\nDefaultSegmentMarker.prototype.init = function(group) {\n  var handleWidth  = 10;\n  var handleHeight = 20;\n  var handleX      = -(handleWidth / 2) + 0.5; // Place in the middle of the marker\n\n  var xPosition = this._options.startMarker ? -24 : 24;\n\n  var time = this._options.startMarker ? this._options.segment.startTime :\n                                         this._options.segment.endTime;\n\n  // Label - create with default y, the real value is set in fitToView().\n  this._label = new Text({\n    x:          xPosition,\n    y:          0,\n    text:       this._options.layer.formatTime(time),\n    fontFamily: this._options.fontFamily,\n    fontSize:   this._options.fontSize,\n    fontStyle:  this._options.fontStyle,\n    fill:       '#000',\n    textAlign:  'center'\n  });\n\n  this._label.hide();\n\n  // Handle - create with default y, the real value is set in fitToView().\n  this._handle = new Rect({\n    x:           handleX,\n    y:           0,\n    width:       handleWidth,\n    height:      handleHeight,\n    fill:        this._options.color,\n    stroke:      this._options.color,\n    strokeWidth: 1\n  });\n\n  // Vertical Line - create with default y and points, the real values\n  // are set in fitToView().\n  this._line = new Line({\n    x:           0,\n    y:           0,\n    stroke:      this._options.color,\n    strokeWidth: 1\n  });\n\n  group.add(this._label);\n  group.add(this._line);\n  group.add(this._handle);\n\n  this.fitToView();\n\n  this.bindEventHandlers(group);\n};\n\nDefaultSegmentMarker.prototype.bindEventHandlers = function(group) {\n  var self = this;\n\n  var xPosition = self._options.startMarker ? -24 : 24;\n\n  if (self._options.draggable) {\n    group.on('dragstart', function() {\n      if (self._options.startMarker) {\n        self._label.setX(xPosition - self._label.getWidth());\n      }\n\n      self._label.show();\n    });\n\n    group.on('dragend', function() {\n      self._label.hide();\n    });\n  }\n\n  self._handle.on('mouseover touchstart', function() {\n    if (self._options.startMarker) {\n      self._label.setX(xPosition - self._label.getWidth());\n    }\n\n    self._label.show();\n  });\n\n  self._handle.on('mouseout touchend', function() {\n    self._label.hide();\n  });\n};\n\nDefaultSegmentMarker.prototype.fitToView = function() {\n  var height = this._options.layer.getHeight();\n\n  this._label.y(height / 2 - 5);\n  this._handle.y(height / 2 - 10.5);\n  this._line.points([0.5, 0, 0.5, height]);\n};\n\nDefaultSegmentMarker.prototype.timeUpdated = function(time) {\n  this._label.setText(this._options.layer.formatTime(time));\n};\n\nexport default DefaultSegmentMarker;\n","/**\n * @file\n *\n * Factory functions for creating point and segment marker handles.\n *\n * @module marker-factories\n */\n\nimport DefaultPointMarker from './default-point-marker';\nimport DefaultSegmentMarker from './default-segment-marker';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Parameters for the {@link createSegmentMarker} function.\n *\n * @typedef {Object} CreateSegmentMarkerOptions\n * @global\n * @property {Segment} segment\n * @property {Boolean} draggable If true, marker is draggable.\n * @property {Boolean} startMarker\n * @property {String} color\n * @property {String} fontFamily\n * @property {Number} fontSize\n * @property {String} fontStyle\n * @property {Layer} layer\n * @property {String} view\n */\n\n/**\n * Creates a left or right side segment marker handle.\n *\n * @param {CreateSegmentMarkerOptions} options\n * @returns {Marker}\n */\n\nexport function createSegmentMarker(options) {\n  if (options.view === 'zoomview') {\n    return new DefaultSegmentMarker(options);\n  }\n\n  return null;\n}\n\n/**\n * Parameters for the {@link createSegmentLabel} function.\n *\n * @typedef {Object} SegmentLabelOptions\n * @global\n * @property {Segment} segment The {@link Segment} object associated with this\n *   label.\n * @property {String} view The name of the view that the label is being\n *   created in, either <code>zoomview</code> or <code>overview</code>.\n * @property {SegmentsLayer} layer\n * @property {String} fontFamily\n * @property {Number} fontSize\n * @property {String} fontStyle\n */\n\n/**\n * Creates a Konva object that renders information about a segment, such as\n * its label text.\n *\n * @param {SegmentLabelOptions} options\n * @returns {Konva.Text}\n */\n\nexport function createSegmentLabel(options) {\n  return new Text({\n    x:          12,\n    y:          12,\n    text:       options.segment.labelText,\n    textAlign:  'center',\n    fontFamily: options.fontFamily || 'sans-serif',\n    fontSize:   options.fontSize || 12,\n    fontStyle:  options.fontStyle || 'normal',\n    fill:       '#000'\n  });\n}\n\n/**\n * Parameters for the {@link createPointMarker} function.\n *\n * @typedef {Object} CreatePointMarkerOptions\n * @global\n * @property {Point} point\n * @property {Boolean} draggable If true, marker is draggable.\n * @property {String} color\n * @property {Layer} layer\n * @property {String} view\n * @property {String} fontFamily\n * @property {Number} fontSize\n * @property {String} fontStyle\n */\n\n/**\n * Creates a point marker handle.\n *\n * @param {CreatePointMarkerOptions} options\n * @returns {Marker}\n */\n\nexport function createPointMarker(options) {\n  return new DefaultPointMarker(options);\n}\n","/**\n * @file\n *\n * Defines the {@link HighlightLayer} class.\n *\n * @module highlight-layer\n */\n\nimport { clamp } from  './utils';\nimport Konva from 'konva/lib/Core';\nimport { Rect } from 'konva/lib/shapes/Rect';\n\n/**\n * Creates the highlight region that shows the position of the zoomable\n * waveform view in the overview waveform.\n *\n * @class\n * @alias HighlightLayer\n *\n * @param {WaveformOverview} view\n * @param {Number} offset\n * @param {String} color\n */\n\nfunction HighlightLayer(view, offset, color) {\n  this._view          = view;\n  this._offset        = offset;\n  this._color         = color;\n  this._layer         = new Konva.Layer({ listening: false });\n  this._highlightRect = null;\n  this._startTime     = null;\n  this._endTime       = null;\n}\n\nHighlightLayer.prototype.addToStage = function(stage) {\n  stage.add(this._layer);\n};\n\nHighlightLayer.prototype.showHighlight = function(startTime, endTime) {\n  if (!this._highlightRect) {\n    this._createHighlightRect(startTime, endTime);\n  }\n\n  this._update(startTime, endTime);\n};\n\n/**\n * Updates the position of the highlight region.\n *\n * @param {Number} startTime The start of the highlight region, in seconds.\n * @param {Number} endTime The end of the highlight region, in seconds.\n */\n\nHighlightLayer.prototype._update = function(startTime, endTime) {\n  this._startTime = startTime;\n  this._endTime = endTime;\n\n  var startOffset = this._view.timeToPixels(startTime);\n  var endOffset   = this._view.timeToPixels(endTime);\n\n  this._highlightRect.setAttrs({\n    x:     startOffset,\n    width: endOffset - startOffset\n  });\n};\n\nHighlightLayer.prototype._createHighlightRect = function(startTime, endTime) {\n  this._startTime = startTime;\n  this._endTime   = endTime;\n\n  var startOffset = this._view.timeToPixels(startTime);\n  var endOffset   = this._view.timeToPixels(endTime);\n\n  // Create with default y and height, the real values are set in fitToView().\n  this._highlightRect = new Rect({\n    startOffset:  0,\n    y:            0,\n    width:        endOffset - startOffset,\n    stroke:       this._color,\n    strokeWidth:  1,\n    height:       0,\n    fill:         this._color,\n    opacity:      0.3,\n    cornerRadius: 2\n  });\n\n  this.fitToView();\n\n  this._layer.add(this._highlightRect);\n};\n\nHighlightLayer.prototype.removeHighlight = function() {\n  if (this._highlightRect) {\n    this._highlightRect.destroy();\n    this._highlightRect = null;\n  }\n};\n\nHighlightLayer.prototype.updateHighlight = function() {\n  if (this._highlightRect) {\n    this._update(this._startTime, this._endTime);\n  }\n};\n\nHighlightLayer.prototype.fitToView = function() {\n  if (this._highlightRect) {\n    var height = this._view.getHeight();\n    var offset = clamp(this._offset, 0, Math.floor(height / 2));\n\n    this._highlightRect.setAttrs({\n      y: offset,\n      height: height - (offset * 2)\n    });\n  }\n};\n\nexport default HighlightLayer;\n","/**\n * @file\n *\n * Defines the {@link MouseDragHandler} class.\n *\n * @module mouse-drag-handler\n */\n\nimport Konva from 'konva/lib/Core';\n\nfunction getMarkerObject(obj) {\n  while (obj.parent !== null) {\n    if (obj.parent instanceof Konva.Layer) {\n      return obj;\n    }\n\n    obj = obj.parent;\n  }\n\n  return null;\n}\n\n/**\n * An object to receive callbacks on mouse drag events. Each function is\n * called with the current mouse X position, relative to the stage's\n * container HTML element.\n *\n * @typedef {Object} MouseDragHandlers\n * @global\n * @property {Function} onMouseDown Mouse down event handler.\n * @property {Function} onMouseMove Mouse move event handler.\n * @property {Function} onMouseUp Mouse up event handler.\n */\n\n/**\n * Creates a handler for mouse events to allow interaction with the waveform\n * views by clicking and dragging the mouse.\n *\n * @class\n * @alias MouseDragHandler\n *\n * @param {Konva.Stage} stage\n * @param {MouseDragHandlers} handlers\n */\n\nfunction MouseDragHandler(stage, handlers) {\n  this._stage     = stage;\n  this._handlers  = handlers;\n  this._dragging  = false;\n  this._mouseDown = this._mouseDown.bind(this);\n  this._mouseUp   = this._mouseUp.bind(this);\n  this._mouseMove = this._mouseMove.bind(this);\n\n  this._stage.on('mousedown', this._mouseDown);\n  this._stage.on('touchstart', this._mouseDown);\n\n  this._lastMouseClientX = null;\n}\n\n/**\n * Mouse down event handler.\n *\n * @param {MouseEvent} event\n */\n\nMouseDragHandler.prototype._mouseDown = function(event) {\n  var marker = getMarkerObject(event.target);\n\n  // Avoid interfering with drag/drop of point and segment markers.\n  if (marker && marker.attrs.draggable) {\n    return;\n  }\n\n  this._lastMouseClientX = Math.floor(\n    event.type === 'touchstart' ? event.evt.touches[0].clientX : event.evt.clientX\n  );\n\n  if (this._handlers.onMouseDown) {\n    var mouseDownPosX = this._getMousePosX(this._lastMouseClientX);\n\n    this._handlers.onMouseDown(mouseDownPosX);\n  }\n\n  // Use the window mousemove and mouseup handlers instead of the\n  // Konva.Stage ones so that we still receive events if the user moves the\n  // mouse outside the stage.\n  window.addEventListener('mousemove', this._mouseMove, false);\n  window.addEventListener('touchmove', this._mouseMove, false);\n  window.addEventListener('mouseup', this._mouseUp, false);\n  window.addEventListener('touchend', this._mouseUp, false);\n  window.addEventListener('blur', this._mouseUp, false);\n};\n\n/**\n * Mouse move event handler.\n *\n * @param {MouseEvent} event\n */\n\nMouseDragHandler.prototype._mouseMove = function(event) {\n  var clientX = Math.floor(\n    event.type === 'touchmove' ? event.changedTouches[0].clientX : event.clientX\n  );\n\n  // Don't update on vertical mouse movement.\n  if (clientX === this._lastMouseClientX) {\n    return;\n  }\n\n  this._lastMouseClientX = clientX;\n\n  this._dragging = true;\n\n  if (this._handlers.onMouseMove) {\n    var mousePosX = this._getMousePosX(clientX);\n\n    this._handlers.onMouseMove(mousePosX);\n  }\n};\n\n/**\n * Mouse up event handler.\n *\n * @param {MouseEvent} event\n */\n\nMouseDragHandler.prototype._mouseUp = function(event) {\n  var clientX;\n\n  if (event.type === 'touchend') {\n    clientX = Math.floor(event.changedTouches[0].clientX);\n\n    if (event.cancelable) {\n      event.preventDefault();\n    }\n  }\n  else {\n    clientX = Math.floor(event.clientX);\n  }\n\n  if (this._handlers.onMouseUp) {\n    var mousePosX = this._getMousePosX(clientX);\n\n    this._handlers.onMouseUp(mousePosX);\n  }\n\n  window.removeEventListener('mousemove', this._mouseMove, false);\n  window.removeEventListener('touchmove', this._mouseMove, false);\n  window.removeEventListener('mouseup', this._mouseUp, false);\n  window.removeEventListener('touchend', this._mouseUp, false);\n  window.removeEventListener('blur', this._mouseUp, false);\n\n  this._dragging = false;\n};\n\n/**\n * @returns {Number} The mouse X position, relative to the container that\n * received the mouse down event.\n *\n * @private\n * @param {Number} clientX Mouse client X position.\n */\n\nMouseDragHandler.prototype._getMousePosX = function(clientX) {\n  var containerPos = this._stage.getContainer().getBoundingClientRect();\n\n  return clientX - containerPos.left;\n};\n\n/**\n * Returns <code>true</code> if the mouse is being dragged, i.e., moved with\n * the mouse button held down.\n *\n * @returns {Boolean}\n */\n\nMouseDragHandler.prototype.isDragging = function() {\n  return this._dragging;\n};\n\nexport default MouseDragHandler;\n","/**\n * @file\n *\n * Defines the {@link PlayheadLayer} class.\n *\n * @module playhead-layer\n */\n\nimport Konva from 'konva/lib/Core';\nimport { Animation } from 'konva/lib/Animation';\nimport { Line } from 'konva/lib/shapes/Line';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Creates a Konva.Layer that displays a playhead marker.\n *\n * @class\n * @alias PlayheadLayer\n *\n * @param {Object} options\n * @param {Player} options.player\n * @param {WaveformOverview|WaveformZoomView} options.view\n * @param {Boolean} options.showPlayheadTime If <code>true</code> The playback time position\n *   is shown next to the playhead.\n * @param {String} options.playheadColor\n * @param {String} options.playheadTextColor\n * @param {String} options.playheadFontFamily\n * @param {Number} options.playheadFontSize\n * @param {String} options.playheadFontStyle\n */\n\nfunction PlayheadLayer(options) {\n  this._player = options.player;\n  this._view = options.view;\n  this._playheadPixel = 0;\n  this._playheadLineAnimation = null;\n  this._playheadVisible = false;\n  this._playheadColor = options.playheadColor;\n  this._playheadTextColor = options.playheadTextColor;\n\n  this._playheadFontFamily = options.playheadFontFamily;\n  this._playheadFontSize = options.playheadFontSize;\n  this._playheadFontStyle = options.playheadFontStyle;\n\n  this._playheadLayer = new Konva.Layer();\n\n  this._createPlayhead(this._playheadColor);\n\n  if (options.showPlayheadTime) {\n    this._createPlayheadText(this._playheadTextColor);\n  }\n\n  this.fitToView();\n\n  this.zoomLevelChanged();\n}\n\n/**\n * Adds the layer to the given {Konva.Stage}.\n *\n * @param {Konva.Stage} stage\n */\n\nPlayheadLayer.prototype.addToStage = function(stage) {\n  stage.add(this._playheadLayer);\n};\n\n/**\n * Decides whether to use an animation to update the playhead position.\n *\n * If the zoom level is such that the number of pixels per second of audio is\n * low, we can use timeupdate events from the HTMLMediaElement to\n * set the playhead position. Otherwise, we use an animation to update the\n * playhead position more smoothly. The animation is CPU intensive, so we\n * avoid using it where possible.\n */\n\nPlayheadLayer.prototype.zoomLevelChanged = function() {\n  var pixelsPerSecond = this._view.timeToPixels(1.0);\n  var time;\n\n  this._useAnimation = pixelsPerSecond >= 5;\n\n  if (this._useAnimation) {\n    if (this._player.isPlaying() && !this._playheadLineAnimation) {\n      // Start the animation\n      this._start();\n    }\n  }\n  else {\n    if (this._playheadLineAnimation) {\n      // Stop the animation\n      time = this._player.getCurrentTime();\n\n      this.stop(time);\n    }\n  }\n};\n\n/**\n * Resizes the playhead UI objects to fit the available space in the\n * view.\n */\n\nPlayheadLayer.prototype.fitToView = function() {\n  var height = this._view.getHeight();\n\n  this._playheadLine.points([0.5, 0, 0.5, height]);\n\n  if (this._playheadText) {\n    this._playheadText.y(12);\n  }\n};\n\n/**\n * Creates the playhead UI objects.\n *\n * @private\n * @param {String} color\n */\n\nPlayheadLayer.prototype._createPlayhead = function(color) {\n  // Create with default points, the real values are set in fitToView().\n  this._playheadLine = new Line({\n    stroke:      color,\n    strokeWidth: 1\n  });\n\n  this._playheadGroup = new Konva.Group({\n    x: 0,\n    y: 0\n  });\n\n  this._playheadGroup.add(this._playheadLine);\n  this._playheadLayer.add(this._playheadGroup);\n};\n\nPlayheadLayer.prototype._createPlayheadText = function(color) {\n  var time = this._player.getCurrentTime();\n  var text = this._view.formatTime(time);\n\n  // Create with default y, the real value is set in fitToView().\n  this._playheadText = new Text({\n    x: 2,\n    y: 0,\n    text: text,\n    fontSize: this._playheadFontSize,\n    fontFamily: this._playheadFontFamily,\n    fontStyle: this._playheadFontStyle,\n    fill: color,\n    align: 'right'\n  });\n\n  this._playheadGroup.add(this._playheadText);\n};\n\n/**\n * Updates the playhead position.\n *\n * @param {Number} time Current playhead position, in seconds.\n */\n\nPlayheadLayer.prototype.updatePlayheadTime = function(time) {\n  this._syncPlayhead(time);\n\n  if (this._player.isPlaying()) {\n    this._start();\n  }\n};\n\n/**\n * Updates the playhead position.\n *\n * @private\n * @param {Number} time Current playhead position, in seconds.\n */\n\nPlayheadLayer.prototype._syncPlayhead = function(time) {\n  var pixelIndex = this._view.timeToPixels(time);\n\n  var frameOffset = this._view.getFrameOffset();\n  var width = this._view.getWidth();\n\n  var isVisible = (pixelIndex >= frameOffset) &&\n                  (pixelIndex <= frameOffset + width);\n\n  this._playheadPixel = pixelIndex;\n\n  if (isVisible) {\n    var playheadX = this._playheadPixel - frameOffset;\n\n    if (!this._playheadVisible) {\n      this._playheadVisible = true;\n      this._playheadGroup.show();\n    }\n\n    this._playheadGroup.setX(playheadX);\n\n    if (this._playheadText) {\n      var text = this._view.formatTime(time);\n      var playheadTextWidth = this._playheadText.getTextWidth();\n\n      this._playheadText.setText(text);\n\n      if (playheadTextWidth + playheadX > width - 2) {\n        this._playheadText.setX(-playheadTextWidth - 2);\n      }\n      else if (playheadTextWidth + playheadX < width) {\n        this._playheadText.setX(2);\n      }\n    }\n  }\n  else {\n    if (this._playheadVisible) {\n      this._playheadVisible = false;\n      this._playheadGroup.hide();\n    }\n  }\n\n  if (this._view.playheadPosChanged) {\n    this._view.playheadPosChanged(time);\n  }\n};\n\n/**\n * Starts a playhead animation in sync with the media playback.\n *\n * @private\n */\n\nPlayheadLayer.prototype._start = function() {\n  var self = this;\n\n  if (self._playheadLineAnimation) {\n    self._playheadLineAnimation.stop();\n    self._playheadLineAnimation = null;\n  }\n\n  if (!self._useAnimation) {\n    return;\n  }\n\n  var lastPlayheadPosition = null;\n\n  self._playheadLineAnimation = new Animation(function() {\n    var time = self._player.getCurrentTime();\n    var playheadPosition = self._view.timeToPixels(time);\n\n    if (playheadPosition !== lastPlayheadPosition) {\n      self._syncPlayhead(time);\n      lastPlayheadPosition = playheadPosition;\n    }\n  }, self._playheadLayer);\n\n  self._playheadLineAnimation.start();\n};\n\nPlayheadLayer.prototype.stop = function(time) {\n  if (this._playheadLineAnimation) {\n    this._playheadLineAnimation.stop();\n    this._playheadLineAnimation = null;\n  }\n\n  this._syncPlayhead(time);\n};\n\n/**\n * Returns the position of the playhead marker, in pixels relative to the\n * left hand side of the waveform view.\n *\n * @return {Number}\n */\n\nPlayheadLayer.prototype.getPlayheadOffset = function() {\n  return this._playheadPixel - this._view.getFrameOffset();\n};\n\nPlayheadLayer.prototype.getPlayheadPixel = function() {\n  return this._playheadPixel;\n};\n\nPlayheadLayer.prototype.showPlayheadTime = function(show) {\n  if (show) {\n    if (!this._playheadText) {\n      // Create it\n      this._createPlayheadText(this._playheadTextColor);\n      this.fitToView();\n    }\n  }\n  else {\n    if (this._playheadText) {\n      this._playheadText.remove();\n      this._playheadText.destroy();\n      this._playheadText = null;\n    }\n  }\n};\n\nPlayheadLayer.prototype.updatePlayheadText = function() {\n  if (this._playheadText) {\n    var time = this._player.getCurrentTime();\n    var text = this._view.formatTime(time);\n\n    this._playheadText.setText(text);\n  }\n};\n\nPlayheadLayer.prototype.destroy = function() {\n  if (this._playheadLineAnimation) {\n    this._playheadLineAnimation.stop();\n    this._playheadLineAnimation = null;\n  }\n};\n\nexport default PlayheadLayer;\n","/**\n * @file\n *\n * Defines the {@link PointMarker} class.\n *\n * @module point-marker\n */\n\nimport Konva from 'konva/lib/Core';\n\n/**\n * Parameters for the {@link PointMarker} constructor.\n *\n * @typedef {Object} PointMarkerOptions\n * @global\n * @property {Point} point Point object with timestamp.\n * @property {Boolean} draggable If true, marker is draggable.\n * @property {Marker} marker\n * @property {Function} onDblClick\n * @property {Function} onDragStart\n * @property {Function} onDragMove Callback during mouse drag operations.\n * @property {Function} onDragEnd\n * @property {Function} onMouseEnter\n * @property {Function} onMouseLeave\n */\n\n/**\n * Creates a point marker handle.\n *\n * @class\n * @alias PointMarker\n *\n * @param {PointMarkerOptions} options\n */\n\nfunction PointMarker(options) {\n  this._point     = options.point;\n  this._marker    = options.marker;\n  this._draggable = options.draggable;\n\n  this._onClick      = options.onClick;\n  this._onDblClick   = options.onDblClick;\n  this._onDragStart  = options.onDragStart;\n  this._onDragMove   = options.onDragMove;\n  this._onDragEnd    = options.onDragEnd;\n  this._onMouseEnter = options.onMouseEnter;\n  this._onMouseLeave = options.onMouseLeave;\n\n  this._dragBoundFunc = this._dragBoundFunc.bind(this);\n\n  this._group = new Konva.Group({\n    draggable:     this._draggable,\n    dragBoundFunc: this._dragBoundFunc\n  });\n\n  this._bindDefaultEventHandlers();\n\n  this._marker.init(this._group);\n}\n\nPointMarker.prototype._bindDefaultEventHandlers = function() {\n  var self = this;\n\n  self._group.on('dragstart', function() {\n    self._onDragStart(self._point);\n  });\n\n  self._group.on('dragmove', function() {\n    self._onDragMove(self._point);\n  });\n\n  self._group.on('dragend', function() {\n    self._onDragEnd(self._point);\n  });\n\n  self._group.on('click', function() {\n    self._onClick(self._point);\n  });\n\n  self._group.on('dblclick', function() {\n    self._onDblClick(self._point);\n  });\n\n  self._group.on('mouseenter', function() {\n    self._onMouseEnter(self._point);\n  });\n\n  self._group.on('mouseleave', function() {\n    self._onMouseLeave(self._point);\n  });\n};\n\nPointMarker.prototype._dragBoundFunc = function(pos) {\n  // Allow the marker to be moved horizontally but not vertically.\n  return {\n    x: pos.x,\n    y: this._group.getAbsolutePosition().y\n  };\n};\n\n/**\n * @param {Konva.Layer} layer\n */\n\nPointMarker.prototype.addToLayer = function(layer) {\n  layer.add(this._group);\n};\n\nPointMarker.prototype.fitToView = function() {\n  this._marker.fitToView();\n};\n\nPointMarker.prototype.getPoint = function() {\n  return this._point;\n};\n\nPointMarker.prototype.getX = function() {\n  return this._group.getX();\n};\n\nPointMarker.prototype.getWidth = function() {\n  return this._group.getWidth();\n};\n\nPointMarker.prototype.setX = function(x) {\n  this._group.setX(x);\n};\n\nPointMarker.prototype.timeUpdated = function(time) {\n  if (this._marker.timeUpdated) {\n    this._marker.timeUpdated(time);\n  }\n};\n\nPointMarker.prototype.destroy = function() {\n  if (this._marker.destroy) {\n    this._marker.destroy();\n  }\n\n  this._group.destroyChildren();\n  this._group.destroy();\n};\n\nexport default PointMarker;\n","/**\n * @file\n *\n * Defines the {@link PointsLayer} class.\n *\n * @module points-layer\n */\n\nimport PointMarker from './point-marker';\nimport { objectHasProperty } from './utils';\nimport Konva from 'konva/lib/Core';\n\nvar defaultFontFamily = 'sans-serif';\nvar defaultFontSize = 10;\nvar defaultFontShape = 'normal';\n\n/**\n * Creates a Konva.Layer that displays point markers against the audio\n * waveform.\n *\n * @class\n * @alias PointsLayer\n *\n * @param {Peaks} peaks\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Boolean} allowEditing\n */\n\nfunction PointsLayer(peaks, view, allowEditing) {\n  this._peaks        = peaks;\n  this._view         = view;\n  this._allowEditing = allowEditing;\n  this._pointMarkers = {};\n  this._layer        = new Konva.Layer();\n\n  this._onPointsDrag = this._onPointsDrag.bind(this);\n\n  this._onPointHandleClick      = this._onPointHandleClick.bind(this);\n  this._onPointHandleDblClick   = this._onPointHandleDblClick.bind(this);\n  this._onPointHandleDragStart  = this._onPointHandleDragStart.bind(this);\n  this._onPointHandleDragMove   = this._onPointHandleDragMove.bind(this);\n  this._onPointHandleDragEnd    = this._onPointHandleDragEnd.bind(this);\n  this._onPointHandleMouseEnter = this._onPointHandleMouseEnter.bind(this);\n  this._onPointHandleMouseLeave = this._onPointHandleMouseLeave.bind(this);\n\n  this._onPointsUpdate    = this._onPointsUpdate.bind(this);\n  this._onPointsAdd       = this._onPointsAdd.bind(this);\n  this._onPointsRemove    = this._onPointsRemove.bind(this);\n  this._onPointsRemoveAll = this._onPointsRemoveAll.bind(this);\n\n  this._peaks.on('points.update', this._onPointsUpdate);\n  this._peaks.on('points.add', this._onPointsAdd);\n  this._peaks.on('points.remove', this._onPointsRemove);\n  this._peaks.on('points.remove_all', this._onPointsRemoveAll);\n\n  this._peaks.on('points.dragstart', this._onPointsDrag);\n  this._peaks.on('points.dragmove', this._onPointsDrag);\n  this._peaks.on('points.dragend', this._onPointsDrag);\n}\n\n/**\n * Adds the layer to the given {Konva.Stage}.\n *\n * @param {Konva.Stage} stage\n */\n\nPointsLayer.prototype.addToStage = function(stage) {\n  stage.add(this._layer);\n};\n\nPointsLayer.prototype.enableEditing = function(enable) {\n  this._allowEditing = enable;\n};\n\nPointsLayer.prototype.formatTime = function(time) {\n  return this._view.formatTime(time);\n};\n\nPointsLayer.prototype._onPointsUpdate = function(point) {\n  var frameStartTime = this._view.getStartTime();\n  var frameEndTime   = this._view.getEndTime();\n\n  this._removePoint(point);\n\n  if (point.isVisible(frameStartTime, frameEndTime)) {\n    this._addPointMarker(point);\n  }\n\n  this.updatePoints(frameStartTime, frameEndTime);\n};\n\nPointsLayer.prototype._onPointsAdd = function(points) {\n  var self = this;\n\n  var frameStartTime = self._view.getStartTime();\n  var frameEndTime   = self._view.getEndTime();\n\n  points.forEach(function(point) {\n    if (point.isVisible(frameStartTime, frameEndTime)) {\n      self._addPointMarker(point);\n    }\n  });\n\n  self.updatePoints(frameStartTime, frameEndTime);\n};\n\nPointsLayer.prototype._onPointsRemove = function(points) {\n  var self = this;\n\n  points.forEach(function(point) {\n    self._removePoint(point);\n  });\n};\n\nPointsLayer.prototype._onPointsRemoveAll = function() {\n  this._layer.removeChildren();\n  this._pointMarkers = {};\n};\n\nPointsLayer.prototype._onPointsDrag = function(point) {\n  this._updatePoint(point);\n};\n\n/**\n * Creates the Konva UI objects for a given point.\n *\n * @private\n * @param {Point} point\n * @returns {PointMarker}\n */\n\nPointsLayer.prototype._createPointMarker = function(point) {\n  var editable = this._allowEditing && point.editable;\n\n  var marker = this._peaks.options.createPointMarker({\n    point:      point,\n    draggable:  editable,\n    color:      point.color ? point.color : this._peaks.options.pointMarkerColor,\n    fontFamily: this._peaks.options.fontFamily || defaultFontFamily,\n    fontSize:   this._peaks.options.fontSize || defaultFontSize,\n    fontStyle:  this._peaks.options.fontStyle || defaultFontShape,\n    layer:      this,\n    view:       this._view.getName()\n  });\n\n  return new PointMarker({\n    point:        point,\n    draggable:    editable,\n    marker:       marker,\n    onClick:      this._onPointHandleClick,\n    onDblClick:   this._onPointHandleDblClick,\n    onDragStart:  this._onPointHandleDragStart,\n    onDragMove:   this._onPointHandleDragMove,\n    onDragEnd:    this._onPointHandleDragEnd,\n    onMouseEnter: this._onPointHandleMouseEnter,\n    onMouseLeave: this._onPointHandleMouseLeave\n  });\n};\n\nPointsLayer.prototype.getHeight = function() {\n  return this._view.getHeight();\n};\n\n/**\n * Adds a Konva UI object to the layer for a given point.\n *\n * @private\n * @param {Point} point\n * @returns {PointMarker}\n */\n\nPointsLayer.prototype._addPointMarker = function(point) {\n  var pointMarker = this._createPointMarker(point);\n\n  this._pointMarkers[point.id] = pointMarker;\n\n  pointMarker.addToLayer(this._layer);\n\n  return pointMarker;\n};\n\n/**\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointHandleDragMove = function(point) {\n  var pointMarker = this._pointMarkers[point.id];\n\n  var markerX = pointMarker.getX();\n\n  if (markerX >= 0 && markerX < this._view.getWidth()) {\n    var offset = markerX + pointMarker.getWidth();\n\n    point._setTime(this._view.pixelOffsetToTime(offset));\n\n    pointMarker.timeUpdated(point.time);\n  }\n\n  this._peaks.emit('points.dragmove', point);\n};\n\n/**\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointHandleMouseEnter = function(point) {\n  this._peaks.emit('points.mouseenter', point);\n};\n\n/**\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointHandleMouseLeave = function(point) {\n  this._peaks.emit('points.mouseleave', point);\n};\n\nPointsLayer.prototype._onPointHandleClick = function(point) {\n  this._peaks.emit('points.click', point);\n};\n\n/**\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointHandleDblClick = function(point) {\n  this._peaks.emit('points.dblclick', point);\n};\n\n/**\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointHandleDragStart = function(point) {\n  this._peaks.emit('points.dragstart', point);\n};\n\n/**\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointHandleDragEnd = function(point) {\n  this._peaks.emit('points.dragend', point);\n};\n\n/**\n * Updates the positions of all displayed points in the view.\n *\n * @param {Number} startTime The start of the visible range in the view,\n *   in seconds.\n * @param {Number} endTime The end of the visible range in the view,\n *   in seconds.\n */\n\nPointsLayer.prototype.updatePoints = function(startTime, endTime) {\n  // Update all points in the visible time range.\n  var points = this._peaks.points.find(startTime, endTime);\n\n  points.forEach(this._updatePoint.bind(this));\n\n  // TODO: in the overview all points are visible, so no need to check\n  this._removeInvisiblePoints(startTime, endTime);\n};\n\n/**\n * @private\n * @param {Point} point\n */\n\nPointsLayer.prototype._updatePoint = function(point) {\n  var pointMarker = this._findOrAddPointMarker(point);\n\n  var pointMarkerOffset = this._view.timeToPixels(point.time);\n\n  var pointMarkerX = pointMarkerOffset - this._view.getFrameOffset();\n\n  pointMarker.setX(pointMarkerX);\n};\n\n/**\n * @private\n * @param {Point} point\n * @return {PointMarker}\n */\n\nPointsLayer.prototype._findOrAddPointMarker = function(point) {\n  var pointMarker = this._pointMarkers[point.id];\n\n  if (!pointMarker) {\n    pointMarker = this._addPointMarker(point);\n  }\n\n  return pointMarker;\n};\n\n/**\n * Remove any points that are not visible, i.e., are outside the given time\n * range.\n *\n * @private\n * @param {Number} startTime The start of the visible time range, in seconds.\n * @param {Number} endTime The end of the visible time range, in seconds.\n * @returns {Number} The number of points removed.\n */\n\nPointsLayer.prototype._removeInvisiblePoints = function(startTime, endTime) {\n  var count = 0;\n\n  for (var pointId in this._pointMarkers) {\n    if (objectHasProperty(this._pointMarkers, pointId)) {\n      var point = this._pointMarkers[pointId].getPoint();\n\n      if (!point.isVisible(startTime, endTime)) {\n        this._removePoint(point);\n        count++;\n      }\n    }\n  }\n\n  return count;\n};\n\n/**\n * Removes the UI object for a given point.\n *\n * @private\n * @param {Point} point\n */\n\nPointsLayer.prototype._removePoint = function(point) {\n  var pointMarker = this._pointMarkers[point.id];\n\n  if (pointMarker) {\n    pointMarker.destroy();\n    delete this._pointMarkers[point.id];\n  }\n};\n\n/**\n * Toggles visibility of the points layer.\n *\n * @param {Boolean} visible\n */\n\nPointsLayer.prototype.setVisible = function(visible) {\n  this._layer.setVisible(visible);\n};\n\nPointsLayer.prototype.destroy = function() {\n  this._peaks.off('points.update', this._onPointsUpdate);\n  this._peaks.off('points.add', this._onPointsAdd);\n  this._peaks.off('points.remove', this._onPointsRemove);\n  this._peaks.off('points.remove_all', this._onPointsRemoveAll);\n  this._peaks.off('points.dragstart', this._onPointsDrag);\n  this._peaks.off('points.dragmove', this._onPointsDrag);\n  this._peaks.off('points.dragend', this._onPointsDrag);\n};\n\nPointsLayer.prototype.fitToView = function() {\n  for (var pointId in this._pointMarkers) {\n    if (objectHasProperty(this._pointMarkers, pointId)) {\n      var pointMarker = this._pointMarkers[pointId];\n\n      pointMarker.fitToView();\n    }\n  }\n};\n\nPointsLayer.prototype.draw = function() {\n  this._layer.draw();\n};\n\nexport default PointsLayer;\n","/**\n * @file\n *\n * Defines the {@link SegmentMarker} class.\n *\n * @module segment-marker\n */\n\nimport Konva from 'konva/lib/Core';\n\n/**\n * Parameters for the {@link SegmentMarker} constructor.\n *\n * @typedef {Object} SegmentMarkerOptions\n * @global\n * @property {Segment} segment\n * @property {SegmentShape} segmentShape\n * @property {Boolean} draggable If true, marker is draggable.\n * @property {Boolean} startMarker If <code>true</code>, the marker indicates\n *   the start time of the segment. If <code>false</code>, the marker\n *   indicates the end time of the segment.\n * @property {Function} onDrag\n * @property {Function} onDragStart\n * @property {Function} onDragEnd\n */\n\n/**\n * Creates a Left or Right side segment handle marker.\n *\n * @class\n * @alias SegmentMarker\n *\n * @param {SegmentMarkerOptions} options\n */\n\nfunction SegmentMarker(options) {\n  this._segment       = options.segment;\n  this._marker        = options.marker;\n  this._segmentShape  = options.segmentShape;\n  this._draggable     = options.draggable;\n  this._layer         = options.layer;\n  this._startMarker   = options.startMarker;\n\n  this._onDrag      = options.onDrag;\n  this._onDragStart = options.onDragStart;\n  this._onDragEnd   = options.onDragEnd;\n\n  this._dragBoundFunc = this._dragBoundFunc.bind(this);\n\n  this._group = new Konva.Group({\n    draggable:     this._draggable,\n    dragBoundFunc: this._dragBoundFunc\n  });\n\n  this._bindDefaultEventHandlers();\n\n  this._marker.init(this._group);\n}\n\nSegmentMarker.prototype._bindDefaultEventHandlers = function() {\n  var self = this;\n\n  if (self._draggable) {\n    self._group.on('dragmove', function() {\n      self._onDrag(self);\n    });\n\n    self._group.on('dragstart', function() {\n      self._onDragStart(self);\n    });\n\n    self._group.on('dragend', function() {\n      self._onDragEnd(self);\n    });\n  }\n};\n\nSegmentMarker.prototype._dragBoundFunc = function(pos) {\n  var marker;\n  var limit;\n\n  if (this._startMarker) {\n    marker = this._segmentShape.getEndMarker();\n    limit  = marker.getX() - marker.getWidth();\n\n    if (pos.x > limit) {\n      pos.x = limit;\n    }\n  }\n  else {\n    marker = this._segmentShape.getStartMarker();\n    limit  = marker.getX() + marker.getWidth();\n\n    if (pos.x < limit) {\n      pos.x = limit;\n    }\n  }\n\n  return {\n    x: pos.x,\n    y: this._group.getAbsolutePosition().y\n  };\n};\n\nSegmentMarker.prototype.addToLayer = function(layer) {\n  layer.add(this._group);\n};\n\nSegmentMarker.prototype.fitToView = function() {\n  this._marker.fitToView();\n};\n\nSegmentMarker.prototype.getSegment = function() {\n  return this._segment;\n};\n\nSegmentMarker.prototype.getX = function() {\n  return this._group.getX();\n};\n\nSegmentMarker.prototype.getWidth = function() {\n  return this._group.getWidth();\n};\n\nSegmentMarker.prototype.isStartMarker = function() {\n  return this._startMarker;\n};\n\nSegmentMarker.prototype.setX = function(x) {\n  this._group.setX(x);\n};\n\nSegmentMarker.prototype.timeUpdated = function(time) {\n  if (this._marker.timeUpdated) {\n    this._marker.timeUpdated(time);\n  }\n};\n\nSegmentMarker.prototype.destroy = function() {\n  if (this._marker.destroy) {\n    this._marker.destroy();\n  }\n\n  this._group.destroyChildren();\n  this._group.destroy();\n};\n\nexport default SegmentMarker;\n","/**\n * @file\n *\n * Defines the {@link WaveformShape} class.\n *\n * @module waveform-shape\n */\n\nimport { clamp, isLinearGradientColor, isString } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Waveform shape options.\n *\n * @typedef {Object} WaveformShapeOptions\n * @global\n * @property {String | LinearGradientColor} color Waveform color.\n * @property {WaveformOverview|WaveformZoomView} view The view object\n *   that contains the waveform shape.\n * @property {Segment?} segment If given, render a waveform image\n *   covering the segment's time range. Otherwise, render the entire\n *   waveform duration.\n */\n\n/**\n * Creates a Konva.Shape object that renders a waveform image.\n *\n * @class\n * @alias WaveformShape\n *\n * @param {WaveformShapeOptions} options\n */\n\nfunction WaveformShape(options) {\n  this._color = options.color;\n\n  var shapeOptions = {};\n\n  if (isString(options.color)) {\n    shapeOptions.fill = options.color;\n  }\n  else if (isLinearGradientColor(options.color)) {\n    var startY = options.view._height * (options.color.linearGradientStart / 100);\n    var endY = options.view._height * (options.color.linearGradientEnd / 100);\n\n    shapeOptions.fillLinearGradientStartPointY = startY;\n    shapeOptions.fillLinearGradientEndPointY = endY;\n    shapeOptions.fillLinearGradientColorStops = [\n      0, options.color.linearGradientColorStops[0],\n      1, options.color.linearGradientColorStops[1]\n    ];\n  }\n  else {\n    throw new TypeError('Unknown type for color property');\n  }\n\n  this._shape = new Konva.Shape(shapeOptions);\n  this._view = options.view;\n  this._segment = options.segment;\n\n  this._shape.sceneFunc(this._sceneFunc.bind(this));\n  this._shape.hitFunc(this._waveformShapeHitFunc.bind(this));\n}\n\n// WaveformShape.prototype = Object.create(Konva.Shape.prototype);\n\nWaveformShape.prototype.setSegment = function(segment) {\n  this._segment = segment;\n};\n\nWaveformShape.prototype.setWaveformColor = function(color) {\n  if (isString(color)) {\n    this._shape.fill(color);\n\n    this._shape.fillLinearGradientStartPointY(null);\n    this._shape.fillLinearGradientEndPointY(null);\n    this._shape.fillLinearGradientColorStops(null);\n  }\n  else if (isLinearGradientColor(color)) {\n    this._shape.fill(null);\n\n    var startY = this._view._height * (color.linearGradientStart / 100);\n    var endY = this._view._height * (color.linearGradientEnd / 100);\n\n    this._shape.fillLinearGradientStartPointY(startY);\n    this._shape.fillLinearGradientEndPointY(endY);\n    this._shape.fillLinearGradientColorStops([\n      0, color.linearGradientColorStops[0],\n      1, color.linearGradientColorStops[1]\n    ]);\n  }\n  else {\n    throw new TypeError('Unknown type for color property');\n  }\n};\n\nWaveformShape.prototype.fitToView = function() {\n  this.setWaveformColor(this._color);\n};\n\nWaveformShape.prototype._sceneFunc = function(context) {\n  var frameOffset = this._view.getFrameOffset();\n  var width = this._view.getWidth();\n  var height = this._view.getHeight();\n\n  this._drawWaveform(\n    context,\n    this._view.getWaveformData(),\n    frameOffset,\n    this._segment ? this._view.timeToPixels(this._segment.startTime) : frameOffset,\n    this._segment ? this._view.timeToPixels(this._segment.endTime)   : frameOffset + width,\n    width,\n    height\n  );\n};\n\n/**\n * Draws a waveform on a canvas context.\n *\n * @param {Konva.Context} context The canvas context to draw on.\n * @param {WaveformData} waveformData The waveform data to draw.\n * @param {Number} frameOffset The start position of the waveform shown\n *   in the view, in pixels.\n * @param {Number} startPixels The start position of the waveform to draw,\n *   in pixels.\n * @param {Number} endPixels The end position of the waveform to draw,\n *   in pixels.\n * @param {Number} width The width of the waveform area, in pixels.\n * @param {Number} height The height of the waveform area, in pixels.\n */\n\nWaveformShape.prototype._drawWaveform = function(context, waveformData,\n    frameOffset, startPixels, endPixels, width, height) {\n  if (startPixels < frameOffset) {\n    startPixels = frameOffset;\n  }\n\n  var limit = frameOffset + width;\n\n  if (endPixels > limit) {\n    endPixels = limit;\n  }\n\n  if (endPixels > waveformData.length - 1) {\n    endPixels = waveformData.length - 1;\n  }\n\n  var channels = waveformData.channels;\n\n  var waveformTop = 0;\n  var waveformHeight = Math.floor(height / channels);\n\n  for (var i = 0; i < channels; i++) {\n    if (i === channels - 1) {\n      waveformHeight = height - (channels - 1) * waveformHeight;\n    }\n\n    this._drawChannel(\n      context,\n      waveformData.channel(i),\n      frameOffset,\n      startPixels,\n      endPixels,\n      waveformTop,\n      waveformHeight\n    );\n\n    waveformTop += waveformHeight;\n  }\n};\n\n/**\n * Draws a single waveform channel on a canvas context.\n *\n * @param {Konva.Context} context The canvas context to draw on.\n * @param {WaveformDataChannel} channel The waveform data to draw.\n * @param {Number} frameOffset The start position of the waveform shown\n *   in the view, in pixels.\n * @param {Number} startPixels The start position of the waveform to draw,\n *   in pixels.\n * @param {Number} endPixels The end position of the waveform to draw,\n *   in pixels.\n * @param {Number} top The top of the waveform channel area, in pixels.\n * @param {Number} height The height of the waveform channel area, in pixels.\n */\n\nWaveformShape.prototype._drawChannel = function(context, channel,\n    frameOffset, startPixels, endPixels, top, height) {\n  var x, amplitude;\n\n  var amplitudeScale = this._view.getAmplitudeScale();\n\n  var lineX, lineY;\n\n  context.beginPath();\n\n  for (x = startPixels; x <= endPixels; x++) {\n    amplitude = channel.min_sample(x);\n\n    lineX = x - frameOffset + 0.5;\n    lineY = top + WaveformShape.scaleY(amplitude, height, amplitudeScale) + 0.5;\n\n    context.lineTo(lineX, lineY);\n  }\n\n  for (x = endPixels; x >= startPixels; x--) {\n    amplitude = channel.max_sample(x);\n\n    lineX = x - frameOffset + 0.5;\n    lineY = top + WaveformShape.scaleY(amplitude, height, amplitudeScale) + 0.5;\n\n    context.lineTo(lineX, lineY);\n  }\n\n  context.closePath();\n\n  context.fillShape(this._shape);\n};\n\nWaveformShape.prototype._waveformShapeHitFunc = function(context) {\n  if (!this._segment) {\n    return;\n  }\n\n  var frameOffset = this._view.getFrameOffset();\n  var viewWidth = this._view.getWidth();\n  var viewHeight = this._view.getHeight();\n\n  var startPixels = this._view.timeToPixels(this._segment.startTime);\n  var endPixels   = this._view.timeToPixels(this._segment.endTime);\n\n  var offsetY = 10;\n  var hitRectHeight = viewHeight - 2 * offsetY;\n\n  if (hitRectHeight < 0) {\n    hitRectHeight = 0;\n  }\n\n  var hitRectLeft = startPixels - frameOffset;\n  var hitRectWidth = endPixels - startPixels;\n\n  if (hitRectLeft < 0) {\n    hitRectWidth -= -hitRectLeft;\n    hitRectLeft = 0;\n  }\n\n  if (hitRectLeft + hitRectWidth > viewWidth) {\n    hitRectWidth -= hitRectLeft + hitRectWidth - viewWidth;\n  }\n\n  context.beginPath();\n  context.rect(hitRectLeft, offsetY, hitRectWidth, hitRectHeight);\n  context.closePath();\n  context.fillStrokeShape(this._shape);\n};\n\nWaveformShape.prototype.addToLayer = function(layer) {\n  layer.add(this._shape);\n};\n\nWaveformShape.prototype.destroy = function() {\n  this._shape.destroy();\n  this._shape = null;\n};\n\nWaveformShape.prototype.on = function(event, handler) {\n  this._shape.on(event, handler);\n};\n\n/**\n * Scales the waveform data for drawing on a canvas context.\n *\n * @see {@link https://stats.stackexchange.com/questions/281162}\n *\n * @todo Assumes 8-bit waveform data (-128 to 127 range)\n *\n * @param {Number} amplitude The waveform data point amplitude.\n * @param {Number} height The height of the waveform, in pixels.\n * @param {Number} scale Amplitude scaling factor.\n * @returns {Number} The scaled waveform data point.\n */\n\nWaveformShape.scaleY = function(amplitude, height, scale) {\n  var y = -(height - 1) * (amplitude * scale + 128) / 255 + (height - 1);\n\n  return clamp(Math.floor(y), 0, height - 1);\n};\n\nexport default WaveformShape;\n","/**\n * @file\n *\n * Defines the {@link SegmentShape} class.\n *\n * @module segment-shape\n */\n\nimport SegmentMarker from './segment-marker';\nimport WaveformShape from './waveform-shape';\n\nvar defaultFontFamily = 'sans-serif';\nvar defaultFontSize = 10;\nvar defaultFontShape = 'normal';\n\n/**\n * Creates a waveform segment shape with optional start and end markers.\n *\n * @class\n * @alias SegmentShape\n *\n * @param {Segment} segment\n * @param {Peaks} peaks\n * @param {SegmentsLayer} layer\n * @param {WaveformOverview|WaveformZoomView} view\n */\n\nfunction SegmentShape(segment, peaks, layer, view) {\n  this._segment       = segment;\n  this._peaks         = peaks;\n  this._layer         = layer;\n  this._view          = view;\n  this._label         = null;\n  this._startMarker   = null;\n  this._endMarker     = null;\n  this._color         = segment.color;\n\n  this._waveformShape = new WaveformShape({\n    color:   segment.color,\n    view:    view,\n    segment: segment\n  });\n\n  this._onMouseEnter = this._onMouseEnter.bind(this);\n  this._onMouseLeave = this._onMouseLeave.bind(this);\n  this._onClick      = this._onClick.bind(this);\n  this._onDblClick   = this._onDblClick.bind(this);\n\n  // Set up event handlers to show/hide the segment label text when the user\n  // hovers the mouse over the segment.\n  this._waveformShape.on('mouseenter', this._onMouseEnter);\n  this._waveformShape.on('mouseleave', this._onMouseLeave);\n  this._waveformShape.on('click', this._onClick);\n  this._waveformShape.on('dblclick', this._onDblClick);\n\n  // Event handlers for markers\n  this._onSegmentHandleDrag      = this._onSegmentHandleDrag.bind(this);\n  this._onSegmentHandleDragStart = this._onSegmentHandleDragStart.bind(this);\n  this._onSegmentHandleDragEnd   = this._onSegmentHandleDragEnd.bind(this);\n\n  this._label = this._peaks.options.createSegmentLabel({\n    segment:    segment,\n    view:       this._view.getName(),\n    layer:      this._layer,\n    fontFamily: this._peaks.options.fontFamily,\n    fontSize:   this._peaks.options.fontSize,\n    fontStyle:  this._peaks.options.fontStyle\n  });\n\n  if (this._label) {\n    this._label.hide();\n  }\n\n  this._createMarkers();\n}\n\nSegmentShape.prototype.updatePosition = function() {\n  var segmentStartOffset = this._view.timeToPixels(this._segment.startTime);\n  var segmentEndOffset   = this._view.timeToPixels(this._segment.endTime);\n\n  var frameStartOffset = this._view.getFrameOffset();\n\n  var startPixel = segmentStartOffset - frameStartOffset;\n  var endPixel   = segmentEndOffset   - frameStartOffset;\n\n  var marker = this.getStartMarker();\n\n  if (marker) {\n    marker.setX(startPixel - marker.getWidth());\n  }\n\n  marker = this.getEndMarker();\n\n  if (marker) {\n    marker.setX(endPixel);\n  }\n};\n\nSegmentShape.prototype.getSegment = function() {\n  return this._segment;\n};\n\nSegmentShape.prototype.getStartMarker = function() {\n  return this._startMarker;\n};\n\nSegmentShape.prototype.getEndMarker = function() {\n  return this._endMarker;\n};\n\nSegmentShape.prototype.addToLayer = function(layer) {\n  this._waveformShape.addToLayer(layer);\n\n  if (this._label) {\n    layer.add(this._label);\n  }\n\n  if (this._startMarker) {\n    this._startMarker.addToLayer(layer);\n  }\n\n  if (this._endMarker) {\n    this._endMarker.addToLayer(layer);\n  }\n};\n\nSegmentShape.prototype._createMarkers = function() {\n  var editable = this._layer.isEditingEnabled() && this._segment.editable;\n\n  if (!editable) {\n    return;\n  }\n\n  var startMarker = this._peaks.options.createSegmentMarker({\n    segment:      this._segment,\n    draggable:    editable,\n    startMarker:  true,\n    color:        this._peaks.options.segmentStartMarkerColor,\n    fontFamily:   this._peaks.options.fontFamily || defaultFontFamily,\n    fontSize:     this._peaks.options.fontSize || defaultFontSize,\n    fontStyle:    this._peaks.options.fontStyle || defaultFontShape,\n    layer:        this._layer,\n    view:         this._view.getName()\n  });\n\n  if (startMarker) {\n    this._startMarker = new SegmentMarker({\n      segment:      this._segment,\n      segmentShape: this,\n      draggable:    editable,\n      startMarker:  true,\n      marker:       startMarker,\n      onDrag:       this._onSegmentHandleDrag,\n      onDragStart:  this._onSegmentHandleDragStart,\n      onDragEnd:    this._onSegmentHandleDragEnd\n    });\n  }\n\n  var endMarker = this._peaks.options.createSegmentMarker({\n    segment:      this._segment,\n    draggable:    editable,\n    startMarker:  false,\n    color:        this._peaks.options.segmentEndMarkerColor,\n    fontFamily:   this._peaks.options.fontFamily || defaultFontFamily,\n    fontSize:     this._peaks.options.fontSize || defaultFontSize,\n    fontStyle:    this._peaks.options.fontStyle || defaultFontShape,\n    layer:        this._layer,\n    view:         this._view.getName()\n  });\n\n  if (endMarker) {\n    this._endMarker = new SegmentMarker({\n      segment:      this._segment,\n      segmentShape: this,\n      draggable:    editable,\n      startMarker:  false,\n      marker:       endMarker,\n      onDrag:       this._onSegmentHandleDrag,\n      onDragStart:  this._onSegmentHandleDragStart,\n      onDragEnd:    this._onSegmentHandleDragEnd\n    });\n  }\n};\n\nSegmentShape.prototype._onMouseEnter = function() {\n  if (this._label) {\n    this._label.moveToTop();\n    this._label.show();\n  }\n\n  this._peaks.emit('segments.mouseenter', this._segment);\n};\n\nSegmentShape.prototype._onMouseLeave = function() {\n  if (this._label) {\n    this._label.hide();\n  }\n\n  this._peaks.emit('segments.mouseleave', this._segment);\n};\n\nSegmentShape.prototype._onClick = function() {\n  this._peaks.emit('segments.click', this._segment);\n};\n\nSegmentShape.prototype._onDblClick = function() {\n  this._peaks.emit('segments.dblclick', this._segment);\n};\n\n/**\n * @param {SegmentMarker} segmentMarker\n */\n\nSegmentShape.prototype._onSegmentHandleDrag = function(segmentMarker) {\n  var width = this._view.getWidth();\n\n  var startMarker = segmentMarker.isStartMarker();\n\n  var startMarkerX = this._startMarker.getX();\n  var endMarkerX = this._endMarker.getX();\n\n  if (startMarker && startMarkerX >= 0) {\n    var startMarkerOffset = startMarkerX +\n                            this._startMarker.getWidth();\n\n    this._segment._setStartTime(this._view.pixelOffsetToTime(startMarkerOffset));\n\n    segmentMarker.timeUpdated(this._segment.startTime);\n  }\n\n  if (!startMarker && endMarkerX < width) {\n    var endMarkerOffset = endMarkerX;\n\n    this._segment._setEndTime(this._view.pixelOffsetToTime(endMarkerOffset));\n\n    segmentMarker.timeUpdated(this._segment.endTime);\n  }\n\n  this._peaks.emit('segments.dragged', this._segment, startMarker);\n};\n\n/**\n * @param {SegmentMarker} segmentMarker\n */\n\nSegmentShape.prototype._onSegmentHandleDragStart = function(segmentMarker) {\n  var startMarker = segmentMarker.isStartMarker();\n\n  this._peaks.emit('segments.dragstart', this._segment, startMarker);\n};\n\n/**\n * @param {SegmentMarker} segmentMarker\n */\n\nSegmentShape.prototype._onSegmentHandleDragEnd = function(segmentMarker) {\n  var startMarker = segmentMarker.isStartMarker();\n\n  this._peaks.emit('segments.dragend', this._segment, startMarker);\n};\n\nSegmentShape.prototype.fitToView = function() {\n  if (this._startMarker) {\n    this._startMarker.fitToView();\n  }\n\n  if (this._endMarker) {\n    this._endMarker.fitToView();\n  }\n\n  this._waveformShape.setWaveformColor(this._color);\n};\n\nSegmentShape.prototype.destroy = function() {\n  this._waveformShape.destroy();\n\n  if (this._label) {\n    this._label.destroy();\n  }\n\n  if (this._startMarker) {\n    this._startMarker.destroy();\n  }\n\n  if (this._endMarker) {\n    this._endMarker.destroy();\n  }\n};\n\nexport default SegmentShape;\n","/**\n * @file\n *\n * Defines the {@link SegmentsLayer} class.\n *\n * @module segments-layer\n */\n\nimport SegmentShape from './segment-shape';\nimport { objectHasProperty } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates a Konva.Layer that displays segment markers against the audio\n * waveform.\n *\n * @class\n * @alias SegmentsLayer\n *\n * @param {Peaks} peaks\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Boolean} allowEditing\n */\n\nfunction SegmentsLayer(peaks, view, allowEditing) {\n  this._peaks         = peaks;\n  this._view          = view;\n  this._allowEditing  = allowEditing;\n  this._segmentShapes = {};\n  this._layer         = new Konva.Layer();\n\n  this._onSegmentsUpdate    = this._onSegmentsUpdate.bind(this);\n  this._onSegmentsAdd       = this._onSegmentsAdd.bind(this);\n  this._onSegmentsRemove    = this._onSegmentsRemove.bind(this);\n  this._onSegmentsRemoveAll = this._onSegmentsRemoveAll.bind(this);\n  this._onSegmentsDragged   = this._onSegmentsDragged.bind(this);\n\n  this._peaks.on('segments.update', this._onSegmentsUpdate);\n  this._peaks.on('segments.add', this._onSegmentsAdd);\n  this._peaks.on('segments.remove', this._onSegmentsRemove);\n  this._peaks.on('segments.remove_all', this._onSegmentsRemoveAll);\n  this._peaks.on('segments.dragged', this._onSegmentsDragged);\n}\n\n/**\n * Adds the layer to the given {Konva.Stage}.\n *\n * @param {Konva.Stage} stage\n */\n\nSegmentsLayer.prototype.addToStage = function(stage) {\n  stage.add(this._layer);\n};\n\nSegmentsLayer.prototype.enableEditing = function(enable) {\n  this._allowEditing = enable;\n};\n\nSegmentsLayer.prototype.isEditingEnabled = function() {\n  return this._allowEditing;\n};\n\nSegmentsLayer.prototype.formatTime = function(time) {\n  return this._view.formatTime(time);\n};\n\nSegmentsLayer.prototype._onSegmentsUpdate = function(segment) {\n  var redraw = false;\n  var segmentShape = this._segmentShapes[segment.id];\n  var frameStartTime = this._view.getStartTime();\n  var frameEndTime = this._view.getEndTime();\n\n  if (segmentShape) {\n    this._removeSegment(segment);\n    redraw = true;\n  }\n\n  if (segment.isVisible(frameStartTime, frameEndTime)) {\n    this._addSegmentShape(segment);\n    redraw = true;\n  }\n\n  if (redraw) {\n    this.updateSegments(frameStartTime, frameEndTime);\n  }\n};\n\nSegmentsLayer.prototype._onSegmentsAdd = function(segments) {\n  var self = this;\n\n  var frameStartTime = self._view.getStartTime();\n  var frameEndTime   = self._view.getEndTime();\n\n  segments.forEach(function(segment) {\n    if (segment.isVisible(frameStartTime, frameEndTime)) {\n      self._addSegmentShape(segment);\n    }\n  });\n\n  self.updateSegments(frameStartTime, frameEndTime);\n};\n\nSegmentsLayer.prototype._onSegmentsRemove = function(segments) {\n  var self = this;\n\n  segments.forEach(function(segment) {\n    self._removeSegment(segment);\n  });\n};\n\nSegmentsLayer.prototype._onSegmentsRemoveAll = function() {\n  this._layer.removeChildren();\n  this._segmentShapes = {};\n};\n\nSegmentsLayer.prototype._onSegmentsDragged = function(segment) {\n  this._updateSegment(segment);\n};\n\n/**\n * Creates the Konva UI objects for a given segment.\n *\n * @private\n * @param {Segment} segment\n * @returns {SegmentShape}\n */\n\nSegmentsLayer.prototype._createSegmentShape = function(segment) {\n  return new SegmentShape(segment, this._peaks, this, this._view);\n};\n\n/**\n * Adds a Konva UI object to the layer for a given segment.\n *\n * @private\n * @param {Segment} segment\n * @returns {SegmentShape}\n */\n\nSegmentsLayer.prototype._addSegmentShape = function(segment) {\n  var segmentShape = this._createSegmentShape(segment);\n\n  segmentShape.addToLayer(this._layer);\n\n  this._segmentShapes[segment.id] = segmentShape;\n\n  return segmentShape;\n};\n\n/**\n * Updates the positions of all displayed segments in the view.\n *\n * @param {Number} startTime The start of the visible range in the view,\n *   in seconds.\n * @param {Number} endTime The end of the visible range in the view,\n *   in seconds.\n */\n\nSegmentsLayer.prototype.updateSegments = function(startTime, endTime) {\n  // Update segments in visible time range.\n  var segments = this._peaks.segments.find(startTime, endTime);\n\n  segments.forEach(this._updateSegment.bind(this));\n\n  // TODO: in the overview all segments are visible, so no need to check\n  this._removeInvisibleSegments(startTime, endTime);\n};\n\n/**\n * @private\n * @param {Segment} segment\n */\n\nSegmentsLayer.prototype._updateSegment = function(segment) {\n  var segmentShape = this._findOrAddSegmentShape(segment);\n\n  segmentShape.updatePosition();\n};\n\n/**\n * @private\n * @param {Segment} segment\n */\n\nSegmentsLayer.prototype._findOrAddSegmentShape = function(segment) {\n  var segmentShape = this._segmentShapes[segment.id];\n\n  if (!segmentShape) {\n    segmentShape = this._addSegmentShape(segment);\n  }\n\n  return segmentShape;\n};\n\n/**\n * Removes any segments that are not visible, i.e., are not within and do not\n * overlap the given time range.\n *\n * @private\n * @param {Number} startTime The start of the visible time range, in seconds.\n * @param {Number} endTime The end of the visible time range, in seconds.\n * @returns {Number} The number of segments removed.\n */\n\nSegmentsLayer.prototype._removeInvisibleSegments = function(startTime, endTime) {\n  var count = 0;\n\n  for (var segmentId in this._segmentShapes) {\n    if (objectHasProperty(this._segmentShapes, segmentId)) {\n      var segment = this._segmentShapes[segmentId].getSegment();\n\n      if (!segment.isVisible(startTime, endTime)) {\n        this._removeSegment(segment);\n        count++;\n      }\n    }\n  }\n\n  return count;\n};\n\n/**\n * Removes the given segment from the view.\n *\n * @param {Segment} segment\n */\n\nSegmentsLayer.prototype._removeSegment = function(segment) {\n  var segmentShape = this._segmentShapes[segment.id];\n\n  if (segmentShape) {\n    segmentShape.destroy();\n    delete this._segmentShapes[segment.id];\n  }\n};\n\n/**\n * Toggles visibility of the segments layer.\n *\n * @param {Boolean} visible\n */\n\nSegmentsLayer.prototype.setVisible = function(visible) {\n  this._layer.setVisible(visible);\n};\n\nSegmentsLayer.prototype.destroy = function() {\n  this._peaks.off('segments.update', this._onSegmentsUpdate);\n  this._peaks.off('segments.add', this._onSegmentsAdd);\n  this._peaks.off('segments.remove', this._onSegmentsRemove);\n  this._peaks.off('segments.remove_all', this._onSegmentsRemoveAll);\n  this._peaks.off('segments.dragged', this._onSegmentsDragged);\n};\n\nSegmentsLayer.prototype.fitToView = function() {\n  for (var segmentId in this._segmentShapes) {\n    if (objectHasProperty(this._segmentShapes, segmentId)) {\n      var segmentShape = this._segmentShapes[segmentId];\n\n      segmentShape.fitToView();\n    }\n  }\n};\n\nSegmentsLayer.prototype.draw = function() {\n  this._layer.draw();\n};\n\nSegmentsLayer.prototype.getHeight = function() {\n  return this._layer.getHeight();\n};\n\nexport default SegmentsLayer;\n","/**\n * @file\n *\n * Defines the {@link WaveformAxis} class.\n *\n * @module waveform-axis\n */\n\nimport { formatTime, roundUpToNearest } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates the waveform axis shapes and adds them to the given view layer.\n *\n * @class\n * @alias WaveformAxis\n *\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Object} options\n * @param {String} options.axisGridlineColor\n * @param {String} options.axisLabelColor\n * @param {String} options.axisLabelFontFamily\n * @param {Number} options.axisLabelFontSize\n * @param {String} options.axisLabelFontStyle\n */\n\nfunction WaveformAxis(view, options) {\n  var self = this;\n\n  self._axisGridlineColor = options.axisGridlineColor;\n  self._axisLabelColor    = options.axisLabelColor;\n\n  self._axisLabelFont = WaveformAxis._buildFontString(\n    options.axisLabelFontFamily,\n    options.axisLabelFontSize,\n    options.axisLabelFontStyle\n  );\n\n  self._axisShape = new Konva.Shape({\n    sceneFunc: function(context) {\n      self.drawAxis(context, view);\n    }\n  });\n}\n\nWaveformAxis._buildFontString = function(fontFamily, fontSize, fontStyle) {\n  if (!fontSize) {\n    fontSize = 11;\n  }\n\n  if (!fontFamily) {\n    fontFamily = 'sans-serif';\n  }\n\n  if (!fontStyle) {\n    fontStyle = 'normal';\n  }\n\n  return fontStyle + ' ' + fontSize + 'px ' + fontFamily;\n};\n\nWaveformAxis.prototype.addToLayer = function(layer) {\n  layer.add(this._axisShape);\n};\n\n/**\n * Returns number of seconds for each x-axis marker, appropriate for the\n * current zoom level, ensuring that markers are not too close together\n * and that markers are placed at intuitive time intervals (i.e., every 1,\n * 2, 5, 10, 20, 30 seconds, then every 1, 2, 5, 10, 20, 30 minutes, then\n * every 1, 2, 5, 10, 20, 30 hours).\n *\n * @param {WaveformOverview|WaveformZoomView} view\n * @returns {Number}\n */\n\nWaveformAxis.prototype.getAxisLabelScale = function(view) {\n  var baseSecs   = 1; // seconds\n  var steps      = [1, 2, 5, 10, 20, 30];\n  var minSpacing = 60;\n  var index      = 0;\n\n  var secs;\n\n  for (;;) {\n    secs = baseSecs * steps[index];\n    var pixels = view.timeToPixels(secs);\n\n    if (pixels < minSpacing) {\n      if (++index === steps.length) {\n        baseSecs *= 60; // seconds -> minutes -> hours\n        index = 0;\n      }\n    }\n    else {\n      break;\n    }\n  }\n\n  return secs;\n};\n\n/**\n * Draws the time axis and labels onto a view.\n *\n * @param {Konva.Context} context The context to draw on.\n * @param {WaveformOverview|WaveformZoomView} view\n */\n\nWaveformAxis.prototype.drawAxis = function(context, view) {\n  var currentFrameStartTime = view.getStartTime();\n\n  // Draw axis markers\n  var markerHeight = 10;\n\n  // Time interval between axis markers (seconds)\n  var axisLabelIntervalSecs = this.getAxisLabelScale(view);\n\n  // Time of first axis marker (seconds)\n  var firstAxisLabelSecs = roundUpToNearest(currentFrameStartTime, axisLabelIntervalSecs);\n\n  // Distance between waveform start time and first axis marker (seconds)\n  var axisLabelOffsetSecs = firstAxisLabelSecs - currentFrameStartTime;\n\n  // Distance between waveform start time and first axis marker (pixels)\n  var axisLabelOffsetPixels = view.timeToPixels(axisLabelOffsetSecs);\n\n  context.setAttr('strokeStyle', this._axisGridlineColor);\n  context.setAttr('lineWidth', 1);\n\n  // Set text style\n  context.setAttr('font', this._axisLabelFont);\n  context.setAttr('fillStyle', this._axisLabelColor);\n  context.setAttr('textAlign', 'left');\n  context.setAttr('textBaseline', 'bottom');\n\n  var secs = firstAxisLabelSecs;\n  var x;\n\n  var width  = view.getWidth();\n  var height = view.getHeight();\n\n  for (;;) {\n    // Position of axis marker (pixels)\n    x = axisLabelOffsetPixels + view.timeToPixels(secs - firstAxisLabelSecs);\n    if (x >= width) {\n      break;\n    }\n\n    context.beginPath();\n    context.moveTo(x + 0.5, 0);\n    context.lineTo(x + 0.5, 0 + markerHeight);\n    context.moveTo(x + 0.5, height);\n    context.lineTo(x + 0.5, height - markerHeight);\n    context.stroke();\n\n    // precision = 0, drops the fractional seconds\n    var label      = formatTime(secs, 0);\n    var labelWidth = context.measureText(label).width;\n    var labelX     = x - labelWidth / 2;\n    var labelY     = height - 1 - markerHeight;\n\n    if (labelX >= 0) {\n      context.fillText(label, labelX, labelY);\n    }\n\n    secs += axisLabelIntervalSecs;\n  }\n};\n\nexport default WaveformAxis;\n","/**\n * @file\n *\n * Defines the {@link WaveformOverview} class.\n *\n * @module waveform-overview\n */\n\nimport HighlightLayer from './highlight-layer';\nimport MouseDragHandler from './mouse-drag-handler';\nimport PlayheadLayer from './playhead-layer';\nimport PointsLayer from './points-layer';\nimport SegmentsLayer from './segments-layer';\nimport WaveformAxis from './waveform-axis';\nimport WaveformShape from './waveform-shape';\nimport { clamp, formatTime, isFinite, isNumber } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates the overview waveform view.\n *\n * @class\n * @alias WaveformOverview\n *\n * @param {WaveformData} waveformData\n * @param {HTMLElement} container\n * @param {Peaks} peaks\n */\n\nfunction WaveformOverview(waveformData, container, peaks) {\n  var self = this;\n\n  self._originalWaveformData = waveformData;\n  self._container = container;\n  self._peaks = peaks;\n  self._options = peaks.options;\n  self._viewOptions = peaks.options.overview;\n\n  // Bind event handlers\n  self._onTimeUpdate = self._onTimeUpdate.bind(this);\n  self._onPlaying = self._onPlaying.bind(this);\n  self._onPause = self._onPause.bind(this);\n  self._onZoomviewDisplaying = self._onZoomviewDisplaying.bind(this);\n  self._onWindowResize = self._onWindowResize.bind(this);\n\n  // Register event handlers\n  peaks.on('player.timeupdate', self._onTimeUpdate);\n  peaks.on('player.playing', self._onPlaying);\n  peaks.on('player.pause', self._onPause);\n  peaks.on('zoomview.displaying', self._onZoomviewDisplaying);\n  peaks.on('window_resize', self._onWindowResize);\n\n  self._amplitudeScale = 1.0;\n  self._timeLabelPrecision = self._viewOptions.timeLabelPrecision;\n\n  self._width = container.clientWidth;\n  self._height = container.clientHeight;\n\n  self._data = waveformData;\n\n  if (self._width !== 0) {\n    try {\n      self._data = waveformData.resample({ width: self._width });\n    }\n    catch (error) {\n      // This error usually indicates that the waveform length\n      // is less than the container width\n    }\n  }\n\n  // Disable warning: The stage has 6 layers.\n  // Recommended maximum number of layers is 3-5.\n  Konva.showWarnings = false;\n\n  self._resizeTimeoutId = null;\n\n  self._stage = new Konva.Stage({\n    container: container,\n    width: self._width,\n    height: self._height\n  });\n\n  self._waveformLayer = new Konva.Layer({ listening: false });\n\n  self._waveformColor = self._viewOptions.waveformColor;\n  self._playedWaveformColor = self._viewOptions.playedWaveformColor;\n\n  self._createWaveform();\n\n  self._segmentsLayer = new SegmentsLayer(peaks, self, false);\n  self._segmentsLayer.addToStage(self._stage);\n\n  self._pointsLayer = new PointsLayer(peaks, self, false);\n  self._pointsLayer.addToStage(self._stage);\n\n  self._highlightLayer = new HighlightLayer(\n    self,\n    self._viewOptions.highlightOffset,\n    self._viewOptions.highlightColor\n  );\n  self._highlightLayer.addToStage(self._stage);\n\n  self._createAxisLabels();\n\n  self._playheadLayer = new PlayheadLayer({\n    player: self._peaks.player,\n    view: self,\n    showPlayheadTime: self._viewOptions.showPlayheadTime,\n    playheadColor: self._viewOptions.playheadColor,\n    playheadTextColor: self._viewOptions.playheadTextColor,\n    playheadFontFamily: self._viewOptions.fontFamily,\n    playheadFontSize: self._viewOptions.fontSize,\n    playheadFontStyle: self._viewOptions.fontStyle\n  });\n\n  self._playheadLayer.addToStage(self._stage);\n\n  var time = self._peaks.player.getCurrentTime();\n\n  this._playheadLayer.updatePlayheadTime(time);\n\n  self._mouseDragHandler = new MouseDragHandler(self._stage, {\n    onMouseDown: function(mousePosX) {\n      mousePosX = clamp(mousePosX, 0, self._width);\n\n      var time = self.pixelsToTime(mousePosX);\n      var duration = self._getDuration();\n\n      // Prevent the playhead position from jumping by limiting click\n      // handling to the waveform duration.\n      if (time > duration) {\n        time = duration;\n      }\n\n      self._playheadLayer.updatePlayheadTime(time);\n\n      peaks.player.seek(time);\n    },\n\n    onMouseMove: function(mousePosX) {\n      mousePosX = clamp(mousePosX, 0, self._width);\n\n      var time = self.pixelsToTime(mousePosX);\n      var duration = self._getDuration();\n\n      if (time > duration) {\n        time = duration;\n      }\n\n      // Update the playhead position. This gives a smoother visual update\n      // than if we only use the player.timeupdate event.\n      self._playheadLayer.updatePlayheadTime(time);\n\n      self._peaks.player.seek(time);\n    }\n  });\n\n  self._onClick = self._onClick.bind(this);\n  self._onDblClick = self._onDblClick.bind(this);\n\n  self._stage.on('click', self._onClick);\n  self._stage.on('dblclick', self._onDblClick);\n}\n\nWaveformOverview.prototype._onClick = function(event) {\n  this._clickHandler(event, 'overview.click');\n};\n\nWaveformOverview.prototype._onDblClick = function(event) {\n  this._clickHandler(event, 'overview.dblclick');\n};\n\nWaveformOverview.prototype._clickHandler = function(event, eventName) {\n  var pixelIndex = event.evt.layerX;\n  var time = this.pixelsToTime(pixelIndex);\n\n  this._peaks.emit(eventName, time);\n};\n\nWaveformOverview.prototype.getName = function() {\n  return 'overview';\n};\n\nWaveformOverview.prototype._onTimeUpdate = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformOverview.prototype._onPlaying = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformOverview.prototype._onPause = function(time) {\n  this._playheadLayer.stop(time);\n};\n\nWaveformOverview.prototype._onZoomviewDisplaying = function(startTime, endTime) {\n  this.showHighlight(startTime, endTime);\n};\n\nWaveformOverview.prototype.showHighlight = function(startTime, endTime) {\n  this._highlightLayer.showHighlight(startTime, endTime);\n};\n\nWaveformOverview.prototype._onWindowResize = function() {\n  var self = this;\n\n  if (self._resizeTimeoutId) {\n    clearTimeout(self._resizeTimeoutId);\n    self._resizeTimeoutId = null;\n  }\n\n  // Avoid resampling waveform data to zero width\n  if (self._container.clientWidth !== 0) {\n    self._width = self._container.clientWidth;\n    self._stage.setWidth(self._width);\n\n    self._resizeTimeoutId = setTimeout(function() {\n      self._width = self._container.clientWidth;\n      self._data = self._originalWaveformData.resample({ width: self._width });\n      self._stage.setWidth(self._width);\n\n      self._updateWaveform();\n    }, 500);\n  }\n};\n\nWaveformOverview.prototype.setWaveformData = function(waveformData) {\n  this._originalWaveformData = waveformData;\n\n  if (this._width !== 0) {\n    this._data = waveformData.resample({ width: this._width });\n  }\n  else {\n    this._data = waveformData;\n  }\n\n  this._updateWaveform();\n};\n\nWaveformOverview.prototype.playheadPosChanged = function(time) {\n  if (this._playedWaveformShape) {\n    this._playedSegment.endTime = time;\n    this._unplayedSegment.startTime = time;\n\n    this._waveformLayer.draw();\n  }\n};\n\n/**\n * Returns the pixel index for a given time, for the current zoom level.\n *\n * @param {Number} time Time, in seconds.\n * @returns {Number} Pixel index.\n */\n\nWaveformOverview.prototype.timeToPixels = function(time) {\n  return Math.floor(time * this._data.sample_rate / this._data.scale);\n};\n\n/**\n * Returns the time for a given pixel index, for the current zoom level.\n *\n * @param {Number} pixels Pixel index.\n * @returns {Number} Time, in seconds.\n */\n\nWaveformOverview.prototype.pixelsToTime = function(pixels) {\n  return pixels * this._data.scale / this._data.sample_rate;\n};\n\n/**\n * Returns the time for a given pixel index, for the current zoom level.\n * (This is presented for symmetry with WaveformZoomview. Since WaveformOverview\n * doesn't scroll, its pixelOffsetToTime & pixelsToTime methods are identical.)\n *\n * @param {Number} pixels Pixel index.\n * @returns {Number} Time, in seconds.\n */\n\nWaveformOverview.prototype.pixelOffsetToTime = WaveformOverview.prototype.pixelsToTime;\n\n/**\n * @returns {Number} The start position of the waveform shown in the view,\n *   in pixels.\n */\n\nWaveformOverview.prototype.getFrameOffset = function() {\n  return 0;\n};\n\n/**\n * @returns {Number} The time at the leftmost edge\n */\n\nWaveformOverview.prototype.getStartTime = function() {\n  return 0;\n};\n\n/**\n * @returns {Number} The time at the rightmost edge\n */\n\nWaveformOverview.prototype.getEndTime = function() {\n  return this._getDuration();\n};\n\n/**\n * @returns {Number} The width of the view, in pixels.\n */\n\nWaveformOverview.prototype.getWidth = function() {\n  return this._width;\n};\n\n/**\n * @returns {Number} The height of the view, in pixels.\n */\n\nWaveformOverview.prototype.getHeight = function() {\n  return this._height;\n};\n\n/**\n * @returns {Number} The media duration, in seconds.\n */\n\nWaveformOverview.prototype._getDuration = function() {\n  return this._peaks.player.getDuration();\n};\n\n/**\n * Adjusts the amplitude scale of waveform shown in the view, which allows\n * users to zoom the waveform vertically.\n *\n * @param {Number} scale The new amplitude scale factor\n */\n\nWaveformOverview.prototype.setAmplitudeScale = function(scale) {\n  if (!isNumber(scale) || !isFinite(scale)) {\n    throw new Error('view.setAmplitudeScale(): Scale must be a valid number');\n  }\n\n  this._amplitudeScale = scale;\n\n  this._waveformLayer.draw();\n  this._segmentsLayer.draw();\n};\n\nWaveformOverview.prototype.getAmplitudeScale = function() {\n  return this._amplitudeScale;\n};\n\n/**\n * @returns {WaveformData} The view's waveform data.\n */\n\nWaveformOverview.prototype.getWaveformData = function() {\n  return this._data;\n};\n\nWaveformOverview.prototype._createWaveformShapes = function() {\n  if (!this._waveformShape) {\n    this._waveformShape = new WaveformShape({\n      color: this._waveformColor,\n      view: this\n    });\n\n    this._waveformShape.addToLayer(this._waveformLayer);\n  }\n\n  if (this._playedWaveformColor && !this._playedWaveformShape) {\n    var time = this._peaks.player.getCurrentTime();\n\n    this._playedSegment = {\n      startTime: 0,\n      endTime: time\n    };\n\n    this._unplayedSegment = {\n      startTime: time,\n      endTime: this._getDuration()\n    };\n\n    this._waveformShape.setSegment(this._unplayedSegment);\n\n    this._playedWaveformShape = new WaveformShape({\n      color: this._playedWaveformColor,\n      view: this,\n      segment: this._playedSegment\n    });\n\n    this._playedWaveformShape.addToLayer(this._waveformLayer);\n  }\n};\n\nWaveformOverview.prototype._destroyPlayedWaveformShape = function() {\n  this._waveformShape.setSegment(null);\n\n  this._playedWaveformShape.destroy();\n  this._playedWaveformShape = null;\n\n  this._playedSegment = null;\n  this._unplayedSegment = null;\n};\n\nWaveformOverview.prototype._createWaveform = function() {\n  this._createWaveformShapes();\n\n  this._stage.add(this._waveformLayer);\n};\n\nWaveformOverview.prototype._createAxisLabels = function() {\n  this._axisLayer = new Konva.Layer({ listening: false });\n\n  this._axis = new WaveformAxis(this, {\n    axisGridlineColor:   this._viewOptions.axisGridlineColor,\n    axisLabelColor:      this._viewOptions.axisLabelColor,\n    axisLabelFontFamily: this._viewOptions.fontFamily,\n    axisLabelFontSize:   this._viewOptions.fontSize,\n    axisLabelFontStyle:  this._viewOptions.fontStyle\n  });\n\n  this._axis.addToLayer(this._axisLayer);\n  this._stage.add(this._axisLayer);\n};\n\nWaveformOverview.prototype.removeHighlightRect = function() {\n  this._highlightLayer.removeHighlight();\n};\n\nWaveformOverview.prototype._updateWaveform = function() {\n  this._waveformLayer.draw();\n  this._axisLayer.draw();\n\n  var playheadTime = this._peaks.player.getCurrentTime();\n\n  this._playheadLayer.updatePlayheadTime(playheadTime);\n\n  this._highlightLayer.updateHighlight();\n\n  var frameStartTime = 0;\n  var frameEndTime   = this.pixelsToTime(this._width);\n\n  this._pointsLayer.updatePoints(frameStartTime, frameEndTime);\n  this._segmentsLayer.updateSegments(frameStartTime, frameEndTime);\n};\n\nWaveformOverview.prototype.setWaveformColor = function(color) {\n  this._waveformColor = color;\n  this._waveformShape.setWaveformColor(color);\n};\n\nWaveformOverview.prototype.setPlayedWaveformColor = function(color) {\n  this._playedWaveformColor = color;\n\n  if (color) {\n    if (!this._playedWaveformShape) {\n      this._createWaveformShapes();\n    }\n\n    this._playedWaveformShape.setWaveformColor(color);\n  }\n  else {\n    if (this._playedWaveformShape) {\n      this._destroyPlayedWaveformShape();\n    }\n  }\n};\n\nWaveformOverview.prototype.showPlayheadTime = function(show) {\n  this._playheadLayer.showPlayheadTime(show);\n};\n\nWaveformOverview.prototype.setTimeLabelPrecision = function(precision) {\n  this._timeLabelPrecision = precision;\n  this._playheadLayer.updatePlayheadText();\n};\n\nWaveformOverview.prototype.formatTime = function(time) {\n  return formatTime(time, this._timeLabelPrecision);\n};\n\nWaveformOverview.prototype.enableMarkerEditing = function(enable) {\n  this._segmentsLayer.enableEditing(enable);\n  this._pointsLayer.enableEditing(enable);\n};\n\nWaveformOverview.prototype.fitToContainer = function() {\n  if (this._container.clientWidth === 0 && this._container.clientHeight === 0) {\n    return;\n  }\n\n  var updateWaveform = false;\n\n  if (this._container.clientWidth !== this._width) {\n    this._width = this._container.clientWidth;\n    this._stage.setWidth(this._width);\n\n    try {\n      this._data = this._originalWaveformData.resample({ width: this._width });\n      updateWaveform = true;\n    }\n    catch (error) {\n      // Ignore, and leave this._data as it was\n    }\n  }\n\n  this._height = this._container.clientHeight;\n  this._stage.setHeight(this._height);\n\n  this._waveformShape.fitToView();\n  this._playheadLayer.fitToView();\n  this._segmentsLayer.fitToView();\n  this._pointsLayer.fitToView();\n  this._highlightLayer.fitToView();\n\n  if (updateWaveform) {\n    this._updateWaveform();\n  }\n\n  this._stage.draw();\n};\n\nWaveformOverview.prototype.destroy = function() {\n  if (this._resizeTimeoutId) {\n    clearTimeout(this._resizeTimeoutId);\n    this._resizeTimeoutId = null;\n  }\n\n  this._peaks.off('player.playing', this._onPlaying);\n  this._peaks.off('player.pause', this._onPause);\n  this._peaks.off('player.timeupdate', this._onTimeUpdate);\n  this._peaks.off('zoomview.displaying', this._onZoomviewDisplaying);\n  this._peaks.off('window_resize', this._onWindowResize);\n\n  this._playheadLayer.destroy();\n  this._segmentsLayer.destroy();\n  this._pointsLayer.destroy();\n\n  if (this._stage) {\n    this._stage.destroy();\n    this._stage = null;\n  }\n};\n\nexport default WaveformOverview;\n","/**\n * @file\n *\n * Defines the {@link WaveformZoomView} class.\n *\n * @module waveform-zoomview\n */\n\nimport MouseDragHandler from './mouse-drag-handler';\nimport PlayheadLayer from './playhead-layer';\nimport PointsLayer from './points-layer';\nimport SegmentsLayer from './segments-layer';\nimport WaveformAxis from './waveform-axis';\nimport WaveformShape from './waveform-shape';\n// import AnimatedZoomAdapter from './animated-zoom-adapter';\n// import StaticZoomAdapter from './static-zoom-adapter';\nimport { clamp, formatTime, isFinite, isNumber, isValidTime,\n  objectHasProperty } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates a zoomable waveform view.\n *\n * @class\n * @alias WaveformZoomView\n *\n * @param {WaveformData} waveformData\n * @param {HTMLElement} container\n * @param {Peaks} peaks\n */\n\nfunction WaveformZoomView(waveformData, container, peaks) {\n  var self = this;\n\n  self._originalWaveformData = waveformData;\n  self._container = container;\n  self._peaks = peaks;\n  self._options = peaks.options;\n  self._viewOptions = peaks.options.zoomview;\n\n  // Bind event handlers\n  self._onTimeUpdate = self._onTimeUpdate.bind(self);\n  self._onPlaying = self._onPlaying.bind(self);\n  self._onPause = self._onPause.bind(self);\n  self._onWindowResize = self._onWindowResize.bind(self);\n  self._onKeyboardLeft = self._onKeyboardLeft.bind(self);\n  self._onKeyboardRight = self._onKeyboardRight.bind(self);\n  self._onKeyboardShiftLeft  = self._onKeyboardShiftLeft.bind(self);\n  self._onKeyboardShiftRight = self._onKeyboardShiftRight.bind(self);\n\n  // Register event handlers\n  self._peaks.on('player.timeupdate', self._onTimeUpdate);\n  self._peaks.on('player.playing', self._onPlaying);\n  self._peaks.on('player.pause', self._onPause);\n  self._peaks.on('window_resize', self._onWindowResize);\n  self._peaks.on('keyboard.left', self._onKeyboardLeft);\n  self._peaks.on('keyboard.right', self._onKeyboardRight);\n  self._peaks.on('keyboard.shift_left', self._onKeyboardShiftLeft);\n  self._peaks.on('keyboard.shift_right', self._onKeyboardShiftRight);\n\n  self._enableAutoScroll = true;\n  self._amplitudeScale = 1.0;\n  self._timeLabelPrecision = self._viewOptions.timeLabelPrecision;\n\n  self._data = null;\n  self._pixelLength = 0;\n\n  var initialZoomLevel = peaks.zoom.getZoomLevel();\n\n  self._zoomLevelAuto = false;\n  self._zoomLevelSeconds = null;\n\n  self._resizeTimeoutId = null;\n  self._resampleData({ scale: initialZoomLevel });\n\n  self._width = container.clientWidth;\n  self._height = container.clientHeight;\n\n  // The pixel offset of the current frame being displayed\n  self._frameOffset = 0;\n\n  self._stage = new Konva.Stage({\n    container: container,\n    width: self._width,\n    height: self._height\n  });\n\n  self._waveformLayer = new Konva.Layer({ listening: false });\n\n  self._waveformColor = self._viewOptions.waveformColor;\n  self._playedWaveformColor = self._viewOptions.playedWaveformColor;\n\n  self._createWaveform();\n\n  self._segmentsLayer = new SegmentsLayer(peaks, self, true);\n  self._segmentsLayer.addToStage(self._stage);\n\n  self._pointsLayer = new PointsLayer(peaks, self, true);\n  self._pointsLayer.addToStage(self._stage);\n\n  self._createAxisLabels();\n\n  self._playheadLayer = new PlayheadLayer({\n    player: self._peaks.player,\n    view: self,\n    showPlayheadTime: self._viewOptions.showPlayheadTime,\n    playheadColor: self._viewOptions.playheadColor,\n    playheadTextColor: self._viewOptions.playheadTextColor,\n    playheadFontFamily: self._viewOptions.fontFamily,\n    playheadFontSize: self._viewOptions.fontSize,\n    playheadFontStyle: self._viewOptions.fontStyle\n  });\n\n  self._playheadLayer.addToStage(self._stage);\n\n  var time = self._peaks.player.getCurrentTime();\n\n  self._syncPlayhead(time);\n\n  self._mouseDragHandler = new MouseDragHandler(self._stage, {\n    onMouseDown: function(mousePosX) {\n      this.initialFrameOffset = self._frameOffset;\n      this.mouseDownX = mousePosX;\n    },\n\n    onMouseMove: function(mousePosX) {\n      // Moving the mouse to the left increases the time position of the\n      // left-hand edge of the visible waveform.\n      var diff = this.mouseDownX - mousePosX;\n      var newFrameOffset = this.initialFrameOffset + diff;\n\n      if (newFrameOffset !== this.initialFrameOffset) {\n        self._updateWaveform(newFrameOffset);\n      }\n    },\n\n    onMouseUp: function(/* mousePosX */) {\n      // Set playhead position only on click release, when not dragging.\n      if (!self._mouseDragHandler.isDragging()) {\n        var time = self.pixelOffsetToTime(this.mouseDownX);\n        var duration = self._getDuration();\n\n        // Prevent the playhead position from jumping by limiting click\n        // handling to the waveform duration.\n        if (time > duration) {\n          time = duration;\n        }\n\n        self._playheadLayer.updatePlayheadTime(time);\n\n        self._peaks.player.seek(time);\n      }\n    }\n  });\n\n  self._onWheel = self._onWheel.bind(self);\n  self.setWheelMode(self._viewOptions.wheelMode);\n\n  self._onClick = self._onClick.bind(this);\n  self._onDblClick = self._onDblClick.bind(this);\n\n  self._stage.on('click', self._onClick);\n  self._stage.on('dblclick', self._onDblClick);\n}\n\nWaveformZoomView.prototype._onClick = function(event) {\n  this._clickHandler(event, 'zoomview.click');\n};\n\nWaveformZoomView.prototype._onDblClick = function(event) {\n  this._clickHandler(event, 'zoomview.dblclick');\n};\n\nWaveformZoomView.prototype._clickHandler = function(event, eventName) {\n  var mousePosX = event.evt.layerX;\n  var time = this.pixelOffsetToTime(mousePosX);\n\n  this._peaks.emit(eventName, time);\n};\n\nWaveformZoomView.prototype.setWheelMode = function(mode) {\n  if (mode !== this._wheelMode) {\n    this._wheelMode = mode;\n\n    switch (mode) {\n      case 'scroll':\n        this._stage.on('wheel', this._onWheel);\n        break;\n\n      case 'none':\n        this._stage.off('wheel');\n        break;\n    }\n  }\n};\n\nWaveformZoomView.prototype._onWheel = function(event) {\n  var wheelEvent = event.evt;\n  var delta = wheelEvent.shiftKey ? wheelEvent.deltaY : wheelEvent.deltaX;\n  var offAxisDelta = wheelEvent.shiftKey ? wheelEvent.deltaX : wheelEvent.deltaY;\n\n  // Ignore the event if it looks like the user is scrolling vertically\n  // down the page\n  if (Math.abs(delta) < Math.abs(offAxisDelta)) {\n    return;\n  }\n\n  event.evt.preventDefault();\n\n  var newFrameOffset = clamp(\n    this._frameOffset + Math.floor(delta), 0, this._pixelLength - this._width\n  );\n\n  this._updateWaveform(newFrameOffset);\n};\n\nWaveformZoomView.prototype.getName = function() {\n  return 'zoomview';\n};\n\nWaveformZoomView.prototype._onTimeUpdate = function(time) {\n  if (this._mouseDragHandler.isDragging()) {\n    return;\n  }\n\n  this._syncPlayhead(time);\n};\n\nWaveformZoomView.prototype._onPlaying = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformZoomView.prototype._onPause = function(time) {\n  this._playheadLayer.stop(time);\n};\n\nWaveformZoomView.prototype._onWindowResize = function() {\n  var self = this;\n\n  var width = self._container.clientWidth;\n\n  if (!self._zoomLevelAuto) {\n    self._width = width;\n    self._stage.width(width);\n    self._updateWaveform(self._frameOffset);\n  }\n  else {\n    if (self._resizeTimeoutId) {\n      clearTimeout(self._resizeTimeoutId);\n      self._resizeTimeoutId = null;\n    }\n\n    // Avoid resampling waveform data to zero width\n    if (width !== 0) {\n      self._width = width;\n      self._stage.width(width);\n\n      self._resizeTimeoutId = setTimeout(function() {\n        self._width = width;\n        self._data = self._originalWaveformData.resample(width);\n        self._stage.width(width);\n\n        self._updateWaveform(self._frameOffset);\n      }, 500);\n    }\n  }\n};\n\nWaveformZoomView.prototype._onKeyboardLeft = function() {\n  this._keyboardScroll(-1, false);\n};\n\nWaveformZoomView.prototype._onKeyboardRight = function() {\n  this._keyboardScroll(1, false);\n};\n\nWaveformZoomView.prototype._onKeyboardShiftLeft = function() {\n  this._keyboardScroll(-1, true);\n};\n\nWaveformZoomView.prototype._onKeyboardShiftRight = function() {\n  this._keyboardScroll(1, true);\n};\n\nWaveformZoomView.prototype._keyboardScroll = function(direction, large) {\n  var increment;\n\n  if (large) {\n    increment = direction * this._width;\n  }\n  else {\n    increment = direction * this.timeToPixels(this._options.nudgeIncrement);\n  }\n\n  this.scrollWaveform({ pixels: increment });\n};\n\nWaveformZoomView.prototype.setWaveformData = function(waveformData) {\n  this._originalWaveformData = waveformData;\n  // Don't update the UI here, call setZoom().\n};\n\nWaveformZoomView.prototype.playheadPosChanged = function(time) {\n  if (this._playedWaveformShape) {\n    this._playedSegment.endTime = time;\n    this._unplayedSegment.startTime = time;\n\n    this._drawWaveformLayer();\n  }\n};\n\nWaveformZoomView.prototype._syncPlayhead = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n\n  if (this._enableAutoScroll) {\n    // Check for the playhead reaching the right-hand side of the window.\n\n    var pixelIndex = this.timeToPixels(time);\n\n    // TODO: move this code to animation function?\n    // TODO: don't scroll if user has positioned view manually (e.g., using\n    // the keyboard)\n    var endThreshold = this._frameOffset + this._width - 100;\n\n    if (pixelIndex >= endThreshold || pixelIndex < this._frameOffset) {\n      // Put the playhead at 100 pixels from the left edge\n      this._frameOffset = pixelIndex - 100;\n\n      if (this._frameOffset < 0) {\n        this._frameOffset = 0;\n      }\n\n      this._updateWaveform(this._frameOffset);\n    }\n  }\n};\n\n/**\n * Changes the zoom level.\n *\n * @param {Number} scale The new zoom level, in samples per pixel.\n */\n\nWaveformZoomView.prototype._getScale = function(duration) {\n  return duration * this._data.sample_rate / this._width;\n};\n\nfunction isAutoScale(options) {\n  return ((objectHasProperty(options, 'scale') && options.scale === 'auto') ||\n          (objectHasProperty(options, 'seconds') && options.seconds === 'auto'));\n}\n\nWaveformZoomView.prototype.setZoom = function(options) {\n  var scale;\n\n  if (isAutoScale(options)) {\n    var seconds = this._peaks.player.getDuration();\n\n    if (!isValidTime(seconds)) {\n      return false;\n    }\n\n    this._zoomLevelAuto = true;\n    this._zoomLevelSeconds = null;\n    scale = this._getScale(seconds);\n  }\n  else {\n    if (objectHasProperty(options, 'scale')) {\n      this._zoomLevelSeconds = null;\n      scale = options.scale;\n    }\n    else if (objectHasProperty(options, 'seconds')) {\n      if (!isValidTime(options.seconds)) {\n        return false;\n      }\n\n      this._zoomLevelSeconds = options.seconds;\n      scale = this._getScale(options.seconds);\n    }\n\n    this._zoomLevelAuto = false;\n  }\n\n  if (scale < this._originalWaveformData.scale) {\n    // eslint-disable-next-line max-len\n    this._peaks.logger('peaks.zoomview.setZoom(): zoom level must be at least ' + this._originalWaveformData.scale);\n    scale = this._originalWaveformData.scale;\n  }\n\n  var currentTime = this._peaks.player.getCurrentTime();\n  var apexTime;\n  var playheadOffsetPixels = this._playheadLayer.getPlayheadOffset();\n\n  if (playheadOffsetPixels >= 0 && playheadOffsetPixels < this._width) {\n    // Playhead is visible. Change the zoom level while keeping the\n    // playhead at the same position in the window.\n    apexTime = currentTime;\n  }\n  else {\n    // Playhead is not visible. Change the zoom level while keeping the\n    // centre of the window at the same position in the waveform.\n    playheadOffsetPixels = Math.floor(this._width / 2);\n    apexTime = this.pixelOffsetToTime(playheadOffsetPixels);\n  }\n\n  var prevScale = this._scale;\n\n  this._resampleData({ scale: scale });\n\n  var apexPixel = this.timeToPixels(apexTime);\n\n  this._frameOffset = apexPixel - playheadOffsetPixels;\n\n  this._updateWaveform(this._frameOffset);\n\n  this._playheadLayer.zoomLevelChanged();\n\n  // Update the playhead position after zooming.\n  this._playheadLayer.updatePlayheadTime(currentTime);\n\n  // var adapter = this.createZoomAdapter(currentScale, previousScale);\n\n  // adapter.start(relativePosition);\n\n  this._peaks.emit('zoom.update', scale, prevScale);\n\n  return true;\n};\n\nWaveformZoomView.prototype._resampleData = function(options) {\n  this._data = this._originalWaveformData.resample(options);\n  this._scale = this._data.scale;\n  this._pixelLength = this._data.length;\n};\n\nWaveformZoomView.prototype.getStartTime = function() {\n  return this.pixelOffsetToTime(0);\n};\n\nWaveformZoomView.prototype.getEndTime = function() {\n  return this.pixelOffsetToTime(this._width);\n};\n\nWaveformZoomView.prototype.setStartTime = function(time) {\n  if (time < 0) {\n    time = 0;\n  }\n\n  if (this._zoomLevelAuto) {\n    time = 0;\n  }\n\n  this._updateWaveform(this.timeToPixels(time));\n};\n\n/**\n * Returns the pixel index for a given time, for the current zoom level.\n *\n * @param {Number} time Time, in seconds.\n * @returns {Number} Pixel index.\n */\n\nWaveformZoomView.prototype.timeToPixels = function(time) {\n  return Math.floor(time * this._data.sample_rate / this._data.scale);\n};\n\n/**\n * Returns the time for a given pixel index, for the current zoom level.\n *\n * @param {Number} pixels Pixel index.\n * @returns {Number} Time, in seconds.\n */\n\nWaveformZoomView.prototype.pixelsToTime = function(pixels) {\n  return pixels * this._data.scale / this._data.sample_rate;\n};\n\n/**\n * Returns the time for a given pixel offset (relative to the\n * current scroll position), for the current zoom level.\n *\n * @param {Number} offset Offset from left-visible-edge of view\n * @returns {Number} Time, in seconds.\n */\n\nWaveformZoomView.prototype.pixelOffsetToTime = function(offset) {\n  var pixels = this._frameOffset + offset;\n\n  return pixels * this._data.scale / this._data.sample_rate;\n};\n\n/* var zoomAdapterMap = {\n  'animated': AnimatedZoomAdapter,\n  'static': StaticZoomAdapter\n};\n\nWaveformZoomView.prototype.createZoomAdapter = function(currentScale, previousScale) {\n  var ZoomAdapter = zoomAdapterMap[this._viewOptions.zoomAdapter];\n\n  if (!ZoomAdapter) {\n    throw new Error('Invalid zoomAdapter: ' + this._viewOptions.zoomAdapter);\n  }\n\n  return ZoomAdapter.create(this, currentScale, previousScale);\n}; */\n\n/**\n * @returns {Number} The start position of the waveform shown in the view,\n *   in pixels.\n */\n\nWaveformZoomView.prototype.getFrameOffset = function() {\n  return this._frameOffset;\n};\n\n/**\n * @returns {Number} The width of the view, in pixels.\n */\n\nWaveformZoomView.prototype.getWidth = function() {\n  return this._width;\n};\n\n/**\n * @returns {Number} The height of the view, in pixels.\n */\n\nWaveformZoomView.prototype.getHeight = function() {\n  return this._height;\n};\n\n/**\n * @returns {Number} The media duration, in seconds.\n */\n\nWaveformZoomView.prototype._getDuration = function() {\n  return this._peaks.player.getDuration();\n};\n\n/**\n * Adjusts the amplitude scale of waveform shown in the view, which allows\n * users to zoom the waveform vertically.\n *\n * @param {Number} scale The new amplitude scale factor\n */\n\nWaveformZoomView.prototype.setAmplitudeScale = function(scale) {\n  if (!isNumber(scale) || !isFinite(scale)) {\n    throw new Error('view.setAmplitudeScale(): Scale must be a valid number');\n  }\n\n  this._amplitudeScale = scale;\n\n  this._drawWaveformLayer();\n  this._segmentsLayer.draw();\n};\n\nWaveformZoomView.prototype.getAmplitudeScale = function() {\n  return this._amplitudeScale;\n};\n\n/**\n * @returns {WaveformData} The view's waveform data.\n */\n\nWaveformZoomView.prototype.getWaveformData = function() {\n  return this._data;\n};\n\nWaveformZoomView.prototype._createWaveformShapes = function() {\n  if (!this._waveformShape) {\n    this._waveformShape = new WaveformShape({\n      color: this._waveformColor,\n      view: this\n    });\n\n    this._waveformShape.addToLayer(this._waveformLayer);\n  }\n\n  if (this._playedWaveformColor && !this._playedWaveformShape) {\n    var time = this._peaks.player.getCurrentTime();\n\n    this._playedSegment = {\n      startTime: 0,\n      endTime: time\n    };\n\n    this._unplayedSegment = {\n      startTime: time,\n      endTime: this._getDuration()\n    };\n\n    this._waveformShape.setSegment(this._unplayedSegment);\n\n    this._playedWaveformShape = new WaveformShape({\n      color: this._playedWaveformColor,\n      view: this,\n      segment: this._playedSegment\n    });\n\n    this._playedWaveformShape.addToLayer(this._waveformLayer);\n  }\n};\n\nWaveformZoomView.prototype._destroyPlayedWaveformShape = function() {\n  this._waveformShape.setSegment(null);\n\n  this._playedWaveformShape.destroy();\n  this._playedWaveformShape = null;\n\n  this._playedSegment = null;\n  this._unplayedSegment = null;\n};\n\nWaveformZoomView.prototype._createWaveform = function() {\n  this._createWaveformShapes();\n\n  this._stage.add(this._waveformLayer);\n\n  this._peaks.emit('zoomview.displaying', 0, this.getEndTime());\n};\n\nWaveformZoomView.prototype._createAxisLabels = function() {\n  this._axisLayer = new Konva.Layer({ listening: false });\n\n  this._axis = new WaveformAxis(this, {\n    axisGridlineColor:   this._viewOptions.axisGridlineColor,\n    axisLabelColor:      this._viewOptions.axisLabelColor,\n    axisLabelFontFamily: this._viewOptions.fontFamily,\n    axisLabelFontSize:   this._viewOptions.fontSize,\n    axisLabelFontStyle:  this._viewOptions.fontStyle\n  });\n\n  this._axis.addToLayer(this._axisLayer);\n  this._stage.add(this._axisLayer);\n};\n\n/**\n * Scrolls the region of waveform shown in the view.\n *\n * @param {Number} scrollAmount How far to scroll, in pixels\n */\n\nWaveformZoomView.prototype.scrollWaveform = function(options) {\n  var scrollAmount;\n\n  if (objectHasProperty(options, 'pixels')) {\n    scrollAmount = Math.floor(options.pixels);\n  }\n  else if (objectHasProperty(options, 'seconds')) {\n    scrollAmount = this.timeToPixels(options.seconds);\n  }\n  else {\n    throw new TypeError('view.scrollWaveform(): Missing umber of pixels or seconds');\n  }\n\n  this._updateWaveform(this._frameOffset + scrollAmount);\n};\n\n/**\n * Updates the region of waveform shown in the view.\n *\n * @param {Number} frameOffset The new frame offset, in pixels.\n */\n\nWaveformZoomView.prototype._updateWaveform = function(frameOffset) {\n  var upperLimit;\n\n  if (this._pixelLength < this._width) {\n    // Total waveform is shorter than viewport, so reset the offset to 0.\n    frameOffset = 0;\n    upperLimit = this._width;\n  }\n  else {\n    // Calculate the very last possible position.\n    upperLimit = this._pixelLength - this._width;\n  }\n\n  frameOffset = clamp(frameOffset, 0, upperLimit);\n\n  this._frameOffset = frameOffset;\n\n  // Display playhead if it is within the zoom frame width.\n  var playheadPixel = this._playheadLayer.getPlayheadPixel();\n\n  this._playheadLayer.updatePlayheadTime(this.pixelsToTime(playheadPixel));\n\n  this._drawWaveformLayer();\n  this._axisLayer.draw();\n\n  var frameStartTime = this.getStartTime();\n  var frameEndTime   = this.getEndTime();\n\n  this._pointsLayer.updatePoints(frameStartTime, frameEndTime);\n  this._segmentsLayer.updateSegments(frameStartTime, frameEndTime);\n\n  this._peaks.emit('zoomview.displaying', frameStartTime, frameEndTime);\n};\n\nWaveformZoomView.prototype._drawWaveformLayer = function() {\n  this._waveformLayer.draw();\n};\n\nWaveformZoomView.prototype.setWaveformColor = function(color) {\n  this._waveformColor = color;\n  this._waveformShape.setWaveformColor(color);\n};\n\nWaveformZoomView.prototype.setPlayedWaveformColor = function(color) {\n  this._playedWaveformColor = color;\n\n  if (color) {\n    if (!this._playedWaveformShape) {\n      this._createWaveformShapes();\n    }\n\n    this._playedWaveformShape.setWaveformColor(color);\n  }\n  else {\n    if (this._playedWaveformShape) {\n      this._destroyPlayedWaveformShape();\n    }\n  }\n};\n\nWaveformZoomView.prototype.showPlayheadTime = function(show) {\n  this._playheadLayer.showPlayheadTime(show);\n};\n\nWaveformZoomView.prototype.setTimeLabelPrecision = function(precision) {\n  this._timeLabelPrecision = precision;\n  this._playheadLayer.updatePlayheadText();\n};\n\nWaveformZoomView.prototype.formatTime = function(time) {\n  return formatTime(time, this._timeLabelPrecision);\n};\n\nWaveformZoomView.prototype.enableAutoScroll = function(enable) {\n  this._enableAutoScroll = enable;\n};\n\nWaveformZoomView.prototype.enableMarkerEditing = function(enable) {\n  this._segmentsLayer.enableEditing(enable);\n  this._pointsLayer.enableEditing(enable);\n};\n\nWaveformZoomView.prototype.fitToContainer = function() {\n  if (this._container.clientWidth === 0 && this._container.clientHeight === 0) {\n    return;\n  }\n\n  var updateWaveform = false;\n\n  if (this._container.clientWidth !== this._width) {\n    this._width = this._container.clientWidth;\n    this._stage.width(this._width);\n\n    var resample = false;\n    var resampleOptions;\n\n    if (this._zoomLevelAuto) {\n      resample = true;\n      resampleOptions = { width: this._width };\n    }\n    else if (this._zoomLevelSeconds !== null) {\n      resample = true;\n      resampleOptions = { scale: this._getScale(this._zoomLevelSeconds) };\n    }\n\n    if (resample) {\n      try {\n        this._resampleData(resampleOptions);\n        updateWaveform = true;\n      }\n      catch (error) {\n        // Ignore, and leave this._data as it was\n      }\n    }\n  }\n\n  this._height = this._container.clientHeight;\n  this._stage.height(this._height);\n\n  this._waveformShape.fitToView();\n  this._playheadLayer.fitToView();\n  this._segmentsLayer.fitToView();\n  this._pointsLayer.fitToView();\n\n  if (updateWaveform) {\n    this._updateWaveform(this._frameOffset);\n  }\n\n  this._stage.draw();\n};\n\n/* WaveformZoomView.prototype.beginZoom = function() {\n  // Fade out the time axis and the segments\n  // this._axis.axisShape.setAttr('opacity', 0);\n\n  if (this._pointsLayer) {\n    this._pointsLayer.setVisible(false);\n  }\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.setVisible(false);\n  }\n};\n\nWaveformZoomView.prototype.endZoom = function() {\n  if (this._pointsLayer) {\n    this._pointsLayer.setVisible(true);\n  }\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.setVisible(true);\n  }\n\n  var time = this._peaks.player.getCurrentTime();\n\n  this.seekFrame(this.timeToPixels(time));\n}; */\n\nWaveformZoomView.prototype.destroy = function() {\n  if (this._resizeTimeoutId) {\n    clearTimeout(this._resizeTimeoutId);\n    this._resizeTimeoutId = null;\n  }\n\n  // Unregister event handlers\n  this._peaks.off('player.timeupdate', this._onTimeUpdate);\n  this._peaks.off('player.playing', this._onPlaying);\n  this._peaks.off('player.pause', this._onPause);\n  this._peaks.off('window_resize', this._onWindowResize);\n  this._peaks.off('keyboard.left', this._onKeyboardLeft);\n  this._peaks.off('keyboard.right', this._onKeyboardRight);\n  this._peaks.off('keyboard.shift_left', this._onKeyboardShiftLeft);\n  this._peaks.off('keyboard.shift_right', this._onKeyboardShiftRight);\n\n  this._playheadLayer.destroy();\n  this._segmentsLayer.destroy();\n  this._pointsLayer.destroy();\n\n  if (this._stage) {\n    this._stage.destroy();\n    this._stage = null;\n  }\n};\n\nexport default WaveformZoomView;\n","/**\n * @file\n *\n * Defines the {@link ViewController} class.\n *\n * @module view-controller\n */\n\nimport WaveformOverview from './waveform-overview';\nimport WaveformZoomView from './waveform-zoomview';\nimport { isNullOrUndefined } from './utils';\n\n/**\n * Creates an object that allows users to create and manage waveform views.\n *\n * @class\n * @alias ViewController\n *\n * @param {Peaks} peaks\n */\n\nfunction ViewController(peaks) {\n  this._peaks = peaks;\n  this._overview = null;\n  this._zoomview = null;\n}\n\nViewController.prototype.createOverview = function(container) {\n  if (this._overview) {\n    return this._overview;\n  }\n\n  var waveformData = this._peaks.getWaveformData();\n\n  this._overview = new WaveformOverview(\n    waveformData,\n    container,\n    this._peaks\n  );\n\n  if (this._zoomview) {\n    this._overview.showHighlight(\n      this._zoomview.getStartTime(),\n      this._zoomview.getEndTime()\n    );\n  }\n\n  return this._overview;\n};\n\nViewController.prototype.createZoomview = function(container) {\n  if (this._zoomview) {\n    return this._zoomview;\n  }\n\n  var waveformData = this._peaks.getWaveformData();\n\n  this._zoomview = new WaveformZoomView(\n    waveformData,\n    container,\n    this._peaks\n  );\n\n  return this._zoomview;\n};\n\nViewController.prototype.destroyOverview = function() {\n  if (!this._overview) {\n    return;\n  }\n\n  if (!this._zoomview) {\n    return;\n  }\n\n  this._overview.destroy();\n  this._overview = null;\n};\n\nViewController.prototype.destroyZoomview = function() {\n  if (!this._zoomview) {\n    return;\n  }\n\n  if (!this._overview) {\n    return;\n  }\n\n  this._zoomview.destroy();\n  this._zoomview = null;\n\n  this._overview.removeHighlightRect();\n};\n\nViewController.prototype.destroy = function() {\n  if (this._overview) {\n    this._overview.destroy();\n    this._overview = null;\n  }\n\n  if (this._zoomview) {\n    this._zoomview.destroy();\n    this._zoomview = null;\n  }\n};\n\nViewController.prototype.getView = function(name) {\n  if (isNullOrUndefined(name)) {\n    if (this._overview && this._zoomview) {\n      return null;\n    }\n    else if (this._overview) {\n      return this._overview;\n    }\n    else if (this._zoomview) {\n      return this._zoomview;\n    }\n    else {\n      return null;\n    }\n  }\n  else {\n    switch (name) {\n      case 'overview':\n        return this._overview;\n\n      case 'zoomview':\n        return this._zoomview;\n\n      default:\n        return null;\n    }\n  }\n};\n\nexport default ViewController;\n","/**\n * @file\n *\n * Defines the {@link ZoomController} class.\n *\n * @module zoom-controller\n */\n\n/**\n * Creates an object to control zoom levels in a {@link WaveformZoomView}.\n *\n * @class\n * @alias ZoomController\n *\n * @param {Peaks} peaks\n * @param {Array<Integer>} zoomLevels\n */\n\nfunction ZoomController(peaks, zoomLevels) {\n  this._peaks = peaks;\n  this._zoomLevels = zoomLevels;\n  this._zoomLevelIndex = 0;\n}\n\nZoomController.prototype.setZoomLevels = function(zoomLevels) {\n  this._zoomLevels = zoomLevels;\n  this.setZoom(0, true);\n};\n\n/**\n * Zoom in one level.\n */\n\nZoomController.prototype.zoomIn = function() {\n  this.setZoom(this._zoomLevelIndex - 1);\n};\n\n/**\n * Zoom out one level.\n */\n\nZoomController.prototype.zoomOut = function() {\n  this.setZoom(this._zoomLevelIndex + 1);\n};\n\n/**\n * Given a particular zoom level, triggers a resampling of the data in the\n * zoomed view.\n *\n * @param {number} zoomLevelIndex An index into the options.zoomLevels array.\n */\n\nZoomController.prototype.setZoom = function(zoomLevelIndex, forceUpdate) {\n  if (zoomLevelIndex >= this._zoomLevels.length) {\n    zoomLevelIndex = this._zoomLevels.length - 1;\n  }\n\n  if (zoomLevelIndex < 0) {\n    zoomLevelIndex = 0;\n  }\n\n  if (!forceUpdate && (zoomLevelIndex === this._zoomLevelIndex)) {\n    // Nothing to do.\n    return;\n  }\n\n  this._zoomLevelIndex = zoomLevelIndex;\n\n  var zoomview = this._peaks.views.getView('zoomview');\n\n  if (!zoomview) {\n    return;\n  }\n\n  zoomview.setZoom({ scale: this._zoomLevels[zoomLevelIndex] });\n};\n\n/**\n * Returns the current zoom level index.\n *\n * @returns {Number}\n */\n\nZoomController.prototype.getZoom = function() {\n  return this._zoomLevelIndex;\n};\n\n/**\n * Returns the current zoom level, in samples per pixel.\n *\n * @returns {Number}\n */\n\nZoomController.prototype.getZoomLevel = function() {\n  return this._zoomLevels[this._zoomLevelIndex];\n};\n\nexport default ZoomController;\n","/**\n * @file\n *\n * Defines the {@link WaveformBuilder} class.\n *\n * @module waveform-builder\n */\n\nimport { isArrayBuffer, isObject, isString } from './utils';\nimport WaveformData from 'waveform-data';\n\nvar isXhr2 = ('withCredentials' in new XMLHttpRequest());\n\n/**\n * Creates and returns a WaveformData object, either by requesting the\n * waveform data from the server, or by creating the waveform data using the\n * Web Audio API.\n *\n * @class\n * @alias WaveformBuilder\n *\n * @param {Peaks} peaks\n */\n\nfunction WaveformBuilder(peaks) {\n  this._peaks = peaks;\n}\n\n/**\n * Options for requesting remote waveform data.\n *\n * @typedef {Object} RemoteWaveformDataOptions\n * @global\n * @property {String=} arraybuffer\n * @property {String=} json\n */\n\n/**\n * Options for supplying local waveform data.\n *\n * @typedef {Object} LocalWaveformDataOptions\n * @global\n * @property {ArrayBuffer=} arraybuffer\n * @property {Object=} json\n */\n\n/**\n * Options for the Web Audio waveform builder.\n *\n * @typedef {Object} WaveformBuilderWebAudioOptions\n * @global\n * @property {AudioContext} audioContext\n * @property {AudioBuffer=} audioBuffer\n * @property {Number=} scale\n * @property {Boolean=} multiChannel\n */\n\n/**\n * Options for [WaveformBuilder.init]{@link WaveformBuilder#init}.\n *\n * @typedef {Object} WaveformBuilderInitOptions\n * @global\n * @property {RemoteWaveformDataOptions=} dataUri\n * @property {LocalWaveformDataOptions=} waveformData\n * @property {WaveformBuilderWebAudioOptions=} webAudio\n * @property {Boolean=} withCredentials\n * @property {Array<Number>=} zoomLevels\n */\n\n/**\n * Callback for receiving the waveform data.\n *\n * @callback WaveformBuilderInitCallback\n * @global\n * @param {Error} error\n * @param {WaveformData} waveformData\n */\n\n/**\n * Loads or creates the waveform data.\n *\n * @private\n * @param {WaveformBuilderInitOptions} options\n * @param {WaveformBuilderInitCallback} callback\n */\n\nWaveformBuilder.prototype.init = function(options, callback) {\n  if ((options.dataUri && (options.webAudio || options.audioContext)) ||\n      (options.waveformData && (options.webAudio || options.audioContext)) ||\n      (options.dataUri && options.waveformData)) {\n    // eslint-disable-next-line max-len\n    callback(new TypeError('Peaks.init(): You may only pass one source (webAudio, dataUri, or waveformData) to render waveform data.'));\n    return;\n  }\n\n  if (options.audioContext) {\n    // eslint-disable-next-line max-len\n    this._peaks.logger('Peaks.init(): The audioContext option is deprecated, please pass a webAudio object instead');\n\n    options.webAudio = {\n      audioContext: options.audioContext\n    };\n  }\n\n  if (options.dataUri) {\n    return this._getRemoteWaveformData(options, callback);\n  }\n  else if (options.waveformData) {\n    return this._buildWaveformFromLocalData(options, callback);\n  }\n  else if (options.webAudio) {\n    if (options.webAudio.audioBuffer) {\n      return this._buildWaveformDataFromAudioBuffer(options, callback);\n    }\n    else {\n      return this._buildWaveformDataUsingWebAudio(options, callback);\n    }\n  }\n  else {\n    // eslint-disable-next-line max-len\n    callback(new Error('Peaks.init(): You must pass an audioContext, or dataUri, or waveformData to render waveform data'));\n  }\n};\n\n/* eslint-disable max-len */\n\n/**\n * Fetches waveform data, based on the given options.\n *\n * @private\n * @param {Object} options\n * @param {String|Object} options.dataUri\n * @param {String} options.dataUri.arraybuffer Waveform data URL\n *   (binary format)\n * @param {String} options.dataUri.json Waveform data URL (JSON format)\n * @param {String} options.defaultUriFormat Either 'arraybuffer' (for binary\n *   data) or 'json'\n * @param {WaveformBuilderInitCallback} callback\n *\n * @see Refer to the <a href=\"https://github.com/bbc/audiowaveform/blob/master/doc/DataFormat.md\">data format documentation</a>\n *   for details of the binary and JSON waveform data formats.\n */\n\n/* eslint-enable max-len */\n\nWaveformBuilder.prototype._getRemoteWaveformData = function(options, callback) {\n  var self = this;\n  var dataUri = null;\n  var requestType = null;\n  var url;\n\n  if (isObject(options.dataUri)) {\n    dataUri = options.dataUri;\n  }\n  else if (isString(options.dataUri)) {\n    // Backward compatibility\n    dataUri = {};\n    dataUri[options.dataUriDefaultFormat || 'json'] = options.dataUri;\n  }\n  else {\n    callback(new TypeError('Peaks.init(): The dataUri option must be an object'));\n    return;\n  }\n\n  ['ArrayBuffer', 'JSON'].some(function(connector) {\n    if (window[connector]) {\n      requestType = connector.toLowerCase();\n      url = dataUri[requestType];\n\n      return Boolean(url);\n    }\n  });\n\n  if (!url) {\n    // eslint-disable-next-line max-len\n    callback(new Error('Peaks.init(): Unable to determine a compatible dataUri format for this browser'));\n    return;\n  }\n\n  var xhr = self._createXHR(url, requestType, options.withCredentials, function(event) {\n    if (this.readyState !== 4) {\n      return;\n    }\n\n    if (this.status !== 200) {\n      callback(\n        new Error('Unable to fetch remote data. HTTP status ' + this.status)\n      );\n\n      return;\n    }\n\n    var waveformData = WaveformData.create(event.target.response);\n\n    if (waveformData.channels !== 1 && waveformData.channels !== 2) {\n      callback(new Error('Peaks.init(): Only mono or stereo waveforms are currently supported'));\n      return;\n    }\n    else if (waveformData.bits !== 8) {\n      callback(new Error('Peaks.init(): 16-bit waveform data is not supported'));\n      return;\n    }\n\n    callback(null, waveformData);\n  },\n  function() {\n    callback(new Error('XHR Failed'));\n  });\n\n  xhr.send();\n};\n\n/* eslint-disable max-len */\n\n/**\n * Creates a waveform from given data, based on the given options.\n *\n * @private\n * @param {Object} options\n * @param {Object} options.waveformData\n * @param {ArrayBuffer} options.waveformData.arraybuffer Waveform data (binary format)\n * @param {Object} options.waveformData.json Waveform data (JSON format)\n * @param {WaveformBuilderInitCallback} callback\n *\n * @see Refer to the <a href=\"https://github.com/bbc/audiowaveform/blob/master/doc/DataFormat.md\">data format documentation</a>\n *   for details of the binary and JSON waveform data formats.\n */\n\n/* eslint-enable max-len */\n\nWaveformBuilder.prototype._buildWaveformFromLocalData = function(options, callback) {\n  var waveformData = null;\n  var data = null;\n\n  if (isObject(options.waveformData)) {\n    waveformData = options.waveformData;\n  }\n  else {\n    callback(new Error('Peaks.init(): The waveformData option must be an object'));\n    return;\n  }\n\n  if (isObject(waveformData.json)) {\n    data = waveformData.json;\n  }\n  else if (isArrayBuffer(waveformData.arraybuffer)) {\n    data = waveformData.arraybuffer;\n  }\n\n  if (!data) {\n    // eslint-disable-next-line max-len\n    callback(new Error('Peaks.init(): Unable to determine a compatible waveformData format'));\n    return;\n  }\n\n  try {\n    var createdWaveformData = WaveformData.create(data);\n\n    if (createdWaveformData.channels !== 1 && createdWaveformData.channels !== 2) {\n      callback(new Error('Peaks.init(): Only mono or stereo waveforms are currently supported'));\n      return;\n    }\n    else if (createdWaveformData.bits !== 8) {\n      callback(new Error('Peaks.init(): 16-bit waveform data is not supported'));\n      return;\n    }\n\n    callback(null, createdWaveformData);\n  }\n  catch (err) {\n    callback(err);\n  }\n};\n\n/**\n * Creates waveform data using the Web Audio API.\n *\n * @private\n * @param {Object} options\n * @param {AudioContext} options.audioContext\n * @param {HTMLMediaElement} options.mediaElement\n * @param {WaveformBuilderInitCallback} callback\n */\n\nWaveformBuilder.prototype._buildWaveformDataUsingWebAudio = function(options, callback) {\n  var self = this;\n\n  var audioContext = window.AudioContext || window.webkitAudioContext;\n\n  if (!(options.webAudio.audioContext instanceof audioContext)) {\n    // eslint-disable-next-line max-len\n    callback(new TypeError('Peaks.init(): The webAudio.audioContext option must be a valid AudioContext'));\n    return;\n  }\n\n  var webAudioOptions = options.webAudio;\n\n  if (webAudioOptions.scale !== options.zoomLevels[0]) {\n    webAudioOptions.scale = options.zoomLevels[0];\n  }\n\n  // If the media element has already selected which source to play, its\n  // currentSrc attribute will contain the source media URL. Otherwise,\n  // we wait for a canplay event to tell us when the media is ready.\n\n  var mediaSourceUrl = self._peaks.options.mediaElement.currentSrc;\n\n  if (mediaSourceUrl) {\n    self._requestAudioAndBuildWaveformData(\n      mediaSourceUrl,\n      webAudioOptions,\n      options.withCredentials,\n      callback\n    );\n  }\n  else {\n    self._peaks.once('player.canplay', function() {\n      self._requestAudioAndBuildWaveformData(\n        self._peaks.options.mediaElement.currentSrc,\n        webAudioOptions,\n        options.withCredentials,\n        callback\n      );\n    });\n  }\n};\n\nWaveformBuilder.prototype._buildWaveformDataFromAudioBuffer = function(options, callback) {\n  var webAudioOptions = options.webAudio;\n\n  if (webAudioOptions.scale !== options.zoomLevels[0]) {\n    webAudioOptions.scale = options.zoomLevels[0];\n  }\n\n  var webAudioBuilderOptions = {\n    audio_buffer: webAudioOptions.audioBuffer,\n    split_channels: webAudioOptions.multiChannel,\n    scale: webAudioOptions.scale\n  };\n\n  WaveformData.createFromAudio(webAudioBuilderOptions, callback);\n};\n\n/**\n * Fetches the audio content, based on the given options, and creates waveform\n * data using the Web Audio API.\n *\n * @private\n * @param {url} The media source URL\n * @param {WaveformBuilderWebAudioOptions} webAudio\n * @param {Boolean} withCredentials\n * @param {WaveformBuilderInitCallback} callback\n */\n\nWaveformBuilder.prototype._requestAudioAndBuildWaveformData = function(url,\n    webAudio, withCredentials, callback) {\n  var self = this;\n\n  if (!url) {\n    self._peaks.logger('Peaks.init(): The mediaElement src is invalid');\n    return;\n  }\n\n  var xhr = self._createXHR(url, 'arraybuffer', withCredentials, function(event) {\n    if (this.readyState !== 4) {\n      return;\n    }\n\n    if (this.status !== 200) {\n      callback(\n        new Error('Unable to fetch remote data. HTTP status ' + this.status)\n      );\n\n      return;\n    }\n\n    var webAudioBuilderOptions = {\n      audio_context: webAudio.audioContext,\n      array_buffer: event.target.response,\n      split_channels: webAudio.multiChannel,\n      scale: webAudio.scale\n    };\n\n    WaveformData.createFromAudio(webAudioBuilderOptions, callback);\n  },\n  function() {\n    callback(new Error('XHR Failed'));\n  });\n\n  xhr.send();\n};\n\n/**\n * @private\n * @param {String} url\n * @param {String} requestType\n * @param {Boolean} withCredentials\n * @param {Function} onLoad\n * @param {Function} onError\n *\n * @returns {XMLHttpRequest}\n */\n\nWaveformBuilder.prototype._createXHR = function(url, requestType,\n    withCredentials, onLoad, onError) {\n  var xhr = new XMLHttpRequest();\n\n  // open an XHR request to the data source file\n  xhr.open('GET', url, true);\n\n  if (isXhr2) {\n    try {\n      xhr.responseType = requestType;\n    }\n    catch (e) {\n      // Some browsers like Safari 6 do handle XHR2 but not the json\n      // response type, doing only a try/catch fails in IE9\n    }\n  }\n\n  xhr.onload = onLoad;\n  xhr.onerror = onError;\n\n  if (isXhr2 && withCredentials) {\n    xhr.withCredentials = true;\n  }\n\n  return xhr;\n};\n\nexport default WaveformBuilder;\n","/**\n * @file\n *\n * Defines the {@link Peaks} class.\n *\n * @module main\n */\n\nimport EventEmitter from 'eventemitter3';\nimport CueEmitter from './cue-emitter';\nimport WaveformPoints from './waveform-points';\nimport WaveformSegments from './waveform-segments';\nimport KeyboardHandler from './keyboard-handler';\nimport MediaElementPlayer from './mediaelement-player';\nimport Player from './player';\nimport { createPointMarker, createSegmentMarker, createSegmentLabel } from './marker-factories';\nimport ViewController from './view-controller';\nimport ZoomController from './zoom-controller';\nimport WaveformBuilder from './waveform-builder';\nimport {\n  isHTMLElement, isFunction, isInAscendingOrder, isObject,\n  objectHasProperty\n} from './utils';\n\n/**\n * Initialises a new Peaks instance with default option settings.\n *\n * @class\n * @alias Peaks\n *\n * @param {Object} opts Configuration options\n */\n\nfunction Peaks() {\n  EventEmitter.call(this);\n\n  // Set default options\n  this.options = {\n    zoomLevels:              [512, 1024, 2048, 4096],\n\n    mediaElement:            null,\n    mediaUrl:                null,\n\n    dataUri:                 null,\n    dataUriDefaultFormat:    'json',\n    withCredentials:         false,\n\n    waveformData:            null,\n    webAudio:                null,\n\n    nudgeIncrement:          1.0,\n\n    segmentStartMarkerColor: '#aaaaaa',\n    segmentEndMarkerColor:   '#aaaaaa',\n    randomizeSegmentColor:   true,\n    segmentColor:            '#ff851b',\n    pointMarkerColor:        '#39cccc',\n\n    createSegmentMarker:     createSegmentMarker,\n    createSegmentLabel:      createSegmentLabel,\n    createPointMarker:       createPointMarker,\n\n    // eslint-disable-next-line no-console\n    logger:                  console.error.bind(console)\n  };\n\n  return this;\n}\n\nPeaks.prototype = Object.create(EventEmitter.prototype);\n\nvar defaultViewOptions = {\n  playheadColor:       '#111111',\n  playheadTextColor:   '#aaaaaa',\n  axisGridlineColor:   '#cccccc',\n  axisLabelColor:      '#aaaaaa',\n  fontFamily:          'sans-serif',\n  fontSize:            11,\n  fontStyle:           'normal',\n  timeLabelPrecision:  2\n};\n\nvar defaultZoomviewOptions = {\n  // showPlayheadTime:    true,\n  waveformColor:       'rgba(0, 225, 128, 1)',\n  wheelMode:           'none'\n  // zoomAdapter:         'static'\n};\n\nvar defaultOverviewOptions = {\n  // showPlayheadTime:    false,\n  waveformColor:       'rgba(0, 0, 0, 0.2)',\n  highlightColor:      '#aaaaaa',\n  highlightOffset:     11\n};\n\nfunction getOverviewOptions(opts) {\n  var overviewOptions = {};\n\n  if (opts.containers && opts.containers.overview) {\n    overviewOptions.container = opts.containers.overview;\n  }\n\n  if (opts.overviewWaveformColor) {\n    overviewOptions.waveformColor = opts.overviewWaveformColor;\n  }\n\n  if (opts.overviewHighlightOffset) {\n    overviewOptions.highlightOffset = opts.overviewHighlightOffset;\n  }\n\n  if (opts.overviewHighlightColor) {\n    overviewOptions.highlightColor = opts.overviewHighlightColor;\n  }\n\n  if (opts.overview && opts.overview.showPlayheadTime) {\n    overviewOptions.showPlayheadTime = opts.overview.showPlayheadTime;\n  }\n\n  var optNames = [\n    'container',\n    'waveformColor',\n    'playedWaveformColor',\n    'playheadColor',\n    'playheadTextColor',\n    'timeLabelPrecision',\n    'axisGridlineColor',\n    'axisLabelColor',\n    'fontFamily',\n    'fontSize',\n    'fontStyle',\n    'highlightColor',\n    'highlightOffset'\n  ];\n\n  optNames.forEach(function(optName) {\n    if (opts.overview && objectHasProperty(opts.overview, optName)) {\n      overviewOptions[optName] = opts.overview[optName];\n    }\n    else if (objectHasProperty(opts, optName)) {\n      overviewOptions[optName] = opts[optName];\n    }\n    else if (objectHasProperty(defaultOverviewOptions, optName)) {\n      overviewOptions[optName] = defaultOverviewOptions[optName];\n    }\n    else if (objectHasProperty(defaultViewOptions, optName)) {\n      overviewOptions[optName] = defaultViewOptions[optName];\n    }\n  });\n\n  return overviewOptions;\n}\n\nfunction getZoomviewOptions(opts) {\n  var zoomviewOptions = {};\n\n  if (opts.containers && opts.containers.zoomview) {\n    zoomviewOptions.container = opts.containers.zoomview;\n  }\n\n  if (opts.zoomWaveformColor) {\n    zoomviewOptions.waveformColor = opts.zoomWaveformColor;\n  }\n\n  if (opts.showPlayheadTime) {\n    zoomviewOptions.showPlayheadTime = opts.showPlayheadTime;\n  }\n  else if (opts.zoomview && opts.zoomview.showPlayheadTime) {\n    zoomviewOptions.showPlayheadTime = opts.zoomview.showPlayheadTime;\n  }\n\n  var optNames = [\n    'container',\n    'waveformColor',\n    'playedWaveformColor',\n    'playheadColor',\n    'playheadTextColor',\n    'timeLabelPrecision',\n    'axisGridlineColor',\n    'axisLabelColor',\n    'fontFamily',\n    'fontSize',\n    'fontStyle',\n    'wheelMode'\n  ];\n\n  optNames.forEach(function(optName) {\n    if (opts.zoomview && objectHasProperty(opts.zoomview, optName)) {\n      zoomviewOptions[optName] = opts.zoomview[optName];\n    }\n    else if (objectHasProperty(opts, optName)) {\n      zoomviewOptions[optName] = opts[optName];\n    }\n    else if (objectHasProperty(defaultZoomviewOptions, optName)) {\n      zoomviewOptions[optName] = defaultZoomviewOptions[optName];\n    }\n    else if (objectHasProperty(defaultViewOptions, optName)) {\n      zoomviewOptions[optName] = defaultViewOptions[optName];\n    }\n  });\n\n  return zoomviewOptions;\n}\n\nfunction extendOptions(to, from) {\n  for (var key in from) {\n    if (objectHasProperty(from, key) &&\n        objectHasProperty(to, key)) {\n      to[key] = from[key];\n    }\n  }\n\n  return to;\n}\n\n/**\n * Creates and initialises a new Peaks instance with the given options.\n *\n * @param {Object} opts Configuration options\n *\n * @return {Peaks}\n */\n\nPeaks.init = function(opts, callback) {\n  var instance = new Peaks();\n\n  var err = instance._setOptions(opts);\n\n  if (err) {\n    callback(err);\n    return;\n  }\n\n  var zoomviewContainer = instance.options.zoomview.container;\n  var overviewContainer = instance.options.overview.container;\n\n  if (!isHTMLElement(zoomviewContainer) &&\n      !isHTMLElement(overviewContainer)) {\n    // eslint-disable-next-line max-len\n    callback(new TypeError('Peaks.init(): The zoomview and/or overview container options must be valid HTML elements'));\n    return;\n  }\n\n  if (zoomviewContainer && zoomviewContainer.clientWidth <= 0) {\n    // eslint-disable-next-line max-len\n    callback(new TypeError('Peaks.init(): Please ensure that the zoomview container is visible and has non-zero width'));\n    return;\n  }\n\n  if (overviewContainer && overviewContainer.clientWidth <= 0) {\n    // eslint-disable-next-line max-len\n    callback(new TypeError('Peaks.init(): Please ensure that the overview container is visible and has non-zero width'));\n    return;\n  }\n\n  if (opts.keyboard) {\n    instance._keyboardHandler = new KeyboardHandler(instance);\n  }\n\n  var player = opts.player ?\n    opts.player :\n    new MediaElementPlayer(instance, instance.options.mediaElement);\n\n  instance.player = new Player(instance, player);\n  instance.segments = new WaveformSegments(instance);\n  instance.points = new WaveformPoints(instance);\n  instance.zoom = new ZoomController(instance, instance.options.zoomLevels);\n  instance.views = new ViewController(instance);\n\n  // Setup the UI components\n  var waveformBuilder = new WaveformBuilder(instance);\n\n  waveformBuilder.init(instance.options, function(err, waveformData) {\n    if (err) {\n      if (callback) {\n        callback(err);\n      }\n\n      return;\n    }\n\n    instance._waveformData = waveformData;\n\n    if (overviewContainer) {\n      instance.views.createOverview(overviewContainer);\n    }\n\n    if (zoomviewContainer) {\n      instance.views.createZoomview(zoomviewContainer);\n    }\n\n    instance._addWindowResizeHandler();\n\n    if (opts.segments) {\n      instance.segments.add(opts.segments);\n    }\n\n    if (opts.points) {\n      instance.points.add(opts.points);\n    }\n\n    if (opts.emitCueEvents) {\n      instance._cueEmitter = new CueEmitter(instance);\n    }\n\n    // Allow applications to attach event handlers before emitting events,\n    // when initialising with local waveform data.\n\n    setTimeout(function() {\n      instance.emit('peaks.ready');\n    }, 0);\n\n    callback(null, instance);\n  });\n};\n\nPeaks.prototype._setOptions = function(opts) {\n  if (!isObject(opts)) {\n    return new TypeError('Peaks.init(): The options parameter should be an object');\n  }\n\n  if (!opts.player) {\n    if (!opts.mediaElement) {\n      return new Error('Peaks.init(): Missing mediaElement option');\n    }\n\n    if (!(opts.mediaElement instanceof HTMLMediaElement)) {\n      // eslint-disable-next-line max-len\n      return new TypeError('Peaks.init(): The mediaElement option should be an HTMLMediaElement');\n    }\n  }\n\n  if (opts.container) {\n    // eslint-disable-next-line max-len\n    return new Error('Peaks.init(): The container option has been removed, please use containers instead');\n  }\n\n  if (opts.logger && !isFunction(opts.logger)) {\n    // eslint-disable-next-line max-len\n    return new TypeError('Peaks.init(): The logger option should be a function');\n  }\n\n  if (opts.segments && !Array.isArray(opts.segments)) {\n    // eslint-disable-next-line max-len\n    return new TypeError('Peaks.init(): options.segments must be an array of segment objects');\n  }\n\n  if (opts.points && !Array.isArray(opts.points)) {\n    // eslint-disable-next-line max-len\n    return new TypeError('Peaks.init(): options.points must be an array of point objects');\n  }\n\n  extendOptions(this.options, opts);\n\n  this.options.overview = getOverviewOptions(opts);\n  this.options.zoomview = getZoomviewOptions(opts);\n\n  if (!Array.isArray(this.options.zoomLevels)) {\n    return new TypeError('Peaks.init(): The zoomLevels option should be an array');\n  }\n  else if (this.options.zoomLevels.length === 0) {\n    return new Error('Peaks.init(): The zoomLevels array must not be empty');\n  }\n  else {\n    if (!isInAscendingOrder(this.options.zoomLevels)) {\n      return new Error('Peaks.init(): The zoomLevels array must be sorted in ascending order');\n    }\n  }\n\n  if (opts.logger) {\n    this.logger = opts.logger;\n  }\n};\n\n/**\n * Remote waveform data options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} RemoteWaveformDataOptions\n * @global\n * @property {String=} arraybuffer\n * @property {String=} json\n */\n\n/**\n * Local waveform data options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} LocalWaveformDataOptions\n * @global\n * @property {ArrayBuffer=} arraybuffer\n * @property {Object=} json\n */\n\n/**\n * Web Audio options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} WebAudioOptions\n * @global\n * @property {AudioContext=} audioContext\n * @property {AudioBuffer=} audioBuffer\n * @property {Number=} scale\n * @property {Boolean=} multiChannel\n */\n\n/**\n * Options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} PeaksSetSourceOptions\n * @global\n * @property {String} mediaUrl\n * @property {RemoteWaveformDataOptions=} dataUri\n * @property {LocalWaveformDataOptions=} waveformData\n * @property {WebAudioOptions=} webAudio\n * @property {Boolean=} withCredentials\n * @property {Array<Number>=} zoomLevels\n */\n\n/**\n * Changes the audio or video media source associated with the {@link Peaks}\n * instance.\n *\n * @param {PeaksSetSourceOptions} options\n * @param {Function} callback\n */\n\nPeaks.prototype.setSource = function(options, callback) {\n  var self = this;\n\n  if (this.options.mediaElement && !options.mediaUrl) {\n    // eslint-disable-next-line max-len\n    callback(new Error('peaks.setSource(): options must contain a mediaUrl when using mediaElement'));\n    return;\n  }\n\n  function reset() {\n    self.removeAllListeners('player.canplay');\n    self.removeAllListeners('player.error');\n  }\n\n  function playerErrorHandler(err) {\n    reset();\n\n    // Return the MediaError object from the media element\n    callback(err);\n  }\n\n  function playerCanPlayHandler() {\n    reset();\n\n    if (!options.zoomLevels) {\n      options.zoomLevels = self.options.zoomLevels;\n    }\n\n    var waveformBuilder = new WaveformBuilder(self);\n\n    waveformBuilder.init(options, function(err, waveformData) {\n      if (err) {\n        callback(err);\n        return;\n      }\n\n      self._waveformData = waveformData;\n\n      ['overview', 'zoomview'].forEach(function(viewName) {\n        var view = self.views.getView(viewName);\n\n        if (view) {\n          view.setWaveformData(waveformData);\n        }\n      });\n\n      self.zoom.setZoomLevels(options.zoomLevels);\n\n      callback();\n    });\n  }\n\n  self.once('player.canplay', playerCanPlayHandler);\n  self.once('player.error', playerErrorHandler);\n\n  if (this.options.mediaElement) {\n    self.options.mediaElement.setAttribute('src', options.mediaUrl);\n  }\n  else {\n    playerCanPlayHandler();\n  }\n};\n\nPeaks.prototype.getWaveformData = function() {\n  return this._waveformData;\n};\n\nPeaks.prototype._addWindowResizeHandler = function() {\n  this._onResize = this._onResize.bind(this);\n  window.addEventListener('resize', this._onResize);\n};\n\nPeaks.prototype._onResize = function() {\n  this.emit('window_resize');\n};\n\nPeaks.prototype._removeWindowResizeHandler = function() {\n  window.removeEventListener('resize', this._onResize);\n};\n\n/**\n * Cleans up a Peaks instance after use.\n */\n\nPeaks.prototype.destroy = function() {\n  this._removeWindowResizeHandler();\n\n  if (this._keyboardHandler) {\n    this._keyboardHandler.destroy();\n  }\n\n  if (this.views) {\n    this.views.destroy();\n  }\n\n  if (this.player) {\n    this.player.destroy();\n  }\n\n  if (this._cueEmitter) {\n    this._cueEmitter.destroy();\n  }\n};\n\nexport default Peaks;\n"],"names":["Cue","time","type","id","zeroPad","number","precision","toString","length","formatTime","result","fractionSeconds","Math","floor","pow","seconds","minutes","hours","push","i","join","clamp","value","min","max","objectHasProperty","object","field","Object","prototype","hasOwnProperty","call","extend","to","from","key","isNumber","isFinite","Infinity","isValidTime","Number","isObject","_typeof","Array","isArray","isString","isNullOrUndefined","isBoolean","isHTMLElement","HTMLElement","isLinearGradientColor","linearGradientStart","linearGradientEnd","linearGradientColorStops","POINT","SEGMENT_START","SEGMENT_END","sorter","a","b","isHeadless","test","navigator","userAgent","requestAnimationFrame","window","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","cancelAnimationFrame","mozCancelAnimationFrame","webkitCancelAnimationFrame","msCancelAnimationFrame","eventTypes","forward","reverse","eventNames","getPointOrSegment","peaks","cue","points","getPoint","segments","getSegment","Error","CueEmitter","_cues","_peaks","_previousTime","_updateCues","this","bind","_onPlaying","onPlaying","_onSeeked","onSeeked","_onTimeUpdate","onTimeUpdate","_onAnimationFrame","onAnimationFrame","_rAFHandle","_activeSegments","_attachEventHandlers","getSegmentIdComparator","segment","self","getPoints","getSegments","forEach","point","startTime","endTime","sort","player","getCurrentTime","_updateActiveSegments","_onUpdate","previousTime","start","end","step","isForward","marker","eventType","emit","webdriver","document","visibilityState","isPlaying","isSeeking","activeSegments","getSegmentsAtTime","find","triggerUpdateOn","on","_detachEventHandlers","off","destroy","pointOptions","validatePoint","options","context","TypeError","RangeError","labelText","editable","color","Point","_id","_time","_labelText","_color","_editable","_setUserData","WaveformPoints","_points","_pointsById","_pointIdCounter","indexOf","defineProperties","enumerable","get","update","opts","isVisible","_setTime","_getNextPointId","_addPoint","_createPoint","filter","add","arrayArgs","arguments","slice","map","_findPoint","predicate","indexes","_removeIndexes","removed","index","itemRemoved","splice","_removePoints","remove","p","removeById","pointId","removeByTime","removeAll","segmentOptions","validateSegment","Segment","_startTime","_endTime","WaveformSegments","_segments","_segmentsById","_segmentIdCounter","_colorIndex","_setStartTime","_setEndTime","_getNextSegmentId","colors","_getSegmentColor","randomizeSegmentColor","segmentColor","_addSegment","_createSegment","_findSegment","_removeSegments","s","segmentId","fnFilter","nodes","keys","KeyboardHandler","eventEmitter","_handleKeyEvent","addEventListener","MediaElementPlayer","mediaElement","_listeners","_mediaElement","validateAdapter","adapter","allProperties","obj","getOwnPropertyNames","getPrototypeOf","getAllPropertiesFrom","method","includes","Player","_playingSegment","_segment","_loop","_playSegmentTimerCallback","_adapter","init","DefaultPointMarker","_options","DefaultSegmentMarker","createSegmentMarker","view","createSegmentLabel","Text","x","y","text","textAlign","fontFamily","fontSize","fontStyle","fill","createPointMarker","HighlightLayer","offset","_view","_offset","_layer","Konva","Layer","listening","_highlightRect","MouseDragHandler","stage","handlers","_stage","_handlers","_dragging","_mouseDown","_mouseUp","_mouseMove","_lastMouseClientX","PlayheadLayer","_player","_playheadPixel","_playheadLineAnimation","_playheadVisible","_playheadColor","playheadColor","_playheadTextColor","playheadTextColor","_playheadFontFamily","playheadFontFamily","_playheadFontSize","playheadFontSize","_playheadFontStyle","playheadFontStyle","_playheadLayer","_createPlayhead","showPlayheadTime","_createPlayheadText","fitToView","zoomLevelChanged","PointMarker","_point","_marker","_draggable","draggable","_onClick","onClick","_onDblClick","onDblClick","_onDragStart","onDragStart","_onDragMove","onDragMove","_onDragEnd","onDragEnd","_onMouseEnter","onMouseEnter","_onMouseLeave","onMouseLeave","_dragBoundFunc","_group","Group","dragBoundFunc","_bindDefaultEventHandlers","event","target","nodeName","preventDefault","keyCode","shiftKey","removeEventListener","_addMediaListener","callback","_duration","getDuration","_isPlaying","error","_interval","readyState","HTMLMediaElement","HAVE_NOTHING","load","listener","play","pause","seeking","currentTime","duration","seek","logger","playSegment","loop","once","Promise","reject","group","_label","_handle","Rect","width","height","_line","Line","stroke","strokeWidth","layer","hide","bindEventHandlers","setX","getWidth","show","getHeight","timeUpdated","setText","xPosition","startMarker","addToStage","showHighlight","_createHighlightRect","_update","startOffset","timeToPixels","endOffset","setAttrs","opacity","cornerRadius","removeHighlight","updateHighlight","parent","getMarkerObject","attrs","evt","touches","clientX","onMouseDown","mouseDownPosX","_getMousePosX","changedTouches","onMouseMove","mousePosX","cancelable","onMouseUp","getContainer","getBoundingClientRect","left","isDragging","pixelsPerSecond","_useAnimation","_start","stop","_playheadLine","_playheadText","_playheadGroup","align","updatePlayheadTime","_syncPlayhead","pixelIndex","frameOffset","getFrameOffset","playheadX","playheadTextWidth","getTextWidth","playheadPosChanged","lastPlayheadPosition","Animation","playheadPosition","getPlayheadOffset","getPlayheadPixel","updatePlayheadText","pos","getAbsolutePosition","addToLayer","getX","destroyChildren","PointsLayer","allowEditing","_allowEditing","_pointMarkers","_onPointsDrag","_onPointHandleClick","_onPointHandleDblClick","_onPointHandleDragStart","_onPointHandleDragMove","_onPointHandleDragEnd","_onPointHandleMouseEnter","_onPointHandleMouseLeave","_onPointsUpdate","_onPointsAdd","_onPointsRemove","_onPointsRemoveAll","SegmentMarker","_segmentShape","segmentShape","_startMarker","_onDrag","onDrag","WaveformShape","shapeOptions","startY","_height","endY","fillLinearGradientStartPointY","fillLinearGradientEndPointY","fillLinearGradientColorStops","_shape","Shape","sceneFunc","_sceneFunc","hitFunc","_waveformShapeHitFunc","enableEditing","enable","frameStartTime","getStartTime","frameEndTime","getEndTime","_removePoint","_addPointMarker","updatePoints","removeChildren","_updatePoint","_createPointMarker","pointMarkerColor","getName","pointMarker","markerX","pixelOffsetToTime","_removeInvisiblePoints","_findOrAddPointMarker","pointMarkerX","count","setVisible","visible","draw","limit","getEndMarker","getStartMarker","isStartMarker","setSegment","setWaveformColor","_drawWaveform","getWaveformData","waveformData","startPixels","endPixels","channels","waveformTop","waveformHeight","_drawChannel","channel","top","amplitude","lineX","lineY","amplitudeScale","getAmplitudeScale","beginPath","min_sample","scaleY","lineTo","max_sample","closePath","fillShape","viewWidth","viewHeight","hitRectHeight","hitRectLeft","hitRectWidth","rect","fillStrokeShape","handler","scale","SegmentShape","_endMarker","_waveformShape","_onSegmentHandleDrag","_onSegmentHandleDragStart","_onSegmentHandleDragEnd","_createMarkers","SegmentsLayer","_segmentShapes","_onSegmentsUpdate","_onSegmentsAdd","_onSegmentsRemove","_onSegmentsRemoveAll","_onSegmentsDragged","WaveformAxis","_axisGridlineColor","axisGridlineColor","_axisLabelColor","axisLabelColor","_axisLabelFont","_buildFontString","axisLabelFontFamily","axisLabelFontSize","axisLabelFontStyle","_axisShape","drawAxis","WaveformOverview","container","_originalWaveformData","_container","_viewOptions","overview","_onPause","_onZoomviewDisplaying","_onWindowResize","_amplitudeScale","_timeLabelPrecision","timeLabelPrecision","_width","clientWidth","clientHeight","_data","resample","showWarnings","_resizeTimeoutId","Stage","_waveformLayer","_waveformColor","waveformColor","_playedWaveformColor","playedWaveformColor","_createWaveform","_segmentsLayer","_pointsLayer","_highlightLayer","highlightOffset","highlightColor","_createAxisLabels","_mouseDragHandler","pixelsToTime","_getDuration","WaveformZoomView","zoomview","_onKeyboardLeft","_onKeyboardRight","_onKeyboardShiftLeft","_onKeyboardShiftRight","_enableAutoScroll","_pixelLength","initialZoomLevel","zoom","getZoomLevel","_zoomLevelAuto","_zoomLevelSeconds","_resampleData","_frameOffset","initialFrameOffset","mouseDownX","diff","newFrameOffset","_updateWaveform","_onWheel","setWheelMode","wheelMode","ViewController","_overview","_zoomview","ZoomController","zoomLevels","_zoomLevels","_zoomLevelIndex","updatePosition","segmentStartOffset","segmentEndOffset","frameStartOffset","startPixel","endPixel","isEditingEnabled","segmentStartMarkerColor","endMarker","segmentEndMarkerColor","moveToTop","segmentMarker","startMarkerX","endMarkerX","startMarkerOffset","endMarkerOffset","redraw","_removeSegment","_addSegmentShape","updateSegments","_updateSegment","_createSegmentShape","_removeInvisibleSegments","_findOrAddSegmentShape","getAxisLabelScale","secs","baseSecs","steps","currentFrameStartTime","axisLabelIntervalSecs","firstAxisLabelSecs","multiple","multiplier","ceil","roundUpToNearest","axisLabelOffsetSecs","axisLabelOffsetPixels","setAttr","moveTo","label","labelX","measureText","labelY","fillText","_clickHandler","eventName","layerX","clearTimeout","setWidth","setTimeout","setWaveformData","_playedWaveformShape","_playedSegment","_unplayedSegment","sample_rate","pixels","setAmplitudeScale","_createWaveformShapes","_destroyPlayedWaveformShape","_axisLayer","_axis","removeHighlightRect","playheadTime","setPlayedWaveformColor","setTimeLabelPrecision","enableMarkerEditing","fitToContainer","updateWaveform","setHeight","mode","_wheelMode","wheelEvent","delta","deltaY","deltaX","offAxisDelta","abs","_keyboardScroll","direction","large","increment","nudgeIncrement","scrollWaveform","_drawWaveformLayer","_getScale","setZoom","isAutoScale","apexTime","playheadOffsetPixels","prevScale","_scale","apexPixel","setStartTime","scrollAmount","upperLimit","playheadPixel","enableAutoScroll","resampleOptions","createOverview","createZoomview","destroyOverview","destroyZoomview","getView","name","setZoomLevels","zoomIn","zoomOut","zoomLevelIndex","forceUpdate","views","getZoom","isXhr2","XMLHttpRequest","WaveformBuilder","Peaks","EventEmitter","mediaUrl","dataUri","dataUriDefaultFormat","withCredentials","webAudio","console","audioContext","_getRemoteWaveformData","_buildWaveformFromLocalData","audioBuffer","_buildWaveformDataFromAudioBuffer","_buildWaveformDataUsingWebAudio","url","requestType","some","connector","toLowerCase","Boolean","_createXHR","status","WaveformData","create","response","bits","send","data","json","arraybuffer","createdWaveformData","err","AudioContext","webkitAudioContext","webAudioOptions","mediaSourceUrl","currentSrc","_requestAudioAndBuildWaveformData","webAudioBuilderOptions","audio_buffer","split_channels","multiChannel","createFromAudio","audio_context","array_buffer","onLoad","onError","xhr","open","responseType","e","onload","onerror","defaultViewOptions","defaultZoomviewOptions","defaultOverviewOptions","instance","_setOptions","zoomviewContainer","overviewContainer","keyboard","_keyboardHandler","_waveformData","_addWindowResizeHandler","emitCueEvents","_cueEmitter","extendOptions","overviewOptions","containers","overviewWaveformColor","overviewHighlightOffset","overviewHighlightColor","optName","getOverviewOptions","zoomviewOptions","zoomWaveformColor","getZoomviewOptions","array","isInAscendingOrder","setSource","reset","removeAllListeners","playerCanPlayHandler","viewName","setAttribute","_onResize","_removeWindowResizeHandler"],"mappings":"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"}